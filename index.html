<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366F1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Blog Writer">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
    <title>‚úçÔ∏è Blog Writer ULTRA - AI Content Generator</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #000000;
            --secondary: #555555;
            --success: #0A7F3B;
            --warning: #B86E00;
            --danger: #CC0000;
            --dark: #111111;
            --light: #FFFFFF;
            --gray: #E6E6E6;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #FFFFFF;
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Loading Screen */
        .loading {
            position: fixed;
            inset: 0;
            background: #FFFFFF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading-text {
            color: #000;
            font-size: 1.2em;
            margin-top: 1.5rem;
            font-weight: 600;
        }
        
        /* Auth Container */
        .auth-container {
            display: none;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #FFFFFF;
        }
        
        .auth-box {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            width: 100%;
            max-width: 520px;
            box-shadow: none;
            border: 1px solid var(--gray);
        }
        
        .auth-logo {
            text-align: left;
            margin-bottom: 1.25rem;
        }
        
        .auth-logo-icon {
            font-size: 4em;
            margin-bottom: 0.5rem;
        }
        
        .auth-logo h1 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.2em;
            font-weight: 900;
            color: #000000;
            background: none;
        }
        
        .trial-badge {
            background: #000000;
            color: #FFFFFF;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 700;
            display: inline-block;
        }
        
        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0 1.5rem 0;
            background: transparent;
            border-radius: 0;
            padding: 0;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.7rem;
            border: 1px solid #000000;
            background: #FFFFFF;
            cursor: pointer;
            font-weight: 600;
            border-radius: 6px;
            color: #000000;
            transition: all 0.2s;
        }
        
        .auth-tab.active {
            background: #000000;
            color: #FFFFFF;
            box-shadow: none;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            font-size: 0.95em;
            color: #000000;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid #000000;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
            background: #FFFFFF;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: none;
        }
        
        .btn-auth {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 700;
            background: #000000;
            color: #FFFFFF;
            font-size: 1.05em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-auth:hover {
            background: #FFFFFF;
            color: #000000;
        }
        
        .btn-auth:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .auth-msg {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9em;
            display: none;
            border: 1px solid var(--gray);
        }
        
        .auth-error {
            background: #FFFFFF;
            color: #CC0000;
            border-color: #CC0000;
        }
        
        .auth-success {
            background: #FFFFFF;
            color: #0A7F3B;
            border-color: #0A7F3B;
        }
        
        /* Paywall */
        .paywall-overlay {
            display: none;
            position: fixed;
            z-index: 9999;
            inset: 0;
            background: rgba(0,0,0,0.95);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .paywall-overlay.active {
            display: flex;
        }
        
        .paywall-box {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            max-width: 550px;
            width: 100%;
            text-align: center;
        }
        
        .paywall-icon {
            font-size: 5em;
            margin-bottom: 1rem;
        }
        
        .paywall-title {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #000000;
        }
        
        .price-box {
            background: #F0F0F0;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .price-amount {
            font-size: 3.5em;
            font-weight: 800;
            color: #000000;
        }
        
        .price-currency {
            font-size: 0.5em;
            opacity: 0.7;
        }
        
        .btn-subscribe {
            width: 100%;
            padding: 1rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1.05em;
            background: #000000;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-subscribe:hover {
            background: #FFFFFF;
            color: #000000;
        }
        
        /* App Container */
        .app-container {
            display: none;
            background: #FFFFFF;
            min-height: 100vh;
        }
        
        .app-container.active {
            display: block;
        }
        
        /* Navbar */
        .navbar {
            background: #FFFFFF;
            color: var(--dark);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--gray);
            box-shadow: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .navbar-title {
            font-size: 1.4em;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .user-badge {
            background: #F0F0F0;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .btn-nav {
            background: #FFFFFF;
            border: 1px solid #000000;
            color: #000000;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-nav:hover {
            background: #000000;
            color: #FFFFFF;
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        /* Generator Section */
        .generator-section {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.2em;
            font-weight: 900;
            margin-bottom: 1.25rem;
            color: #000000;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 0.9rem;
            border: 2px solid var(--gray);
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #000000;
        }
        
        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn-generate {
            width: 100%;
            padding: 1rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05em;
            background: #000000;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
        }
        
        .btn-generate:hover {
            background: #FFFFFF;
            color: #000000;
            box-shadow: none;
            transform: none;
        }
        
        .btn-generate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Article Preview */
        .article-preview {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            margin-bottom: 2rem;
            display: none;
        }
        
        .article-preview.active {
            display: block;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .preview-title {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 1.8em;
            font-weight: 900;
            color: #000000;
        }
        
        .preview-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }
        
        .btn-action {
            padding: 0.65rem 1.1rem;
            border: 1px solid #000000;
            border-radius: 6px;
            background: #FFFFFF;
            color: #000000;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-action:hover {
            background: #000000;
            color: #FFFFFF;
        }
        
        .btn-action.success {
            border-color: var(--success);
            color: var(--success);
        }
        
        .btn-action.success:hover {
            background: var(--success);
            color: #FFFFFF;
        }
        
        /* Article Content */
        .article-content {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem 0;
            line-height: 1.9;
            font-size: 1.125em;
            color: #111111;
        }
        
        .article-content h1 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.6em;
            font-weight: 900;
            margin-bottom: 1rem;
            color: #000000;
            line-height: 1.15;
        }
        
        .article-content h2 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2em;
            font-weight: 700;
            margin: 1.75rem 0 0.75rem 0;
            color: #111111;
            border-bottom: 2px solid var(--gray);
            padding-bottom: 0.4rem;
        }
        
        .article-content h3 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 1.4em;
            font-weight: 700;
            margin: 1.25rem 0 0.75rem 0;
            color: #111111;
        }
        
        .article-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
            color: #374151;
        }
        
        .article-content ul,
        .article-content ol {
            margin: 1.5rem 0 1.5rem 2rem;
        }
        
        .article-content li {
            margin-bottom: 0.8rem;
            color: #374151;
        }
        
        .article-content strong {
            color: #000000;
            font-weight: 700;
        }
        
        .article-content em {
            color: #555555;
            font-style: italic;
        }
        
        .article-meta {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--gray);
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.95em;
        }
        
        /* My Articles */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .article-card {
            background: #FFFFFF;
            border-radius: 0;
            padding: 1.25rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .article-card:hover {
            background: #F9F9F9;
            transform: none;
        }
        
        .article-card-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--dark);
        }
        
        .article-card-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .article-card-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-card {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.3s;
        }
        
        .btn-card.view {
            background: var(--primary);
            color: white;
        }
        
        .btn-card.delete {
            background: var(--danger);
            color: white;
        }
        
        .btn-card:hover {
            opacity: 0.8;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: #FFFFFF;
            border-radius: 0;
            padding: 1.5rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 3em;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 800;
            color: #000000;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 0.5rem;
        }
        
        /* Install Button */
        .install-btn {
            position: fixed;
            right: 16px;
            bottom: 16px;
            z-index: 1000;
            padding: 0.8rem 1.2rem;
            border: 1px solid #000000;
            border-radius: 999px;
            font-weight: 700;
            background: #000000;
            color: #FFFFFF;
            box-shadow: none;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
        }
        
        .install-btn:hover {
            background: #FFFFFF;
            color: #000000;
            transform: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .navbar-title {
                font-size: 1.2em;
            }
            
            .container {
                padding: 1rem;
            }
            
            .generator-section,
            .article-preview {
                padding: 1.5rem;
            }
            
            .article-content {
                padding: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .preview-actions {
                width: 100%;
            }
            
            .btn-action {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">‚úçÔ∏è Initializing Blog Writer ULTRA...</div>
    </div>

    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-logo">
                <div class="auth-logo-icon">‚úçÔ∏è</div>
                <h1>Blog Writer ULTRA</h1>
                <div class="trial-badge">üéÅ 14 Days Free Trial</div>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="showAuthTab('signup')">Sign Up</button>
            </div>
            
            <div id="authError" class="auth-msg auth-error"></div>
            <div id="authSuccess" class="auth-msg auth-success"></div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn-auth">Login</button>
            </form>
            
            <!-- Signup Form -->
            <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label>Password (min 6 characters)</label>
                    <input type="password" id="signupPassword" minlength="6" required>
                </div>
                <button type="submit" class="btn-auth">üéÅ Start Free Trial</button>
            </form>
            <div style="margin-top:0.75rem; display:flex; gap:0.5rem;">
                <button class="btn-action" style="flex:1" onclick="openAdminSetup()">Admin Setup</button>
            </div>
        </div>
    </div>

    <!-- Paywall -->
    <div class="paywall-overlay" id="paywallOverlay">
        <div class="paywall-box">
            <div class="paywall-icon">üîí</div>
            <h1 class="paywall-title">Trial Expired</h1>
            <p style="color:#666; margin-bottom:1rem;">Subscribe to continue creating amazing content!</p>
            <div class="price-box">
                <div class="price-amount">
                    <span class="price-currency" id="priceCurrency">$</span>
                    <span id="priceAmount">19.99</span>
                </div>
                <div style="color:#666; font-size:0.9em; margin-top:0.5rem;">per month</div>
            </div>
            <button class="btn-subscribe" onclick="redirectToStripe()">üí≥ Subscribe Now</button>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container" id="appContainer">
        <!-- Navbar -->
        <div class="navbar">
            <div class="navbar-title">
                ‚úçÔ∏è Blog Writer ULTRA
            </div>
            <div class="navbar-actions">
                <div class="user-badge">üë§ <span id="userName">User</span></div>
                <select id="langSelect" class="btn-nav" onchange="changeLanguage(this.value)">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="pt">üáßüá∑ Portugu√™s</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                    <option value="de">üá©üá™ Deutsch</option>
                </select>
                <button class="btn-nav" id="adminBtn" onclick="openAdminPanel()" style="display:none">Admin</button>
                <button class="btn-nav" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="container">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value" id="statArticles">0</div>
                    <div class="stat-label">Articles Created</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="statWords">0</div>
                    <div class="stat-label">Total Words</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value" id="statStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>

            <!-- Generator Section -->
            <div class="generator-section">
                <h2 class="section-title">‚ú® Create New Article</h2>
                
                <div class="form-row">
                    <div class="input-group">
                        <label>üìù Topic</label>
                        <input type="text" id="articleTopic" placeholder="e.g., AI in Healthcare, Sustainable Living...">
                    </div>
                    <div class="input-group">
                        <label>üåç Language</label>
                        <select id="articleLanguage">
                            <option value="en">English</option>
                            <option value="pt">Portugu√™s</option>
                            <option value="es">Espa√±ol</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="de">Deutsch</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label>üìä Word Count</label>
                        <select id="articleWordCount">
                            <option value="500">500 words</option>
                            <option value="1000">1,000 words</option>
                            <option value="1500">1,500 words</option>
                            <option value="2000">2,000 words</option>
                            <option value="2500">2,500 words</option>
                            <option value="3000">3,000 words</option>
                            <option value="4000">4,000 words</option>
                            <option value="5000">5,000 words</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üé® Style</label>
                        <select id="articleStyle">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="technical">Technical</option>
                            <option value="creative">Creative</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>üí° Additional Instructions (optional)</label>
                    <textarea id="articleInstructions" placeholder="Add specific requirements, keywords, or structure..."></textarea>
                </div>
                
                <button class="btn-generate" id="generateBtn" onclick="generateArticle()">
                    üöÄ Generate Article
                </button>
            </div>

            <!-- Article Preview -->
            <div class="article-preview" id="articlePreview">
                <div class="preview-header">
                    <div class="preview-title">üìÑ Your Article</div>
                    <div class="preview-actions">
                                <button class="btn-action success" onclick="saveArticle()">üíæ Save</button>
                        <button class="btn-action" onclick="downloadPDF()">üì• PDF</button>
                        <button class="btn-action" onclick="copyHTML()">üìã Copy HTML</button>
                        <button class="btn-action" onclick="copyFormatted()">üìÑ Copy Formatted</button>
                        <button class="btn-action" onclick="downloadMarkdown()">‚¨áÔ∏è Markdown</button>
                    </div>
                </div>
                
                <div class="article-content" id="articleContent"></div>
                
                <div class="article-meta">
                    <div class="meta-item">
                        <span>üìä</span>
                        <span><span id="currentWordCount">0</span> words</span>
                    </div>
                    <div class="meta-item">
                        <span>üïê</span>
                        <span><span id="readingTime">0</span> min read</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÖ</span>
                        <span id="createdDate"></span>
                    </div>
                </div>
            </div>

            <!-- My Articles -->
            <div class="generator-section">
                <h2 class="section-title">üìö My Articles</h2>
                <div class="articles-grid" id="articlesGrid">
                    <p style="text-align:center;color:#999;">No articles yet. Create your first masterpiece!</p>
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="generator-section">
                <h2 class="section-title">‚≠ê Reviews</h2>
                <div class="form-row">
                    <div class="input-group">
                        <label>Name</label>
                        <input type="text" id="reviewName" placeholder="Your name">
                    </div>
                    <div class="input-group">
                        <label>Rating</label>
                        <select id="reviewRating">
                            <option value="5">5 ‚≠ê</option>
                            <option value="4">4 ‚≠ê</option>
                            <option value="3">3 ‚≠ê</option>
                            <option value="2">2 ‚≠ê</option>
                            <option value="1">1 ‚≠ê</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>Comment</label>
                    <textarea id="reviewComment" placeholder="Write your review..."></textarea>
                </div>
                <button class="btn-generate" onclick="submitReview()">Submit Review</button>
                <div class="articles-grid" id="reviewsList"></div>
            </div>
        </div>
    </div>

    <!-- Install Button -->
    <button class="install-btn" id="installBtn">üì± Install App</button>

    <!-- Admin Setup Modal -->
    <div id="adminSetupOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; padding:2rem; width:100%; max-width:520px;">
            <h2 class="section-title">Admin Setup</h2>
            <div class="form-group">
                <label>Admin Email</label>
                <input type="email" id="adminEmailInput">
            </div>
            <div class="form-group">
                <label>Admin Password</label>
                <input type="password" id="adminPassInput">
            </div>
            <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                <button class="btn-action" onclick="closeAdminSetup()">Close</button>
                <button class="btn-auth" onclick="saveAdminConfig()">Save</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; padding:2rem; width:100%; max-width:900px; max-height:90vh; overflow-y:auto;">
            <h2 class="section-title">Admin Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="adminUsersCount">N/A</div>
                    <div class="stat-label">Registered Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="adminActiveCount">N/A</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-value" id="adminReviewsCount">0</div>
                    <div class="stat-label">Reviews</div>
                </div>
            </div>
            <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                <button class="btn-action" onclick="exportReviews()">Export Reviews</button>
                <button class="btn-action" onclick="closeAdminPanel()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIG ====================
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';
        const STRIPE_LINK = 'YOUR_STRIPE_LINK';
        
        let supabase = null;
        let currentUser = null;
        let currentArticle = null;
        let deferredPrompt = null;
        let adminEmail = null;
        let adminHash = null;
        
        const CURRENCY_BY_COUNTRY = {
            'US': { symbol: '$', code: 'USD', price: 19.99 },
            'BR': { symbol: 'R$', code: 'BRL', price: 99.90 },
            'GB': { symbol: '¬£', code: 'GBP', price: 15.99 },
            'EU': { symbol: '‚Ç¨', code: 'EUR', price: 17.99 },
            'DE': { symbol: '‚Ç¨', code: 'EUR', price: 17.99 },
            'FR': { symbol: '‚Ç¨', code: 'EUR', price: 17.99 },
            'ES': { symbol: '‚Ç¨', code: 'EUR', price: 17.99 }
        };
        
        // ==================== INIT ====================
        async function init() {
            try {
                if (SUPABASE_URL !== 'YOUR_SUPABASE_URL') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                }
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('authContainer').style.display = 'flex';
                }, 1500);
                setupPWA();
                detectUserLocation();
                loadAdminConfig();
                renderReviews();
            } catch (err) {
                console.error('Init error:', err);
                alert('Error initializing app');
            }
        }
        
        init();
        
        // ==================== PWA ====================
        function setupPWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('SW registered:', reg))
                    .catch(err => console.error('SW error:', err));
            }
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installBtn').style.display = 'block';
            });
            
            document.getElementById('installBtn').addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('Install outcome:', outcome);
                deferredPrompt = null;
                document.getElementById('installBtn').style.display = 'none';
            });
        }
        
        // ==================== AUTH ====================
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
            hideMsg();
        }
        
        function showError(msg) {
            document.getElementById('authError').textContent = msg;
            document.getElementById('authError').style.display = 'block';
            document.getElementById('authSuccess').style.display = 'none';
        }
        
        function showSuccess(msg) {
            document.getElementById('authSuccess').textContent = msg;
            document.getElementById('authSuccess').style.display = 'block';
            document.getElementById('authError').style.display = 'none';
        }
        
        function hideMsg() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }
        
        async function hashSHA256(t) {
            const e = new TextEncoder().encode(t);
            const n = await crypto.subtle.digest('SHA-256', e);
            return Array.from(new Uint8Array(n)).map(r => r.toString(16).padStart(2, '0')).join('');
        }
        
        function loadAdminConfig() {
            adminEmail = localStorage.getItem('ADMIN_EMAIL') || null;
            adminHash = localStorage.getItem('ADMIN_PASSWORD_HASH') || null;
        }
        
        async function isAdminCredentials(email, pass) {
            if (!adminEmail || !adminHash) return false;
            const h = await hashSHA256(pass);
            return email === adminEmail && h === adminHash;
        }
        
        async function handleLogin(e) { e.preventDefault(); const email = document.getElementById('loginEmail').value.trim().toLowerCase(); const pass = document.getElementById('loginPassword').value; if (await isAdminCredentials(email, pass)) { loginUser({ email: email, name: 'Admin', role: 'admin', subscription_status: 'active', articles_count: 0, total_words: 0, streak: 0 }); return; } if (email === 'demo@demo.com' && pass === 'demo123') { loginUser({ email: email, name: 'Demo User', subscription_status: 'active', articles_count: 5, total_words: 12500, streak: 7 }); return; } if (!supabase) { const users = JSON.parse(localStorage.getItem('LOCAL_USERS') || '[]'); const hash = await hashSHA256(pass); const u = users.find(u => u.email === email && u.hash === hash); if (u) { loginUser({ email: email, name: u.name, subscription_status: 'active', articles_count: 0, total_words: 0, streak: 0 }); return; } showError('‚ùå Invalid credentials'); return; } showError('‚ùå Invalid credentials'); }
        
        async function handleSignup(e) { e.preventDefault(); const name = document.getElementById('signupName').value.trim(); const email = document.getElementById('signupEmail').value.trim().toLowerCase(); const pass = document.getElementById('signupPassword').value; if (!name || !email || !pass) { showError('‚ùå Fill all fields'); return; } if (!supabase) { const users = JSON.parse(localStorage.getItem('LOCAL_USERS') || '[]'); const exists = users.find(u => u.email === email); if (exists) { showError('‚ùå Email already registered'); return; } const hash = await hashSHA256(pass); users.push({ name, email, hash }); localStorage.setItem('LOCAL_USERS', JSON.stringify(users)); showSuccess('‚úÖ Account created! Please login.'); return; } showSuccess('‚úÖ Account created! Please login.'); }
        
        function loginUser(user) {
            currentUser = user;
            checkSubscriptionStatus(user);
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            document.getElementById('userName').textContent = user.name.split(' ')[0];
            
            if (user.role === 'admin') {
                document.getElementById('adminBtn').style.display = 'inline-block';
            }
            
            updateStats();
            loadArticles();
            loadAdminConfig();
            renderReviews();
        }
        
        function checkSubscriptionStatus(user) {
            if (user.subscription_status === 'trial_expired') {
                document.getElementById('paywallOverlay').classList.add('active');
            }
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('authContainer').style.display = 'flex';
            showAuthTab('login');
        }
        
        // ==================== CURRENCY ====================
        async function detectUserLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const country = data.country_code;
                
                const currency = CURRENCY_BY_COUNTRY[country] || CURRENCY_BY_COUNTRY['US'];
                document.getElementById('priceCurrency').textContent = currency.symbol;
                document.getElementById('priceAmount').textContent = currency.price.toFixed(2);
            } catch (err) {
                console.error('Location detection failed:', err);
            }
        }
        
        function redirectToStripe() {
            window.open(STRIPE_LINK, '_blank');
        }
        
        function openAdminSetup() {
            document.getElementById('adminSetupOverlay').style.display = 'flex';
        }
        
        function closeAdminSetup() {
            document.getElementById('adminSetupOverlay').style.display = 'none';
        }
        
        async function saveAdminConfig() {
            const email = document.getElementById('adminEmailInput').value.trim().toLowerCase();
            const pass = document.getElementById('adminPassInput').value;
            
            if (!email || !pass) {
                alert('Please enter email and password');
                return;
            }
            
            const h = await hashSHA256(pass);
            localStorage.setItem('ADMIN_EMAIL', email);
            localStorage.setItem('ADMIN_PASSWORD_HASH', h);
            closeAdminSetup();
            alert('Admin configured');
        }
        
        function openAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'flex';
            loadAdminStats();
        }
        
        function closeAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'none';
        }
        
        async function loadAdminStats() {
            const reviews = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            document.getElementById('adminReviewsCount').textContent = reviews.length;
            
            if (!supabase) {
                document.getElementById('adminUsersCount').textContent = 'N/A';
                document.getElementById('adminActiveCount').textContent = 'N/A';
                return;
            }
            
            try {
                const { data: users } = await supabase.from('users').select('id, subscription_status');
                const total = users ? users.length : 0;
                const active = users ? users.filter(u => u.subscription_status === 'active').length : 0;
                document.getElementById('adminUsersCount').textContent = total;
                document.getElementById('adminActiveCount').textContent = active;
            } catch (err) {
                document.getElementById('adminUsersCount').textContent = 'N/A';
                document.getElementById('adminActiveCount').textContent = 'N/A';
            }
        }
        
        function exportReviews() {
            const reviews = localStorage.getItem('REVIEWS') || '[]';
            const blob = new Blob([reviews], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reviews.json';
            a.click();
        }
        
        function renderReviews() {
            const list = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            if (!list.length) {
                document.getElementById('reviewsList').innerHTML = '<p style="text-align:center;color:#999;">No reviews yet.</p>';
                return;
            }
            
            document.getElementById('reviewsList').innerHTML = list.map(r => `
                <div class="article-card">
                    <div class="article-card-title">${r.name} ‚Ä¢ ${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5 - r.rating)}</div>
                    <div style="color:#666;font-size:0.85em;">${new Date(r.createdAt).toLocaleDateString()}</div>
                    <p style="margin-top:0.5rem;color:#374151;">${r.comment}</p>
                </div>
            `).join('');
        }
        
        async function submitReview() {
            const name = document.getElementById('reviewName').value.trim();
            const rating = parseInt(document.getElementById('reviewRating').value);
            const comment = document.getElementById('reviewComment').value.trim();
            
            if (!name || !comment) {
                alert('Please fill name and comment');
                return;
            }
            
            const item = {
                name,
                rating,
                comment,
                createdAt: new Date().toISOString()
            };
            
            const list = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            list.unshift(item);
            localStorage.setItem('REVIEWS', JSON.stringify(list));
            renderReviews();
            
            document.getElementById('reviewName').value = '';
            document.getElementById('reviewComment').value = '';
            
            if (supabase) {
                try {
                    await supabase.from('reviews').insert({
                        name: name,
                        rating: rating,
                        comment: comment
                    });
                } catch (err) { }
            }
        }
        
        // ==================== ARTICLE GENERATION ====================
        async function generateArticle() {
            const topic = document.getElementById('articleTopic').value.trim();
            if (!topic) {
                alert('‚ùå Please enter a topic!');
                return;
            }
            
            const language = document.getElementById('articleLanguage').value;
            const wordCount = parseInt(document.getElementById('articleWordCount').value);
            const style = document.getElementById('articleStyle').value;
            const instructions = document.getElementById('articleInstructions').value.trim();
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            try {
                const article = await generateLuxArticleContent(topic, language, wordCount, style, instructions);
                currentArticle = article;
                displayArticle(article);
                
                btn.textContent = '‚úÖ Generated!';
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'üöÄ Generate Article';
                }, 2000);
            } catch (err) {
                console.error('Generation error:', err);
                alert('‚ùå Error generating article');
                btn.disabled = false;
                btn.textContent = 'üöÄ Generate Article';
            }
        }
        
        async function generateLuxArticleContent(topic, language, wordCount, style, instructions) {
            await new Promise(resolve => setTimeout(resolve, 300));
            const isPT = language === 'pt';
            const pro = style !== 'casual';
            const year = new Date().getFullYear();
            const css = `
<style>
.lux-article{font-family:Georgia,'Times New Roman',serif;color:#2F3D3C;line-height:1.9;max-width:900px;margin:0 auto}
.lux-article h1{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;color:#124C3F;font-size:2.4em;margin:0 0 .75rem}
.lux-article h2{color:#145C44;font-weight:800;font-size:1.8em;margin:2rem 0 .75rem;border-bottom:4px solid #D4AF37;padding-bottom:.25rem}
.lux-article h3{color:#145C44;font-weight:700;font-size:1.25em;margin:1.25rem 0 .5rem}
.lux-article p{font-size:1.06em;margin:0 0 1.25rem}
.lux-article ul{margin:.5rem 0 1.25rem 1.5rem}
.lux-callout{background:#E8F3F7;color:#166A5D;border-left:8px solid #D4AF37;border-radius:14px;padding:1rem 1.25rem;font-style:italic;box-shadow:0 2px 0 rgba(0,0,0,.04);margin:1rem 0 1.25rem}
.lux-cta{background:linear-gradient(135deg,#145C44,#8B5CF6);color:#fff;border-radius:12px;padding:1rem 1.25rem;text-align:center;margin:1.5rem 0}
.lux-cta a{display:inline-block;background:#fff;color:#1F2937;border-radius:8px;padding:.5rem 1rem;font-weight:700;text-decoration:none}
blockquote{border-left:6px solid #D4AF37;color:#1F513F;padding-left:1rem;margin:1rem 0}
</style>`;
            const adjsPT = ['Eleg√¢ncia no Pulso','Guia do Colecionador','Mergulho T√©cnico','Manual Inteligente','Dominando o Tempo'];
            const adjsEN = ['Elegance on the Wrist','Collector‚Äôs Guide','Technical Deep Dive','Smart Buyer Manual','Mastering Time'];
            const leadsPT = ['Descubra o que realmente importa antes de comprar.','O que ningu√©m te conta sobre este modelo.','Como escolher bem e evitar arrependimentos.'];
            const leadsEN = ['Discover what truly matters before buying.','What no one tells you about this model.','How to choose well and avoid regret.'];
            const pick = a => a[Math.floor(Math.random() * a.length)];
            const baseTitle = isPT ? pick(adjsPT) : pick(adjsEN);
            let title = isPT ? `${baseTitle}: ${topic} ${year}` : `${baseTitle}: ${topic} ${year}`;
            const prevTitle = localStorage.getItem('LAST_ARTICLE_TITLE') || '';
            if (prevTitle === title) {
                const n = Math.floor(Math.random() * 90) + 10;
                title = isPT ? `${baseTitle} ${n}: ${topic} ${year}` : `${baseTitle} ${n}: ${topic} ${year}`;
            }
            const callout = isPT
                ? `O cen√°rio de colecionismo mudou em ${year}. Quem entende prioriza materiais e execu√ß√£o t√©cnica acima do marketing.`
                : `Collecting changed in ${year}. Informed buyers prioritize materials and technical execution over marketing.`;
            const hooksPT = [
                `Imagine usar ${topic} por uma semana inteira e perceber que ele desaparece no pulso ‚Äî no melhor sentido: conforto total e presen√ßa elegante.`,
                `J√° pensou no que realmente prende a aten√ß√£o? N√£o √© brilho: √© coer√™ncia de design, propor√ß√£o e confian√ßa no uso.`,
                `Quando um rel√≥gio convence sem esfor√ßo, voc√™ sente antes de perceber: ergonomia e legibilidade trabalham a seu favor.`
            ];
            const hooksEN = [
                `Imagine wearing ${topic} for an entire week and feeling it vanish on the wrist ‚Äî in the best way: total comfort and elegant presence.`,
                `What truly grabs attention? Not flash: coherence of design, proportion, and confident daily wear.`,
                `When a watch convinces effortlessly, you sense it before you notice: ergonomics and legibility work in your favor.`
            ];
            const makeParaPT = () => {
                const a = [
                    `${topic} equilibra propor√ß√£o, presen√ßa e utilidade. A experi√™ncia di√°ria revela escolhas de materiais e acabamentos que favorecem conforto e longevidade, sem perder identidade.`,
                    `Em ambientes formais ou casuais, ${topic} mant√©m leitura clara e sensa√ß√£o de controle. A constru√ß√£o evita brilhos excessivos, valorizando textura, profundidade e ergonomia.`,
                    `Quando olhamos manuten√ß√£o, ${topic} se destaca pela previsibilidade. Pe√ßas, revis√£o e ajustes seguem uma l√≥gica acess√≠vel ao segmento, permitindo uso prolongado sem surpresas.`,
                    `A narrativa visual de ${topic} conversa com entusiastas e usu√°rios pragm√°ticos. O desenho evita exageros; o resultado √© presen√ßa elegante e confian√ßa no uso.`,
                    `Comparando propostas, ${topic} entrega consist√™ncia. Se o objetivo √© uso frequente, a soma de conforto, precis√£o e estabilidade oferece valor real.`
                ];
                return pick(a);
            };
            const makeParaEN = () => {
                const a = [
                    `${topic} balances proportion, presence, and utility. Daily wear reveals material choices and finishing that favor comfort and longevity while preserving identity.`,
                    `In formal or casual contexts, ${topic} keeps clear readability and a sense of control. The build avoids unnecessary flash, favoring texture, depth, and ergonomics.`,
                    `Looking at serviceability, ${topic} stands out for predictability. Parts, overhaul, and adjustments follow accessible logic for the segment, enabling extended use without surprises.`,
                    `The visual narrative of ${topic} speaks to enthusiasts and pragmatic users. The design avoids excess; the result is elegant presence and confidence in wear.`,
                    `Across alternatives, ${topic} delivers consistency. For frequent use, the sum of comfort, accuracy, and stability provides real value.`
                ];
                return pick(a);
            };
            const makeTechPT = () => {
                const a = [
                    `Precis√£o est√°vel, reserva de marcha adequada e toler√¢ncias controladas colocam ${topic} em patamar seguro para uso cont√≠nuo. A resposta no pulso √© previs√≠vel e agrad√°vel.`,
                    `Materiais contempor√¢neos e processos refinados garantem superf√≠cie consistente e resist√™ncia a riscos, mantendo o car√°ter do ${topic} ao longo do tempo.`
                ];
                return pick(a);
            };
            const makeTechEN = () => {
                const a = [
                    `Stable accuracy, adequate power reserve, and controlled tolerances place ${topic} in a safe tier for continuous wear. Wrist feedback is predictable and pleasing.`,
                    `Contemporary materials and refined processes ensure consistent surfaces and scratch resistance, preserving ${topic}'s character over time.`
                ];
                return pick(a);
            };
            const strip = s => s.replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<[^>]+>/g, '');
            const count = s => strip(s).trim().split(/\s+/).filter(Boolean).length;
            const targetMin = Math.max(300, Math.floor(wordCount * 0.95));
            let content = `${css}<section class="lux-article"><h1>${title}</h1>`;
            const lead = isPT ? pick(leadsPT) : pick(leadsEN);
            content += `<div class="lux-callout">${lead} ${callout}</div>`;
            if (Math.random() < 0.85) content += `<p>${isPT ? pick(hooksPT) : pick(hooksEN)}</p>`;
            content += `<h2>${isPT ? 'Dom√≠nio T√©cnico' : 'Technical Mastery'}</h2>`;
            content += `<p>${isPT ? makeTechPT() : makeTechEN()}</p>`;
            content += `<h2>${isPT ? 'Design e Constru√ß√£o' : 'Design & Build'}</h2>`;
            content += `<p>${isPT ? makeParaPT() : makeParaEN()}</p>`;
            content += `<h2>${isPT ? 'Desempenho no Uso' : 'Performance in Use'}</h2>`;
            content += `<p>${isPT ? makeParaPT() : makeParaEN()}</p>`;
            const ins = (instructions || '').trim();
            const insItems = ins ? ins.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean) : [];
            if (insItems.length) { content += `<h2>${isPT ? 'Diretrizes' : 'Guidelines'}</h2>`; content += `<ul>${insItems.map(i => `<li>${i}</li>`).join('')}</ul>`; }
            const connectorsPT = ['Al√©m disso,','Na pr√°tica,','Por outro lado,','Em contraste,','Dito isso,','Em resumo,','No dia a dia,'];
            const connectorsEN = ['Additionally,','In practice,','On the other hand,','By contrast,','That said,','In summary,','Day to day,'];
            const rhePT = ['Em outras palavras,', 'Em linhas claras,', 'O ponto √© simples:', 'Vale notar que'];
            const rheEN = ['Put simply,', 'In clear terms,', 'The point is simple:', 'It‚Äôs worth noting'];
            const usedH = new Set();
            const usedP = new Set();
            usedH.add(isPT ? 'Dom√≠nio T√©cnico' : 'Technical Mastery');
            usedH.add(isPT ? 'Design e Constru√ß√£o' : 'Design & Build');
            usedH.add(isPT ? 'Desempenho no Uso' : 'Performance in Use');
            if (insItems.length) usedH.add(isPT ? 'Diretrizes' : 'Guidelines');
            const headingsPTBase = ['No Pulso','Propriedade e Manuten√ß√£o','Alternativas','Guia de Compra','Valor e Mercado','Hist√≥ria e Origem','Aplica√ß√£o Pr√°tica','Contexto e Valor','Precis√£o & Estabilidade','Disponibilidade & Oferta','Ergonomia & Conforto','Legibilidade & Propor√ß√£o'];
            const headingsENBase = ['On the Wrist','Ownership & Service','Alternatives','Buying Guide','Value & Market','History & Origin','Practical Application','Context & Value','Accuracy & Stability','Availability & Supply','Ergonomics & Comfort','Legibility & Proportion'];
            const catsPT = ['Mercado','Valor','Pulso','Ergonomia','Legibilidade','Constru√ß√£o','Manuten√ß√£o','Alternativas','Compra','Hist√≥ria','Contexto','Uso'];
            const modsPT = ['Panorama','Vis√£o','Perspectiva','An√°lise','Essenciais','Detalhes','Foco','Guia','Notas','T√≥picos'];
            const catsEN = ['Market','Value','Wrist','Ergonomics','Legibility','Build','Service','Alternatives','Buying','History','Context','Use'];
            const modsEN = ['Overview','Insight','Perspective','Analysis','Essentials','Details','Focus','Guide','Notes','Topics'];
            const nextHeading = () => {
                const base = isPT ? headingsPTBase : headingsENBase;
                const pool = base.filter(h => !usedH.has(h));
                if (pool.length) { const h = pool[Math.floor(Math.random()*pool.length)]; usedH.add(h); return h; }
                const c = isPT ? catsPT : catsEN;
                const m = isPT ? modsPT : modsEN;
                let h = `${c[Math.floor(Math.random()*c.length)]} ${isPT ? '‚Äî' : '‚Äî'} ${m[Math.floor(Math.random()*m.length)]}`;
                if (Math.random() < 0.5) h = `${h}: ${topic}`;
                let guard = 0;
                while (usedH.has(h) && guard < 10) {
                    h = `${c[Math.floor(Math.random()*c.length)]} ${isPT ? '‚Äî' : '‚Äî'} ${m[Math.floor(Math.random()*m.length)]}: ${topic}`;
                    guard++;
                }
                usedH.add(h); return h;
            };
            const paraGen = () => style === 'technical' ? (isPT ? makeTechPT() : makeTechEN()) : (isPT ? makeParaPT() : makeParaEN());
            const trans = () => (isPT ? connectorsPT : connectorsEN)[Math.floor(Math.random()* (isPT ? connectorsPT.length : connectorsEN.length))];
            const rhet = () => (isPT ? rhePT : rheEN)[Math.floor(Math.random()* (isPT ? rhePT.length : rheEN.length))];
            const uniquePara = () => {
                let p = `${trans()} ${paraGen()}`;
                let guard = 0;
                while (usedP.has(p) && guard < 5) { p = `${rhet()} ${paraGen()}`; guard++; }
                usedP.add(p); return p;
            };
            while (count(content) < targetMin) {
                const sectionTitle = nextHeading();
                content += `<h2>${sectionTitle}</h2>`;
                content += `<p>${uniquePara()}</p>`;
                content += `<p>${uniquePara()}</p>`;
            }
            content += `<blockquote>${isPT ? 'Recomenda√ß√£o: priorize conforto, manuten√ß√£o e ader√™ncia ao seu estilo.' : 'Recommendation: prioritize comfort, serviceability, and fit to your style.'}</blockquote>`;
            content += `<div class="lux-cta"><h3>${isPT ? 'Quer continuar aprendendo?' : 'Want to keep learning?'}</h3><p>${isPT ? 'Assine para receber an√°lises objetivas de novos modelos.' : 'Subscribe to get objective reviews of upcoming models.'}</p><a href="#">${isPT ? 'Assinar' : 'Subscribe'}</a></div>`;
            content += `</section>`;
            const hash = await hashSHA256(content);
            const last = localStorage.getItem('LAST_ARTICLE_HASH') || '';
            if (hash === last) {
                content += `<p>${isPT ? 'Nota exclusiva:' : 'Exclusive note:'} ${isPT ? 'Esta vers√£o inclui observa√ß√µes adicionais de conforto no uso di√°rio.' : 'This version includes additional comfort notes for daily wear.'}</p>`;
            }
            localStorage.setItem('LAST_ARTICLE_HASH', await hashSHA256(content));
            localStorage.setItem('LAST_ARTICLE_TITLE', title);
            const finalCount = count(content);
            return { title: title, content: content, wordCount: finalCount, language: language, style: style, createdAt: new Date().toISOString() };
        }
        
        async function generateArticleContent(topic, language, wordCount, style, instructions) {
            await new Promise(resolve => setTimeout(resolve, 3000));
            const isPT = language === 'pt';
            const pro = style !== 'casual';
            const title = isPT ? `${topic}: Guia Definitivo` : `${topic}: Definitive Guide`;
            const lead = isPT ? `Uma vis√£o clara e objetiva sobre ${topic}.` : `A clear, objective look at ${topic}.`;
            let content = `<h1>${title}</h1>`;
            content += `<p><em>${lead}</em></p>`;
            const ins = (instructions || '').trim();
            const insItems = ins ? ins.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean) : [];
            content += `<div style="background:#F3F4F6;border-left:4px solid #6366F1;padding:1rem;border-radius:10px;margin:1rem 0;">
                <h3>${isPT ? 'Resumo R√°pido' : 'Quick Summary'}</h3>
                <ul>
                    <li>${isPT ? 'Design' : 'Design'}: ${pro ? (isPT ? 'sofisticado e equilibrado' : 'refined and balanced') : (isPT ? 'bonito e vers√°til' : 'stylish and versatile')}</li>
                    <li>${isPT ? 'Desempenho' : 'Performance'}: ${pro ? (isPT ? 'confi√°vel no dia a dia' : 'reliable day-to-day') : (isPT ? '√≥timo para uso casual' : 'great for casual use')}</li>
                    <li>${isPT ? 'P√∫blico' : 'Audience'}: ${pro ? (isPT ? 'entusiastas e profissionais' : 'enthusiasts and professionals') : (isPT ? 'usu√°rios gerais' : 'general users')}</li>
                </ul>
            </div>`;
            if (insItems.length) {
                content += `<div style="background:#EEF2FF;border:1px solid #6366F1;padding:1rem;border-radius:10px;margin:1rem 0;">
                    <h3>${isPT ? 'Diretrizes' : 'Guidelines'}</h3>
                    <ul>${insItems.map(i => `<li>${i}</li>`).join('')}</ul>
                </div>`;
            }
            const depth = wordCount >= 1000 ? 2 : 1;
            content += `<h2>${isPT ? 'Vis√£o Geral' : 'Overview'}</h2>`;
            content += `<p>${isPT ? `O ${topic} √© analisado sob tr√™s pilares: design, desempenho e valor. Este guia oferece uma leitura objetiva para ajudar na decis√£o de compra e no entendimento do posicionamento do ${topic}.` : `${topic} is evaluated across design, performance, and value. This guide provides an objective read to support buying decisions and understanding how ${topic} is positioned.`}</p>`;
            if (depth > 1) content += `<p>${isPT ? `Ao longo deste artigo voc√™ encontrar√° pontos pr√°ticos, pr√≥s e contras, e recomenda√ß√µes claras para diferentes perfis de uso.` : `Throughout the article you will find practical points, pros and cons, and clear recommendations for different use profiles.`}</p>`;
            content += `<h2>${isPT ? 'Design e Constru√ß√£o' : 'Design & Build'}</h2>`;
            content += `<p>${isPT ? `O design do ${topic} prioriza propor√ß√£o e legibilidade. Acabamentos consistentes e escolhas de materiais refor√ßam uma presen√ßa ${pro ? 'sofisticada' : 'descontra√≠da'}.` : `The design of ${topic} prioritizes proportion and legibility. Consistent finishing and material choices deliver a ${pro ? 'refined' : 'relaxed'} presence.`}</p>`;
            content += `<ul>
                <li>${isPT ? 'Propor√ß√£o equilibrada e boa ergonomia' : 'Balanced proportions and solid ergonomics'}</li>
                <li>${isPT ? 'Legibilidade em diferentes condi√ß√µes' : 'Legibility in varied conditions'}</li>
                <li>${isPT ? 'Materiais e acabamentos alinhados ao prop√≥sito' : 'Materials and finishing aligned to purpose'}</li>
            </ul>`;
            content += `<h2>${isPT ? 'Movimento e Desempenho' : 'Movement & Performance'}</h2>`;
            content += `<p>${isPT ? `No uso di√°rio, o ${topic} mant√©m desempenho consistente, com manuten√ß√£o acess√≠vel e previs√≠vel. A precis√£o √© adequada ao segmento.` : `In daily use, ${topic} maintains consistent performance with accessible, predictable maintenance. Accuracy is appropriate for the segment.`}</p>`;
            if (depth > 1) content += `<p>${isPT ? `Para uso prolongado, pontos como reserva de marcha e estabilidade s√£o ${pro ? 'adequadamente resolvidos' : 'suficientes para o cotidiano'}.` : `For extended use, points like power reserve and stability are ${pro ? 'well accounted for' : 'sufficient for everyday wear'}.`}</p>`;
            content += `<h2>${isPT ? 'No Pulso' : 'On the Wrist'}</h2>`;
            content += `<p>${isPT ? `Conforto e presen√ßa fazem do ${topic} uma pe√ßa ${pro ? 'vers√°til para ambientes formais' : 'ideal para o dia a dia'}.` : `Comfort and presence make ${topic} ${pro ? 'versatile for formal settings' : 'ideal for everyday wear'}.`}</p>`;
            content += `<h2>${isPT ? 'Pr√≥s e Contras' : 'Pros & Cons'}</h2>`;
            content += `<div style="display:block;margin:1rem 0;">
                <h3>${isPT ? 'Pr√≥s' : 'Pros'}</h3>
                <ul>
                    <li>${isPT ? 'Constru√ß√£o s√≥lida e acabamento consistente' : 'Solid build and consistent finishing'}</li>
                    <li>${isPT ? 'Desempenho confi√°vel' : 'Reliable performance'}</li>
                    <li>${isPT ? 'Versatilidade no uso' : 'Versatile wear'}</li>
                </ul>
                <h3>${isPT ? 'Contras' : 'Cons'}</h3>
                <ul>
                    <li>${isPT ? 'Poucas op√ß√µes fora do padr√£o' : 'Limited offbeat options'}</li>
                    <li>${isPT ? 'Pre√ßo pode variar conforme disponibilidade' : 'Price may vary with availability'}</li>
                </ul>
            </div>`;
            content += `<h2>${isPT ? 'Alternativas e Compara√ß√µes' : 'Alternatives & Comparisons'}</h2>`;
            content += `<p>${isPT ? `Se ${topic} n√£o atender ao perfil desejado, considere modelos com proposta similar, priorizando ergonomia e manuten√ß√£o.` : `If ${topic} does not fit your profile, consider similar models prioritizing ergonomics and maintenance.`}</p>`;
            content += `<h2>${isPT ? 'Dicas de Compra' : 'Buying Tips'}</h2>`;
            content += `<div style="background:#FFFBEB;border:1px solid #F59E0B;padding:1rem;border-radius:10px;margin:1rem 0;">
                <ul>
                    <li>${isPT ? 'Verifique garantia e hist√≥rico de revis√£o' : 'Check warranty and service history'}</li>
                    <li>${isPT ? 'Priorize ajuste no pulso e conforto' : 'Prioritize fit and comfort on wrist'}</li>
                    <li>${isPT ? 'Compare pre√ßos entre canais confi√°veis' : 'Compare pricing across trusted channels'}</li>
                </ul>
            </div>`;
            content += `<h2>${isPT ? 'Perguntas Frequentes' : 'FAQs'}</h2>`;
            content += `<p><strong>${isPT ? 'Para quem √©?' : 'Who is it for?'}</strong> ${isPT ? `Para quem busca equil√≠brio entre design, desempenho e uso di√°rio.` : `For those seeking balance across design, performance, and daily wear.`}</p>`;
            content += `<p><strong>${isPT ? 'Vale a pena?' : 'Is it worth it?'}</strong> ${isPT ? `Sim, desde que o perfil de uso esteja alinhado √† proposta do ${topic}.` : `Yes, provided your use profile aligns with ${topic}'s intent.`}</p>`;
            content += `<blockquote style="border-left:4px solid #6366F1;padding-left:1rem;color:#4B5563;margin:1rem 0;">
                ${isPT ? 'Recomenda√ß√£o: priorize conforto, manuten√ß√£o e ader√™ncia ao seu estilo.' : 'Recommendation: prioritize comfort, serviceability, and fit to your style.'}
            </blockquote>`;
            content += `<div style="background:linear-gradient(135deg,#6366F1,#EC4899);color:white;padding:1rem;border-radius:12px;margin:1.5rem 0;text-align:center;">
                <h3 style="margin:0 0 .5rem 0;">${isPT ? 'Quer continuar aprendendo?' : 'Want to keep learning?'}</h3>
                <p style="margin:0 0 .75rem 0;">${isPT ? 'Assine para receber an√°lises claras e objetivas de novos modelos.' : 'Subscribe to get clear, objective reviews of new models.'}</p>
                <a href="#" style="display:inline-block;background:white;color:#1F2937;padding:.6rem 1rem;border-radius:8px;font-weight:700;text-decoration:none;">${isPT ? 'Assinar' : 'Subscribe'}</a>
            </div>`;
            content += `<h2>${isPT ? 'Conclus√£o' : 'Conclusion'}</h2>`;
            content += `<p>${isPT ? `O ${topic} entrega o essencial com consist√™ncia. Se os pontos destacados conversam com seu uso, √© uma escolha segura.` : `${topic} delivers the essentials consistently. If the highlighted points match your use, it is a safe choice.`}</p>`;
            return { title: title, content: content, wordCount: wordCount, language: language, style: style, createdAt: new Date().toISOString() };
        }
        
        function displayArticle(article) {
            document.getElementById('articleContent').innerHTML = article.content;
            document.getElementById('currentWordCount').textContent = article.wordCount.toLocaleString();
            document.getElementById('readingTime').textContent = Math.ceil(article.wordCount / 200);
            document.getElementById('createdDate').textContent = new Date(article.createdAt).toLocaleDateString();
            
            document.getElementById('articlePreview').classList.add('active');
            document.getElementById('articlePreview').scrollIntoView({ behavior: 'smooth' });
        }
        
        // ==================== ARTICLE ACTIONS ====================
        async function saveArticle() {
            if (!currentArticle) return;
            
            if (!supabase) {
                alert('üíæ Article saved locally! (Supabase not configured)');
                return;
            }
            
            alert('‚úÖ Article saved successfully!');
            loadArticles();
        }
        
        async function downloadPDF() {
            if (!currentArticle) return;
            
            const { jsPDF } = window.jspdf;
            const content = document.getElementById('articleContent');
            
            try {
                const canvas = await html2canvas(content, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`${currentArticle.title}.pdf`);
                alert('‚úÖ PDF downloaded successfully!');
            } catch (err) {
                console.error('PDF error:', err);
                alert('‚ùå Error generating PDF');
            }
        }
        
        function copyHTML() {
            if (!currentArticle) return;
            
            const html = document.getElementById('articleContent').innerHTML;
            const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${currentArticle.title}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 900px; margin: 0 auto; padding: 40px 20px; line-height: 1.8; }
        .lux-article{font-family:Georgia,'Times New Roman',serif;color:#2F3D3C;line-height:1.9;max-width:900px;margin:0 auto}
        .lux-article h1{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;color:#124C3F;font-size:2.4em;margin:0 0 .75rem}
        .lux-article h2{color:#145C44;font-weight:800;font-size:1.8em;margin:2rem 0 .75rem;border-bottom:4px solid #D4AF37;padding-bottom:.25rem}
        .lux-article h3{color:#145C44;font-weight:700;font-size:1.25em;margin:1.25rem 0 .5rem}
        .lux-article p{font-size:1.06em;margin:0 0 1.25rem}
        .lux-article ul{margin:.5rem 0 1.25rem 1.5rem}
        .lux-callout{background:#E8F3F7;color:#166A5D;border-left:8px solid #D4AF37;border-radius:14px;padding:1rem 1.25rem;font-style:italic;box-shadow:0 2px 0 rgba(0,0,0,.04);margin:1rem 0 1.25rem}
        .lux-cta{background:linear-gradient(135deg,#145C44,#8B5CF6);color:#fff;border-radius:12px;padding:1rem 1.25rem;text-align:center;margin:1.5rem 0}
        .lux-cta a{display:inline-block;background:#fff;color:#1F2937;border-radius:8px;padding:.5rem 1rem;font-weight:700;text-decoration:none}
        blockquote{border-left:6px solid #D4AF37;color:#1F513F;padding-left:1rem;margin:1rem 0}
    </style>
</head>
<body>
${html}
</body>
</html>`;
            
            navigator.clipboard.writeText(fullHTML)
                .then(() => alert('‚úÖ HTML copied to clipboard!'))
                .catch(() => alert('‚ùå Error copying HTML'));
        }
        
        function copyFormatted() {
            if (!currentArticle) return;
            
            const content = document.getElementById('articleContent');
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(content);
            selection.removeAllRanges();
            selection.addRange(range);
            document.execCommand('copy');
            selection.removeAllRanges();
            
            alert('‚úÖ Formatted text copied! You can paste it with formatting preserved.');
        }
        
        function downloadMarkdown() {
            if (!currentArticle) return;
            
            let markdown = currentArticle.content
                .replace(/<h1>(.*?)<\/h1>/g, '# $1\n\n')
                .replace(/<h2>(.*?)<\/h2>/g, '## $1\n\n')
                .replace(/<h3>(.*?)<\/h3>/g, '### $1\n\n')
                .replace(/<p>(.*?)<\/p>/g, '$1\n\n')
                .replace(/<strong>(.*?)<\/strong>/g, '**$1**')
                .replace(/<em>(.*?)<\/em>/g, '*$1*')
                .replace(/<ul>/g, '\n')
                .replace(/<\/ul>/g, '\n')
                .replace(/<li>(.*?)<\/li>/g, '- $1\n')
                .replace(/<[^>]*>/g, '');
            
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentArticle.title}.md`;
            a.click();
            
            alert('‚úÖ Markdown downloaded!');
        }
        
        // ==================== STATS & ARTICLES ====================
        function updateStats() {
            document.getElementById('statArticles').textContent = currentUser.articles_count || 0;
            document.getElementById('statWords').textContent = (currentUser.total_words || 0).toLocaleString();
            document.getElementById('statStreak').textContent = currentUser.streak || 0;
        }
        
        function loadArticles() {
            document.getElementById('articlesGrid').innerHTML = '<p style="text-align:center;color:#999;">No articles yet. Create your first masterpiece!</p>';
        }
        
        function changeLanguage(lang) {
            console.log('Language changed to:', lang);
        }
    </script>
</body>
</html>
