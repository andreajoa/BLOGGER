<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366F1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Blog Writer">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
    <title>‚úçÔ∏è Blog Writer ULTRA - AI Content Generator</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #000000;
            --secondary: #555555;
            --success: #0A7F3B;
            --warning: #B86E00;
            --danger: #CC0000;
            --dark: #111111;
            --light: #FFFFFF;
            --gray: #E6E6E6;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #FFFFFF;
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Loading Screen */
        .loading {
            position: fixed;
            inset: 0;
            background: #FFFFFF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading-text {
            color: #000;
            font-size: 1.2em;
            margin-top: 1.5rem;
            font-weight: 600;
        }
        
        /* Auth Container */
        .auth-container {
            display: none;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #FFFFFF;
        }
        
        .auth-box {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            width: 100%;
            max-width: 520px;
            box-shadow: none;
            border: 1px solid var(--gray);
        }
        
        .auth-logo {
            text-align: left;
            margin-bottom: 1.25rem;
        }
        
        .auth-logo-icon {
            font-size: 4em;
            margin-bottom: 0.5rem;
        }
        
        .auth-logo h1 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.2em;
            font-weight: 900;
            color: #000000;
            background: none;
        }
        
        .trial-badge {
            background: #000000;
            color: #FFFFFF;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 700;
            display: inline-block;
        }
        
        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0 1.5rem 0;
            background: transparent;
            border-radius: 0;
            padding: 0;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.7rem;
            border: 1px solid #000000;
            background: #FFFFFF;
            cursor: pointer;
            font-weight: 600;
            border-radius: 6px;
            color: #000000;
            transition: all 0.2s;
        }
        
        .auth-tab.active {
            background: #000000;
            color: #FFFFFF;
            box-shadow: none;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            font-size: 0.95em;
            color: #000000;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid #000000;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
            background: #FFFFFF;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: none;
        }
        
        .btn-auth {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 700;
            background: #000000;
            color: #FFFFFF;
            font-size: 1.05em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-auth:hover {
            background: #FFFFFF;
            color: #000000;
        }
        
        .btn-auth:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .auth-msg {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9em;
            display: none;
            border: 1px solid var(--gray);
        }
        
        .auth-error {
            background: #FFFFFF;
            color: #CC0000;
            border-color: #CC0000;
        }
        
        .auth-success {
            background: #FFFFFF;
            color: #0A7F3B;
            border-color: #0A7F3B;
        }
        
        /* Paywall */
        .paywall-overlay {
            display: none;
            position: fixed;
            z-index: 9999;
            inset: 0;
            background: rgba(0,0,0,0.95);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .paywall-overlay.active {
            display: flex;
        }
        
        .paywall-box {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            max-width: 550px;
            width: 100%;
            text-align: center;
        }
        
        .paywall-icon {
            font-size: 5em;
            margin-bottom: 1rem;
        }
        
        .paywall-title {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #000000;
        }
        
        .price-box {
            background: #F0F0F0;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .price-amount {
            font-size: 3.5em;
            font-weight: 800;
            color: #000000;
        }
        
        .price-currency {
            font-size: 0.5em;
            opacity: 0.7;
        }
        
        .btn-subscribe {
            width: 100%;
            padding: 1rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1.05em;
            background: #000000;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-subscribe:hover {
            background: #FFFFFF;
            color: #000000;
        }
        
        /* App Container */
        .app-container {
            display: none;
            background: #FFFFFF;
            min-height: 100vh;
        }
        
        .app-container.active {
            display: block;
        }
        
        /* Navbar */
        .navbar {
            background: #FFFFFF;
            color: var(--dark);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--gray);
            box-shadow: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .navbar-title {
            font-size: 1.4em;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .user-badge {
            background: #F0F0F0;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .btn-nav {
            background: #FFFFFF;
            border: 1px solid #000000;
            color: #000000;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-nav:hover {
            background: #000000;
            color: #FFFFFF;
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        /* Generator Section */
        .generator-section {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.2em;
            font-weight: 900;
            margin-bottom: 1.25rem;
            color: #000000;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 0.9rem;
            border: 2px solid var(--gray);
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #000000;
        }
        
        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn-generate {
            width: 100%;
            padding: 1rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05em;
            background: #000000;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
        }
        
        .btn-generate:hover {
            background: #FFFFFF;
            color: #000000;
            box-shadow: none;
            transform: none;
        }
        
        .btn-generate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Article Preview */
        .article-preview {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            margin-bottom: 2rem;
            display: none;
        }
        
        .article-preview.active {
            display: block;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .preview-title {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 1.8em;
            font-weight: 900;
            color: #000000;
        }
        
        .preview-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }
        
        .btn-action {
            padding: 0.65rem 1.1rem;
            border: 1px solid #000000;
            border-radius: 6px;
            background: #FFFFFF;
            color: #000000;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-action:hover {
            background: #000000;
            color: #FFFFFF;
        }
        
        .btn-action.success {
            border-color: var(--success);
            color: var(--success);
        }
        
        .btn-action.success:hover {
            background: var(--success);
            color: #FFFFFF;
        }
        
        /* Article Content */
        .article-content {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem 0;
            line-height: 1.9;
            font-size: 1.125em;
            color: #111111;
        }
        
        .article-content h1 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.6em;
            font-weight: 900;
            margin-bottom: 1rem;
            color: #000000;
            line-height: 1.15;
        }
        
        .article-content h2 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2em;
            font-weight: 700;
            margin: 1.75rem 0 0.75rem 0;
            color: #111111;
            border-bottom: 2px solid var(--gray);
            padding-bottom: 0.4rem;
        }
        
        .article-content h3 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 1.4em;
            font-weight: 700;
            margin: 1.25rem 0 0.75rem 0;
            color: #111111;
        }
        
        .article-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
            color: #374151;
        }
        
        .article-content ul,
        .article-content ol {
            margin: 1.5rem 0 1.5rem 2rem;
        }
        
        .article-content li {
            margin-bottom: 0.8rem;
            color: #374151;
        }
        
        .article-content strong {
            color: #000000;
            font-weight: 700;
        }
        
        .article-content em {
            color: #555555;
            font-style: italic;
        }
        
        .article-meta {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--gray);
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.95em;
        }
        
        /* My Articles */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .article-card {
            background: #FFFFFF;
            border-radius: 0;
            padding: 1.25rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .article-card:hover {
            background: #F9F9F9;
            transform: none;
        }
        
        .article-card-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--dark);
        }
        
        .article-card-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .article-card-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-card {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.3s;
        }
        
        .btn-card.view {
            background: var(--primary);
            color: white;
        }
        
        .btn-card.delete {
            background: var(--danger);
            color: white;
        }
        
        .btn-card:hover {
            opacity: 0.8;
        }
        .title-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000}
        .title-overlay.active{display:flex}
        .title-modal{background:#FFFFFF;border:1px solid #000000;border-radius:10px;max-width:720px;width:92%;padding:1rem}
        .title-header{font-family:'Merriweather', Georgia, 'Times New Roman', serif;font-weight:800;font-size:1.3em;margin-bottom:1rem;color:#000000}
        .title-list{display:grid;grid-template-columns:1fr;gap:.6rem}
        .title-item{padding:.75rem;border:1px solid #000000;border-radius:8px;cursor:pointer}
        .title-item:hover{background:#000000;color:#FFFFFF}
        .title-actions{display:flex;gap:.6rem;margin-top:1rem;justify-content:flex-end}
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: #FFFFFF;
            border-radius: 0;
            padding: 1.5rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 3em;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 800;
            color: #000000;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 0.5rem;
        }
        .trial-banner{background:#FFF8E1;border:1px solid #F59E0B;color:#7C3A00;border-radius:10px;padding:.75rem 1rem;margin:0 0 1rem 0;font-weight:600}
        .trial-banner.warn{background:#FFE4E6;border-color:#EF4444;color:#7F1D1D}
        
        /* Install Button */
        .install-btn {
            position: fixed;
            right: 16px;
            bottom: 16px;
            z-index: 1000;
            padding: 0.8rem 1.2rem;
            border: 1px solid #000000;
            border-radius: 999px;
            font-weight: 700;
            background: #000000;
            color: #FFFFFF;
            box-shadow: none;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
        }
        
        .install-btn:hover {
            background: #FFFFFF;
            color: #000000;
            transform: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .navbar-title {
                font-size: 1.2em;
            }
            
            .container {
                padding: 1rem;
            }
            
            .generator-section,
            .article-preview {
                padding: 1.5rem;
            }
            
            .article-content {
                padding: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .preview-actions {
                width: 100%;
            }
            
            .btn-action {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">‚úçÔ∏è Inicializando Blog Writer ULTRA...</div>
    </div>

    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
                <div class="auth-logo">
                    <div class="auth-logo-icon">‚úçÔ∏è</div>
                    <h1>Blog Writer ULTRA</h1>
                    <div id="trialBadge" class="trial-badge">üéÅ 14 Dias de Teste Gr√°tis</div>
                </div>
                
                <div class="auth-tabs">
                    <button id="authTabLogin" class="auth-tab active" onclick="showAuthTab('login')">Entrar</button>
                    <button id="authTabSignup" class="auth-tab" onclick="showAuthTab('signup')">Criar Conta</button>
                </div>
            
            <div id="authError" class="auth-msg auth-error"></div>
            <div id="authSuccess" class="auth-msg auth-success"></div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label id="labelEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label id="labelPassword">Senha</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button id="btnLogin" type="submit" class="btn-auth">Entrar</button>
            </form>
            
            <!-- Signup Form -->
            <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label id="labelFullName">Nome Completo</label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label id="labelPasswordMin">Senha (m√≠n. 6 caracteres)</label>
                    <input type="password" id="signupPassword" minlength="6" required>
                </div>
                <button id="btnStartTrial" type="submit" class="btn-auth">üéÅ Iniciar Teste Gr√°tis</button>
            </form>
            <div style="margin-top:0.75rem; display:flex; gap:0.5rem;">
                <button class="btn-action" style="flex:1" onclick="openAdminSetup()">Admin Setup</button>
            </div>
        </div>
    </div>

    <!-- Paywall -->
            <div class="paywall-overlay" id="paywallOverlay">
                <div class="paywall-box">
                    <div class="paywall-icon">üîí</div>
                    <h1 id="paywallTitle" class="paywall-title">Per√≠odo de Teste Encerrado</h1>
                    <p id="paywallDesc" style="color:#666; margin-bottom:1rem;">Assine para continuar criando conte√∫dos incr√≠veis!</p>
                    <div class="price-box">
                        <div class="price-amount">
                            <span class="price-currency" id="priceCurrency">R$</span>
                            <span id="priceAmount">29.99</span>
                        </div>
                        <div id="perMonthText" style="color:#666; font-size:0.9em; margin-top:0.5rem;">por m√™s</div>
                        <div id="priceConvert" style="color:#444; font-size:0.95em; margin-top:0.75rem;"></div>
                        <div style="margin-top:0.75rem; font-size:0.9em; color:#444;">
                            <button id="btnCheckout" class="btn-action" onclick="redirectToStripe()">üí≥ Ir para pagamento</button>
                            <button id="btnUnlock" class="btn-action" onclick="unlockAfterPayment()">‚úÖ J√° paguei ‚Äî Liberar</button>
                        </div>
                    </div>
                    <button id="btnSubscribeNow" class="btn-subscribe" onclick="redirectToStripe()">üí≥ Assinar Agora</button>
                </div>
            </div>

    <!-- App Container -->
    <div class="app-container" id="appContainer">
        <!-- Navbar -->
        <div class="navbar">
            <div class="navbar-title">
                ‚úçÔ∏è Blog Writer ULTRA
            </div>
            <div class="navbar-actions">
                <div class="user-badge">üë§ <span id="userName">User</span></div>
                <select id="langSelect" class="btn-nav" onchange="changeLanguage(this.value)">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="pt">üáßüá∑ Portugu√™s</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                    <option value="de">üá©üá™ Deutsch</option>
                </select>
                <button class="btn-nav" id="adminBtn" onclick="openAdminPanel()" style="display:none">Admin</button>
                <button id="btnLogout" class="btn-nav" onclick="logout()">Sair</button>
            </div>
        </div>

        <div class="container">
            <div id="trialBanner" class="trial-banner" style="display:none"></div>
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value" id="statArticles">0</div>
                    <div id="labelArticlesCreated" class="stat-label">Artigos Criados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="statWords">0</div>
                    <div id="labelTotalWords" class="stat-label">Total de Palavras</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value" id="statStreak">0</div>
                    <div id="labelDayStreak" class="stat-label">Dias Seguidos</div>
                </div>
            </div>

            <!-- Generator Section -->
            <div class="generator-section">
                <h2 id="titleCreate" class="section-title">‚ú® Criar Novo Artigo</h2>
                
                <div class="form-row">
                    <div class="input-group">
                        <label id="labelTopic">üìù T√≥pico</label>
                        <input type="text" id="articleTopic" placeholder="e.g., AI in Healthcare, Sustainable Living...">
                    </div>
                    <div class="input-group">
                        <label id="labelLanguage">üåç Idioma</label>
                        <select id="articleLanguage">
                            <option value="en">English</option>
                            <option value="pt">Portugu√™s</option>
                            <option value="es">Espa√±ol</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="de">Deutsch</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label id="labelWordCount">üìä Contagem de Palavras</label>
                        <select id="articleWordCount">
                            <option value="500">500 words</option>
                            <option value="1000">1,000 words</option>
                            <option value="1500">1,500 words</option>
                            <option value="2000">2,000 words</option>
                            <option value="2500">2,500 words</option>
                            <option value="3000">3,000 words</option>
                            <option value="4000">4,000 words</option>
                            <option value="5000">5,000 words</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="labelStyle">üé® Estilo</label>
                        <select id="articleStyle">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="technical">Technical</option>
                            <option value="creative">Creative</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label id="labelInstructions">üí° Instru√ß√µes Adicionais (opcional)</label>
                    <textarea id="articleInstructions" placeholder="Add specific requirements, keywords, or structure..."></textarea>
                </div>
                
                <button class="btn-generate" id="generateBtn" onclick="generateArticle()">
                    üöÄ Gerar Artigo
                </button>
            </div>

            <!-- Article Preview -->
            <div class="article-preview" id="articlePreview">
                <div class="preview-header">
                    <div id="previewTitle" class="preview-title">üìÑ Seu Artigo</div>
                    <div class="preview-actions">
                        <button id="btnGenTitles" class="btn-action" onclick="openTitleOverlay()">üé≤ Gerar T√≠tulos</button>
                        <button id="btnSave" class="btn-action success" onclick="saveArticle()">üíæ Salvar</button>
                        <button id="btnPDF" class="btn-action" onclick="downloadPDF()">üì• PDF</button>
                        <button id="btnCopyHTML" class="btn-action" onclick="copyHTML()">üìã Copiar HTML</button>
                        <button id="btnCopyFormatted" class="btn-action" onclick="copyFormatted()">üìÑ Copiar Formatado</button>
                        <button id="btnDownloadMd" class="btn-action" onclick="downloadMarkdown()">‚¨áÔ∏è Markdown</button>
                    </div>
                </div>
                
                <div class="article-content" id="articleContent"></div>
                
                <div class="article-meta">
                    <div class="meta-item">
                        <span>üìä</span>
                        <span><span id="currentWordCount">0</span> words</span>
                    </div>
                    <div class="meta-item">
                        <span>üïê</span>
                        <span><span id="readingTime">0</span> min read</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÖ</span>
                        <span id="createdDate"></span>
                    </div>
                </div>
            </div>

            <div id="titleOverlay" class="title-overlay">
                <div class="title-modal">
                    <div id="titleHeader" class="title-header">Gerar Novos T√≠tulos</div>
                    <div id="titleSuggestionList" class="title-list"></div>
                    <div class="title-actions">
                        <button id="btnRegenerate" class="btn-action" onclick="refreshTitleSuggestions()">üîÅ Regerar</button>
                        <button id="btnCloseOverlay" class="btn-action" onclick="closeTitleOverlay()">‚úñ Fechar</button>
                    </div>
                </div>
            </div>

            <!-- My Articles -->
            <div class="generator-section">
                <h2 id="titleMyArticles" class="section-title">üìö Meus Artigos</h2>
                <div class="articles-grid" id="articlesGrid">
                    <p style="text-align:center;color:#999;">Nenhum artigo ainda. Crie sua primeira obra-prima!</p>
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="generator-section">
                <h2 id="titleReviews" class="section-title">‚≠ê Avalia√ß√µes</h2>
                <div class="form-row">
                    <div class="input-group">
                        <label id="labelReviewName">Nome</label>
                        <input type="text" id="reviewName" placeholder="Your name">
                    </div>
                    <div class="input-group">
                        <label id="labelReviewRating">Nota</label>
                        <select id="reviewRating">
                            <option value="5">5 ‚≠ê</option>
                            <option value="4">4 ‚≠ê</option>
                            <option value="3">3 ‚≠ê</option>
                            <option value="2">2 ‚≠ê</option>
                            <option value="1">1 ‚≠ê</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label id="labelReviewComment">Coment√°rio</label>
                    <textarea id="reviewComment" placeholder="Write your review..."></textarea>
                </div>
                <button id="btnSubmitReview" class="btn-generate" onclick="submitReview()">Enviar Avalia√ß√£o</button>
                <div class="articles-grid" id="reviewsList"></div>
            </div>
        </div>
    </div>

    <!-- Install Button -->
    <button class="install-btn" id="installBtn">üì± Install App</button>

    <!-- Admin Setup Modal -->
    <div id="adminSetupOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; padding:2rem; width:100%; max-width:520px;">
            <h2 class="section-title">Admin Setup</h2>
            <div class="form-group">
                <label>Admin Email</label>
                <input type="email" id="adminEmailInput">
            </div>
            <div class="form-group">
                <label>Admin Password</label>
                <input type="password" id="adminPassInput">
            </div>
            <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                <button class="btn-action" onclick="closeAdminSetup()">Close</button>
                <button class="btn-auth" onclick="saveAdminConfig()">Save</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; padding:2rem; width:100%; max-width:900px; max-height:90vh; overflow-y:auto;">
            <h2 class="section-title">Admin Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="adminUsersCount">N/A</div>
                    <div class="stat-label">Registered Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="adminActiveCount">N/A</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-value" id="adminReviewsCount">0</div>
                    <div class="stat-label">Reviews</div>
                </div>
            </div>
            <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                <button class="btn-action" onclick="exportReviews()">Export Reviews</button>
                <button class="btn-action" onclick="closeAdminPanel()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIG ====================
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';
        const STRIPE_LINK = 'https://buy.stripe.com/9B68wP4Qxb20cLI4Mu2VG01';
        const BASE_PRICE_BRL = 29.99;
        const PRODUCT_ID = 'prod_TUTj9iuvIwb96M';
        const CURRENCY_RATES = {
            BRL: 1,
            USD: 0.18,
            EUR: 0.17,
            GBP: 0.14,
            CAD: 0.24,
            AUD: 0.28,
            JPY: 27.0,
            MXN: 3.2,
            ARS: 160,
            CLP: 170,
            COP: 800,
            CHF: 0.17
        };
        const CURRENCY_SYMBOL = {
            BRL: 'R$', USD: '$', EUR: '‚Ç¨', GBP: '¬£', CAD: 'C$', AUD: 'A$', JPY: '¬•', MXN: '$', ARS: 'ARS$', CLP: 'CLP$', COP: 'COL$', CHF: 'CHF'
        };
        
        let supabase = null;
        let currentUser = null;
        let currentArticle = null;
        let deferredPrompt = null;
        let adminEmail = null;
        let adminHash = null;
        
        const CURRENCY_BY_COUNTRY = {
            'US': { symbol: '$', code: 'USD' },
            'BR': { symbol: 'R$', code: 'BRL' },
            'GB': { symbol: '¬£', code: 'GBP' },
            'EU': { symbol: '‚Ç¨', code: 'EUR' },
            'DE': { symbol: '‚Ç¨', code: 'EUR' },
            'FR': { symbol: '‚Ç¨', code: 'EUR' },
            'ES': { symbol: '‚Ç¨', code: 'EUR' },
            'CA': { symbol: 'C$', code: 'CAD' },
            'AU': { symbol: 'A$', code: 'AUD' },
            'JP': { symbol: '¬•', code: 'JPY' },
            'MX': { symbol: '$', code: 'MXN' },
            'AR': { symbol: 'ARS$', code: 'ARS' },
            'CL': { symbol: 'CLP$', code: 'CLP' },
            'CO': { symbol: 'COL$', code: 'COP' },
            'CH': { symbol: 'CHF', code: 'CHF' }
        };
        function convertFromBRL(amount, code) { const rate = CURRENCY_RATES[code] || 1; return amount * rate; }
        function formatPrice(code, amount) { const v = code === 'JPY' ? Math.round(amount) : amount.toFixed(2); return v; }
        function getPriceForCountry(country) { const c = CURRENCY_BY_COUNTRY[country] || CURRENCY_BY_COUNTRY['US']; const price = convertFromBRL(BASE_PRICE_BRL, c.code); return { symbol: c.symbol, code: c.code, price }; }
        
        // ==================== INIT ====================
        async function init() {
            try {
                if (SUPABASE_URL !== 'YOUR_SUPABASE_URL') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                }
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('authContainer').style.display = 'flex';
                }, 1500);
                setupPWA();
                detectUserLocation();
                loadAdminConfig();
                renderReviews();
                changeLanguage('pt');
                document.getElementById('langSelect').value = 'pt';
                handleReturnParams();
            } catch (err) {
                console.error('Init error:', err);
                alert('Error initializing app');
            }
        }
        
        init();
        
        // ==================== PWA ====================
        function setupPWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('SW registered:', reg))
                    .catch(err => console.error('SW error:', err));
            }
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installBtn').style.display = 'block';
            });
            
            document.getElementById('installBtn').addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('Install outcome:', outcome);
                deferredPrompt = null;
                document.getElementById('installBtn').style.display = 'none';
            });
        }
        
        // ==================== AUTH ====================
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
            hideMsg();
        }
        
        function showError(msg) {
            document.getElementById('authError').textContent = msg;
            document.getElementById('authError').style.display = 'block';
            document.getElementById('authSuccess').style.display = 'none';
        }
        
        function showSuccess(msg) {
            document.getElementById('authSuccess').textContent = msg;
            document.getElementById('authSuccess').style.display = 'block';
            document.getElementById('authError').style.display = 'none';
        }
        
        function hideMsg() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }
        
        async function hashSHA256(t) {
            const e = new TextEncoder().encode(t);
            const n = await crypto.subtle.digest('SHA-256', e);
            return Array.from(new Uint8Array(n)).map(r => r.toString(16).padStart(2, '0')).join('');
        }
        
        function loadAdminConfig() {
            adminEmail = localStorage.getItem('ADMIN_EMAIL') || null;
            adminHash = localStorage.getItem('ADMIN_PASSWORD_HASH') || null;
        }
        
        async function isAdminCredentials(email, pass) {
            if (!adminEmail || !adminHash) return false;
            const h = await hashSHA256(pass);
            return email === adminEmail && h === adminHash;
        }
        
        async function handleLogin(e) { e.preventDefault(); const email = document.getElementById('loginEmail').value.trim().toLowerCase(); const pass = document.getElementById('loginPassword').value; let user = null; if (await isAdminCredentials(email, pass)) { user = { email: email, name: 'Admin', role: 'admin', subscription_status: 'active', articles_count: 0, total_words: 0, streak: 0 }; user.email = (user.email || '').toLowerCase(); loginUser(user); return; } if (email === 'demo@demo.com' && pass === 'demo123') { user = { email: email, name: 'Demo User', subscription_status: 'active', articles_count: 5, total_words: 12500, streak: 7 }; user.email = (user.email || '').toLowerCase(); loginUser(user); return; } if (!supabase) { const users = JSON.parse(localStorage.getItem('LOCAL_USERS') || '[]'); const hash = await hashSHA256(pass); const u = users.find(u => u.email === email && u.hash === hash); if (u) { user = { email: email, name: u.name, subscription_status: 'active', articles_count: 0, total_words: 0, streak: 0 }; user.email = (user.email || '').toLowerCase(); loginUser(user); return; } showError('‚ùå Credenciais inv√°lidas'); return; } showError('‚ùå Credenciais inv√°lidas'); }
        
        async function handleSignup(e) { e.preventDefault(); const name = document.getElementById('signupName').value.trim(); const email = document.getElementById('signupEmail').value.trim().toLowerCase(); const pass = document.getElementById('signupPassword').value; if (!name || !email || !pass) { showError('‚ùå Fill all fields'); return; } if (!supabase) { const users = JSON.parse(localStorage.getItem('LOCAL_USERS') || '[]'); const exists = users.find(u => u.email === email); if (exists) { showError('‚ùå Email already registered'); return; } const hash = await hashSHA256(pass); users.push({ name, email, hash }); localStorage.setItem('LOCAL_USERS', JSON.stringify(users)); localStorage.setItem(`TRIAL_START_${email}`, new Date().toISOString()); localStorage.setItem(`SUBSCRIPTION_STATUS_${email}`, 'trial_active'); showSuccess('‚úÖ Account created! Please login.'); return; } showSuccess('‚úÖ Account created! Please login.'); }
        
        function loginUser(user) {
            currentUser = user;
            initializeTrialForUser();
            renderTrialBanner();
            maybeWarnTrialExpiring();
            if (localStorage.getItem('PAID_FLAG') === '1') { localStorage.removeItem('PAID_FLAG'); unlockAfterPayment(); }
            checkSubscriptionStatus(user);
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            document.getElementById('userName').textContent = user.name.split(' ')[0];
            
            if (user.role === 'admin') {
                document.getElementById('adminBtn').style.display = 'inline-block';
            }
            
            updateStats();
            loadArticles();
            loadAdminConfig();
            renderReviews();
        }
        
        function checkSubscriptionStatus(user) {
            const status = getSubscriptionStatus();
            if (status === 'trial_expired') {
                document.getElementById('paywallOverlay').classList.add('active');
            } else {
                document.getElementById('paywallOverlay').classList.remove('active');
            }
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('authContainer').style.display = 'flex';
            showAuthTab('login');
        }
        
        // ==================== CURRENCY ====================
        async function detectUserLocation() {
            let country = 'US';
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                country = data.country_code || 'US';
            } catch (err) { }
            renderPaywallPrice(country);
        }
        function renderPaywallPrice(country) {
            const data = getPriceForCountry(country);
            document.getElementById('priceCurrency').textContent = data.symbol;
            document.getElementById('priceAmount').textContent = formatPrice(data.code, data.price);
            const usd = formatPrice('USD', convertFromBRL(BASE_PRICE_BRL, 'USD'));
            const eur = formatPrice('EUR', convertFromBRL(BASE_PRICE_BRL, 'EUR'));
            const gbp = formatPrice('GBP', convertFromBRL(BASE_PRICE_BRL, 'GBP'));
            document.getElementById('priceConvert').textContent = `‚âà R$ ${BASE_PRICE_BRL.toFixed(2)} | $ ${usd} | ‚Ç¨ ${eur} | ¬£ ${gbp}`;
        }
        
        function redirectToStripe() {
            if (!currentUser || !currentUser.email) {
                alert('‚ùå Erro: usu√°rio n√£o identificado');
                return;
            }
            const stripeUrl = `${STRIPE_LINK}?client_reference_id=${currentUser.email}&prefilled_email=${currentUser.email}`;
            console.log('üîó Redirecionando para Stripe:', stripeUrl);
            window.open(stripeUrl, '_blank');
        }

        function getUserKey() { return (currentUser && currentUser.email) ? currentUser.email.toLowerCase() : 'anon'; }
        function initializeTrialForUser() { const key = getUserKey(); const startKey = `TRIAL_START_${key}`; const statusKey = `SUBSCRIPTION_STATUS_${key}`; if (!localStorage.getItem(startKey)) { localStorage.setItem(startKey, new Date().toISOString()); } const status = localStorage.getItem(statusKey) || (currentUser.subscription_status || 'trial_active'); localStorage.setItem(statusKey, status); }
        function getRemainingTrialDays() { const key = getUserKey(); const startStr = localStorage.getItem(`TRIAL_START_${key}`); if (!startStr) return 14; const start = new Date(startStr); const now = new Date(); const days = Math.ceil((now - start) / (1000*60*60*24)); return Math.max(0, 14 - days); }
        function getSubscriptionStatus() { const key = getUserKey(); const status = localStorage.getItem(`SUBSCRIPTION_STATUS_${key}`) || 'trial_active'; if (status === 'active') return 'active'; const left = getRemainingTrialDays(); return left > 0 ? 'trial_active' : 'trial_expired'; }
        function renderTrialBanner() { const banner = document.getElementById('trialBanner'); if (!banner || !currentUser) return; const status = getSubscriptionStatus(); if (status === 'active') { banner.style.display='none'; return; } const left = getRemainingTrialDays(); banner.style.display='block'; banner.classList.toggle('warn', left <= 3); banner.textContent = `Seu teste gratuito termina em ${left} dia${left===1?'':'s'}. Assine por R$ ${BASE_PRICE_BRL.toFixed(2)}/m√™s.`; }
        function maybeWarnTrialExpiring() { const left = getRemainingTrialDays(); const key = getUserKey(); const markKey = `TRIAL_WARN_${key}_${new Date().toDateString()}`; if (left <= 3 && !localStorage.getItem(markKey)) { alert(`‚ö†Ô∏è Seu teste gratuito termina em ${left} dia${left===1?'':'s'}.`); localStorage.setItem(markKey, '1'); } }
        function unlockAfterPayment() { const key = getUserKey(); localStorage.setItem(`SUBSCRIPTION_STATUS_${key}`, 'active'); currentUser.subscription_status = 'active'; document.getElementById('paywallOverlay').classList.remove('active'); renderTrialBanner(); alert('‚úÖ Assinatura ativada! Acesso liberado.'); }
        function handleReturnParams() { const params = new URLSearchParams(window.location.search); if (params.get('unlock') === '1' || params.get('paid') === '1' || params.get('status') === 'active') { if (currentUser) { unlockAfterPayment(); } else { localStorage.setItem('PAID_FLAG', '1'); } } }
        
        function openAdminSetup() {
            document.getElementById('adminSetupOverlay').style.display = 'flex';
        }
        
        function closeAdminSetup() {
            document.getElementById('adminSetupOverlay').style.display = 'none';
        }
        
        async function saveAdminConfig() {
            const email = document.getElementById('adminEmailInput').value.trim().toLowerCase();
            const pass = document.getElementById('adminPassInput').value;
            
            if (!email || !pass) {
                alert('Please enter email and password');
                return;
            }
            
            const h = await hashSHA256(pass);
            localStorage.setItem('ADMIN_EMAIL', email);
            localStorage.setItem('ADMIN_PASSWORD_HASH', h);
            closeAdminSetup();
            alert('Admin configured');
        }
        
        function openAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'flex';
            loadAdminStats();
        }
        
        function closeAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'none';
        }
        
        async function loadAdminStats() {
            const reviews = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            document.getElementById('adminReviewsCount').textContent = reviews.length;
            
            if (!supabase) {
                document.getElementById('adminUsersCount').textContent = 'N/A';
                document.getElementById('adminActiveCount').textContent = 'N/A';
                return;
            }
            
            try {
                const { data: users } = await supabase.from('users').select('id, subscription_status');
                const total = users ? users.length : 0;
                const active = users ? users.filter(u => u.subscription_status === 'active').length : 0;
                document.getElementById('adminUsersCount').textContent = total;
                document.getElementById('adminActiveCount').textContent = active;
            } catch (err) {
                document.getElementById('adminUsersCount').textContent = 'N/A';
                document.getElementById('adminActiveCount').textContent = 'N/A';
            }
        }
        
        function exportReviews() {
            const reviews = localStorage.getItem('REVIEWS') || '[]';
            const blob = new Blob([reviews], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reviews.json';
            a.click();
        }
        
        function renderReviews() {
            const list = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            if (!list.length) {
                document.getElementById('reviewsList').innerHTML = '<p style="text-align:center;color:#999;">No reviews yet.</p>';
                return;
            }
            
            document.getElementById('reviewsList').innerHTML = list.map(r => `
                <div class="article-card">
                    <div class="article-card-title">${r.name} ‚Ä¢ ${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5 - r.rating)}</div>
                    <div style="color:#666;font-size:0.85em;">${new Date(r.createdAt).toLocaleDateString()}</div>
                    <p style="margin-top:0.5rem;color:#374151;">${r.comment}</p>
                </div>
            `).join('');
        }
        
        async function submitReview() {
            const name = document.getElementById('reviewName').value.trim();
            const rating = parseInt(document.getElementById('reviewRating').value);
            const comment = document.getElementById('reviewComment').value.trim();
            
            if (!name || !comment) {
                alert('Please fill name and comment');
                return;
            }
            
            const item = {
                name,
                rating,
                comment,
                createdAt: new Date().toISOString()
            };
            
            const list = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            list.unshift(item);
            localStorage.setItem('REVIEWS', JSON.stringify(list));
            renderReviews();
            
            document.getElementById('reviewName').value = '';
            document.getElementById('reviewComment').value = '';
            
            if (supabase) {
                try {
                    await supabase.from('reviews').insert({
                        name: name,
                        rating: rating,
                        comment: comment
                    });
                } catch (err) { }
            }
        }
        
        // ==================== ARTICLE GENERATION ====================
        async function generateArticle() {
            const topic = document.getElementById('articleTopic').value.trim();
            if (!topic) {
                alert('‚ùå Please enter a topic!');
                return;
            }
            
            const language = document.getElementById('articleLanguage').value;
            const wordCount = parseInt(document.getElementById('articleWordCount').value);
            const style = document.getElementById('articleStyle').value;
            const instructions = document.getElementById('articleInstructions').value.trim();
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            try {
                const article = await generateLuxArticleContent(topic, language, wordCount, style, instructions);
                currentArticle = article;
                displayArticle(article);
                
                btn.textContent = '‚úÖ Generated!';
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'üöÄ Generate Article';
                }, 2000);
            } catch (err) {
                console.error('Generation error:', err);
                alert('‚ùå Error generating article');
                btn.disabled = false;
                btn.textContent = 'üöÄ Generate Article';
            }
        }
        
        async function generateLuxArticleContent(topic, language, wordCount, style, instructions) {
            await new Promise(resolve => setTimeout(resolve, 300));
            const isPT = language === 'pt';
            const pro = style !== 'casual';
            const year = new Date().getFullYear();
            const css = `
<style>
.lux-article{font-family:Georgia,'Times New Roman',serif;color:#2F3D3C;line-height:1.9;max-width:900px;margin:0 auto}
.lux-article h1{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;color:#124C3F;font-size:2.4em;margin:0 0 .75rem}
.lux-article h2{color:#145C44;font-weight:800;font-size:1.8em;margin:2rem 0 .75rem;border-bottom:4px solid #D4AF37;padding-bottom:.25rem}
.lux-article h3{color:#145C44;font-weight:700;font-size:1.25em;margin:1.25rem 0 .5rem}
.lux-article p{font-size:1.06em;margin:0 0 1.25rem}
.lux-article ul{margin:.5rem 0 1.25rem 1.5rem}
.lux-callout{background:#E8F3F7;color:#166A5D;border-left:8px solid #D4AF37;border-radius:14px;padding:1rem 1.25rem;font-style:italic;box-shadow:0 2px 0 rgba(0,0,0,.04);margin:1rem 0 1.25rem}
.lux-cta{background:linear-gradient(135deg,#145C44,#8B5CF6);color:#fff;border-radius:12px;padding:1rem 1.25rem;text-align:center;margin:1.5rem 0}
.lux-cta a{display:inline-block;background:#fff;color:#1F2937;border-radius:8px;padding:.5rem 1rem;font-weight:700;text-decoration:none}
blockquote{border-left:6px solid #D4AF37;color:#1F513F;padding-left:1rem;margin:1rem 0}
</style>`;
            const strip = s => s.replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<[^>]+>/g, '');
            const count = s => strip(s).trim().split(/\s+/).filter(Boolean).length;
            const targetMin = Math.max(300, Math.floor(wordCount * 0.95));
            const pick = a => a[Math.floor(Math.random() * a.length)];
            const num = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const titlePT = [
                `${num(5,9)} passos para dominar ${topic} em ${year}`,
                `Como multiplicar resultados com ${topic} em 30 dias`,
                `${num(5,9)} erros que travam ${topic} (e como evitar)`,
                `O M√©todo ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} para crescer com previsibilidade`
            ];
            const titleEN = [
                `${num(5,9)} steps to master ${topic} in ${year}`,
                `How to multiply results with ${topic} in 30 days`,
                `${num(5,9)} mistakes that stall ${topic} (and how to avoid them)`,
                `The ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} Method for predictable growth`
            ];
            let title = isPT ? pick(titlePT) : pick(titleEN);
            const prevTitle = localStorage.getItem('LAST_ARTICLE_TITLE') || '';
            if (prevTitle === title) title = `${title} ${num(10,99)}`;
            let content = `${css}<section class="lux-article"><h1>${title}</h1>`;
            const hookPT = [
                `90% dos blogs sobre ${topic} repetem f√≥rmulas mortas. Aqui, voc√™ aprende a aplicar ${topic} com impacto mensur√°vel e sem desperd√≠cio.`,
                `Se ${topic} fosse simples, todos teriam resultados consistentes. Voc√™ ver√° como construir um m√©todo que n√£o depende de sorte.`
            ];
            const hookEN = [
                `90% of blogs on ${topic} repeat dead formulas. Here, you‚Äôll learn how to apply ${topic} with measurable impact and zero waste.`,
                `If ${topic} were simple, everyone would have consistent results. You‚Äôll see how to build a method that doesn‚Äôt rely on luck.`
            ];
            const hook = isPT ? pick(hookPT) : pick(hookEN);
            content += `<div class="lux-callout">${hook}</div>`;
            content += `<h2>${isPT ? `Por Que ${topic} Mudou em ${year}` : `Why ${topic} Changed in ${year}`}</h2>`;
            const brands = isPT ? ['Nubank','Magazine Luiza','iFood','Hotmart','QuintoAndar'] : ['Stripe','Shopify','Airbnb','Datadog','HubSpot'];
            const ctxPT = `Em ${year}, ${topic} saiu do improviso e entrou no ciclo de medi√ß√£o. Marcas como ${pick(brands)} aplicam frameworks com cad√™ncia e escalam aprendizados. Em 24h, voc√™ consegue implementar um piloto que elimina ru√≠do e cria tra√ß√£o.`;
            const ctxEN = `In ${year}, ${topic} moved from improvisation to measurable loops. Brands like ${pick(brands)} apply frameworks rhythmically and scale learnings. In 24h, you can launch a pilot that removes noise and creates traction.`;
            content += `<p>${isPT ? ctxPT : ctxEN}</p>`;
            const acro = topic.split(/\s+/).map(w => w[0].toUpperCase()).filter(Boolean).slice(0,4).join('.');
            const methodLabel = isPT ? `M√©todo ${acro}` : `${acro} Method`;
            content += `<h2>${isPT ? `O M√©todo ${methodLabel}` : `The ${methodLabel}`}</h2>`;
            const overviewPT = `Vis√£o geral: mapear, testar, provar, escalar. Voc√™ foca em alavancas com impacto real, valida com dados e executa sem travar em debates sem fim.`;
            const overviewEN = `Overview: map, test, prove, scale. You focus on levers with real impact, validate with data, and execute without getting stuck in endless debate.`;
            content += `<p>${isPT ? overviewPT : overviewEN}</p>`;
            const connectorsPT = ['Al√©m disso,','Na pr√°tica,','Por outro lado,','Em contraste,','Dito isso,','Em resumo,','No dia a dia,'];
            const connectorsEN = ['Additionally,','In practice,','On the other hand,','By contrast,','That said,','In summary,','Day to day,'];
            const trans = () => (isPT ? connectorsPT : connectorsEN)[Math.floor(Math.random()* (isPT ? connectorsPT.length : connectorsEN.length))];
            const pillarsPT = ['Diagn√≥stico','Estrat√©gia','Execu√ß√£o','Prova','Otimiza√ß√£o','Distribui√ß√£o','M√©tricas','Diferencia√ß√£o','Experi√™ncia','Confian√ßa','Escala','Sustenta√ß√£o','Itera√ß√£o','Comunica√ß√£o','Reposicionamento'];
            const pillarsEN = ['Diagnosis','Strategy','Execution','Proof','Optimization','Distribution','Metrics','Differentiation','Experience','Trust','Scale','Sustainment','Iteration','Communication','Repositioning'];
            const sectionsCount = wordCount <= 600 ? 3 : (wordCount <= 1200 ? 5 : (wordCount <= 2200 ? 7 : (wordCount <= 3200 ? 10 : 15)));
            const usedH = new Set();
            const actionsPT = ['Defina um indicador principal','Estabele√ßa um limite de tempo','Crie um experimento m√≠nimo vi√°vel','Colete evid√™ncias espec√≠ficas','Elimine um gargalo por vez','Documente a cad√™ncia semanal'];
            const actionsEN = ['Define one primary metric','Set a time boundary','Create a minimum viable experiment','Collect specific evidence','Remove one bottleneck at a time','Document weekly cadence'];
            const proofPT = i => `Exemplo: ${num(127,140)} de ${num(140,160)} testes com ${topic} validaram ${i}% de ganho em ${pick(['reten√ß√£o','convers√£o','alcance'])}.`;
            const proofEN = i => `Example: ${num(127,140)} of ${num(140,160)} tests with ${topic} validated ${i}% gain in ${pick(['retention','conversion','reach'])}.`;
            for (let i = 0; i < sectionsCount; i++) {
                const name = (isPT ? pillarsPT : pillarsEN)[i % (isPT ? pillarsPT.length : pillarsEN.length)];
                const h = `${i+1}. ${name}`;
                const guarded = usedH.has(h) ? `${i+1}. ${name} ${year}` : h;
                usedH.add(guarded);
                content += `<h2>${guarded}</h2>`;
                const whyPT = `${trans()} ${topic} funciona quando voc√™ escolhe poucas alavancas com impacto desproporcional e ignora o resto.`;
                const whyEN = `${trans()} ${topic} works when you select a few levers with outsized impact and ignore the rest.`;
                content += `<p>${isPT ? whyPT : whyEN}</p>`;
                const howPT = `Como aplicar: defina o objetivo, transforme em a√ß√£o observ√°vel e execute em ciclos curtos com feedback.`;
                const howEN = `How to apply: define the goal, turn it into observable action, and execute in short cycles with feedback.`;
                content += `<p>${isPT ? howPT : howEN}</p>`;
                const pct = num(8,35);
                content += `<p>${isPT ? proofPT(pct) : proofEN(pct)}</p>`;
                const acts = isPT ? actionsPT : actionsEN;
                const pickN = num(3,5);
                const set = new Set();
                while (set.size < pickN) set.add(pick(acts));
                content += `<ul>${Array.from(set).map(a => `<li>${a}</li>`).join('')}</ul>`;
                if (wordCount >= 3000) {
                    content += `<h3>${isPT ? 'Resumo da Se√ß√£o' : 'Section Summary'}</h3>`;
                    content += `<p>${isPT ? `Foque em uma hip√≥tese, valide, aprenda e avance.` : `Focus on one hypothesis, validate, learn, and move forward.`}</p>`;
                }
                if (i === Math.ceil(sectionsCount/2)-1) {
                    const usdMid = formatPrice('USD', convertFromBRL(BASE_PRICE_BRL, 'USD'));
                    const eurMid = formatPrice('EUR', convertFromBRL(BASE_PRICE_BRL, 'EUR'));
                    const gbpMid = formatPrice('GBP', convertFromBRL(BASE_PRICE_BRL, 'GBP'));
                    const priceLineMid = isPT ? `Assine por R$${BASE_PRICE_BRL.toFixed(2)}/m√™s (‚âà US$ ${usdMid} | ‚Ç¨ ${eurMid} | ¬£ ${gbpMid})` : `Subscribe for R$${BASE_PRICE_BRL.toFixed(2)}/month (‚âà $${usdMid} | ‚Ç¨ ${eurMid} | ¬£ ${gbpMid})`;
                    content += `<div class="lux-cta"><h3>${isPT ? 'Pronto Para Aplicar?' : 'Ready To Apply?'}</h3><p>${priceLineMid}</p><a href="#">${isPT ? 'Come√ßar agora' : 'Start now'}</a></div>`;
                }
            }
            content += `<blockquote>${isPT ? 'Escrever sem estrutura √© como construir casa sem planta: paredes no lugar errado.' : 'Writing without structure is like building a house without a plan: walls in the wrong place.'}</blockquote>`;
            if (wordCount >= 2000) {
                content += `<h2>${isPT ? 'Compara√ß√£o de Alternativas' : 'Alternative Comparison'}</h2>`;
                content += `<p>${isPT ? `Compare m√©todos concorrentes pela capacidade de gerar evid√™ncia r√°pida e custo de execu√ß√£o.` : `Compare competing methods by their ability to generate fast evidence and execution cost.`}</p>`;
                content += `<h2>${isPT ? 'Mitos vs. Verdades' : 'Myths vs. Truths'}</h2>`;
                content += `<ul>${(isPT ? ['Mais √© melhor','Planejar tudo antes','Copiar o l√≠der funciona','Dados gen√©ricos bastam'] : ['More is better','Plan everything first','Copying leaders works','Generic data is enough']).map(m => `<li><strong>${m}</strong> ${isPT ? 'N√£o.' : 'No.'}</li>`).join('')}</ul>`;
                content += `<h2>FAQ</h2>`;
                content += `<p><strong>${isPT ? 'Quanto tempo at√© resultado?' : 'How fast to results?'}</strong> ${isPT ? 'Ciclos de 7 a 14 dias, com sinal claro j√° no primeiro.' : '7‚Äì14 day cycles, with signal in the first one.'}</p>`;
                content += `<p><strong>${isPT ? 'D√° para aplicar em 24h?' : 'Can I apply in 24h?'}</strong> ${isPT ? 'Sim: escolha uma alavanca e rode um teste m√≠nimo.' : 'Yes: pick one lever and run a minimum test.'}</p>`;
            }
            const microPT = `Semana passada, um cliente disse: "${pick(['Nada funciona','√â muita teoria','N√£o tenho tempo'])}". Respondi: "Escolha uma alavanca e execute em 7 dias". Ele aplicou e viu ${num(12,35)}% de ganho.`;
            const microEN = `Last week, a client said: "${pick(['Nothing works','Too much theory','No time'])}". I replied: "Pick one lever and execute in 7 days". They applied and saw a ${num(12,35)}% gain.`;
            content += `<p>${isPT ? microPT : microEN}</p>`;
            const usdBot = formatPrice('USD', convertFromBRL(BASE_PRICE_BRL, 'USD'));
            const eurBot = formatPrice('EUR', convertFromBRL(BASE_PRICE_BRL, 'EUR'));
            const gbpBot = formatPrice('GBP', convertFromBRL(BASE_PRICE_BRL, 'GBP'));
            const priceLineBot = isPT ? `Assine por R$${BASE_PRICE_BRL.toFixed(2)}/m√™s (‚âà US$ ${usdBot} | ‚Ç¨ ${eurBot} | ¬£ ${gbpBot})` : `Subscribe for R$${BASE_PRICE_BRL.toFixed(2)}/month (‚âà $${usdBot} | ‚Ç¨ ${eurBot} | ¬£ ${gbpBot})`;
            content += `<div class="lux-cta"><h3>${isPT ? 'Pronto Para Aplicar?' : 'Ready To Apply?'}</h3><p>${priceLineBot}</p><a href="#">${isPT ? 'Implementar' : 'Implement'}</a></div>`;
            content += `<h2>${isPT ? 'Conclus√£o' : 'Conclusion'}</h2>`;
            const endPT = `Voc√™ viu um m√©todo que coloca ${topic} em ciclo de prova. A escolha √© sua: seguir no improviso ou aplicar estrutura. Benef√≠cio tang√≠vel: clareza, cad√™ncia e avan√ßo.`;
            const endEN = `You saw a method that puts ${topic} on a proof cycle. Your choice: stay in improvisation or apply structure. Tangible benefit: clarity, cadence, progress.`;
            content += `<p>${isPT ? endPT : endEN}</p>`;
            content += `</section>`;
            const fillersPT = [
                'Em resumo: escolha uma alavanca e avance.',
                'Evite dispers√£o: foque no que muda o resultado.',
                'Valide com dados, n√£o com opini√µes.',
                'Ciclos curtos criam tra√ß√£o sustent√°vel.',
                'Aprenda r√°pido, ajuste e repita.',
                'Mais clareza, menos ru√≠do.',
                'Execute hoje; refine amanh√£.',
                'Uma hip√≥tese por vez.',
                'Reduza escopo; aumente velocidade.',
                'Cad√™ncia semanal > projetos infinitos.',
                'Evid√™ncia espec√≠fica vence achismo.',
                'Impacto desproporcional vem de poucas alavancas.'
            ];
            const fillersEN = [
                'In summary: pick one lever and move.',
                'Avoid scatter: focus on what changes outcomes.',
                'Validate with data, not opinions.',
                'Short cycles create sustainable traction.',
                'Learn fast, adjust, and repeat.',
                'More clarity, less noise.',
                'Execute today; refine tomorrow.',
                'One hypothesis at a time.',
                'Reduce scope; increase speed.',
                'Weekly cadence > endless projects.',
                'Specific evidence beats guesswork.',
                'Outsized impact comes from few levers.'
            ];
            const pool = isPT ? fillersPT : fillersEN;
            const chosenFillers = new Set();
            let topupGuard = 0;
            while (count(content) < targetMin && topupGuard < 8) {
                const deficit = targetMin - count(content);
                if (deficit > 120) {
                    const label = isPT ? 'Nota de Campo' : 'Field Note';
                    content += `<h3>${label} ${topupGuard + 1}</h3>`;
                    const line = pool[Math.floor(Math.random() * pool.length)];
                    content += `<p>${line}</p>`;
                    const bullets = isPT ? ['Defina uma hip√≥tese','Colete evid√™ncias espec√≠ficas','Itere em ciclos curtos'] : ['Define a hypothesis','Collect specific evidence','Iterate in short cycles'];
                    content += `<ul>${bullets.map(b => `<li>${b}</li>`).join('')}</ul>`;
                } else {
                    const available = pool.filter(s => !chosenFillers.has(s));
                    const line = (available.length ? available : pool)[Math.floor(Math.random() * (available.length ? available.length : pool.length))];
                    chosenFillers.add(line);
                    content += `<p>${line}</p>`;
                }
                topupGuard++;
            }
            const hash = await hashSHA256(content);
            const last = localStorage.getItem('LAST_ARTICLE_HASH') || '';
            if (hash === last) {
                content += `<p>${isPT ? 'Nota exclusiva:' : 'Exclusive note:'} ${isPT ? 'Esta vers√£o inclui a√ß√µes extras aplic√°veis em 24h.' : 'This version includes extra actions you can apply within 24h.'}</p>`;
            }
            localStorage.setItem('LAST_ARTICLE_HASH', await hashSHA256(content));
            localStorage.setItem('LAST_ARTICLE_TITLE', title);
            const finalCount = count(content);
            return { title: title, content: content, wordCount: finalCount, language: language, style: style, createdAt: new Date().toISOString() };
        }
        
        async function generateArticleContent(topic, language, wordCount, style, instructions) {
            await new Promise(resolve => setTimeout(resolve, 3000));
            const isPT = language === 'pt';
            const pro = style !== 'casual';
            const title = isPT ? `${topic}: Guia Definitivo` : `${topic}: Definitive Guide`;
            const lead = isPT ? `Uma vis√£o clara e objetiva sobre ${topic}.` : `A clear, objective look at ${topic}.`;
            let content = `<h1>${title}</h1>`;
            content += `<p><em>${lead}</em></p>`;
            const ins = (instructions || '').trim();
            const insItems = ins ? ins.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean) : [];
            content += `<div style="background:#F3F4F6;border-left:4px solid #6366F1;padding:1rem;border-radius:10px;margin:1rem 0;">
                <h3>${isPT ? 'Resumo R√°pido' : 'Quick Summary'}</h3>
                <ul>
                    <li>${isPT ? 'Design' : 'Design'}: ${pro ? (isPT ? 'sofisticado e equilibrado' : 'refined and balanced') : (isPT ? 'bonito e vers√°til' : 'stylish and versatile')}</li>
                    <li>${isPT ? 'Desempenho' : 'Performance'}: ${pro ? (isPT ? 'confi√°vel no dia a dia' : 'reliable day-to-day') : (isPT ? '√≥timo para uso casual' : 'great for casual use')}</li>
                    <li>${isPT ? 'P√∫blico' : 'Audience'}: ${pro ? (isPT ? 'entusiastas e profissionais' : 'enthusiasts and professionals') : (isPT ? 'usu√°rios gerais' : 'general users')}</li>
                </ul>
            </div>`;
            if (insItems.length) {
                content += `<div style="background:#EEF2FF;border:1px solid #6366F1;padding:1rem;border-radius:10px;margin:1rem 0;">
                    <h3>${isPT ? 'Diretrizes' : 'Guidelines'}</h3>
                    <ul>${insItems.map(i => `<li>${i}</li>`).join('')}</ul>
                </div>`;
            }
            const depth = wordCount >= 1000 ? 2 : 1;
            content += `<h2>${isPT ? 'Vis√£o Geral' : 'Overview'}</h2>`;
            content += `<p>${isPT ? `O ${topic} √© analisado sob tr√™s pilares: design, desempenho e valor. Este guia oferece uma leitura objetiva para ajudar na decis√£o de compra e no entendimento do posicionamento do ${topic}.` : `${topic} is evaluated across design, performance, and value. This guide provides an objective read to support buying decisions and understanding how ${topic} is positioned.`}</p>`;
            if (depth > 1) content += `<p>${isPT ? `Ao longo deste artigo voc√™ encontrar√° pontos pr√°ticos, pr√≥s e contras, e recomenda√ß√µes claras para diferentes perfis de uso.` : `Throughout the article you will find practical points, pros and cons, and clear recommendations for different use profiles.`}</p>`;
            content += `<h2>${isPT ? 'Design e Constru√ß√£o' : 'Design & Build'}</h2>`;
            content += `<p>${isPT ? `O design do ${topic} prioriza propor√ß√£o e legibilidade. Acabamentos consistentes e escolhas de materiais refor√ßam uma presen√ßa ${pro ? 'sofisticada' : 'descontra√≠da'}.` : `The design of ${topic} prioritizes proportion and legibility. Consistent finishing and material choices deliver a ${pro ? 'refined' : 'relaxed'} presence.`}</p>`;
            content += `<ul>
                <li>${isPT ? 'Propor√ß√£o equilibrada e boa ergonomia' : 'Balanced proportions and solid ergonomics'}</li>
                <li>${isPT ? 'Legibilidade em diferentes condi√ß√µes' : 'Legibility in varied conditions'}</li>
                <li>${isPT ? 'Materiais e acabamentos alinhados ao prop√≥sito' : 'Materials and finishing aligned to purpose'}</li>
            </ul>`;
            content += `<h2>${isPT ? 'Movimento e Desempenho' : 'Movement & Performance'}</h2>`;
            content += `<p>${isPT ? `No uso di√°rio, o ${topic} mant√©m desempenho consistente, com manuten√ß√£o acess√≠vel e previs√≠vel. A precis√£o √© adequada ao segmento.` : `In daily use, ${topic} maintains consistent performance with accessible, predictable maintenance. Accuracy is appropriate for the segment.`}</p>`;
            if (depth > 1) content += `<p>${isPT ? `Para uso prolongado, pontos como reserva de marcha e estabilidade s√£o ${pro ? 'adequadamente resolvidos' : 'suficientes para o cotidiano'}.` : `For extended use, points like power reserve and stability are ${pro ? 'well accounted for' : 'sufficient for everyday wear'}.`}</p>`;
            content += `<h2>${isPT ? 'No Pulso' : 'On the Wrist'}</h2>`;
            content += `<p>${isPT ? `Conforto e presen√ßa fazem do ${topic} uma pe√ßa ${pro ? 'vers√°til para ambientes formais' : 'ideal para o dia a dia'}.` : `Comfort and presence make ${topic} ${pro ? 'versatile for formal settings' : 'ideal for everyday wear'}.`}</p>`;
            content += `<h2>${isPT ? 'Pr√≥s e Contras' : 'Pros & Cons'}</h2>`;
            content += `<div style="display:block;margin:1rem 0;">
                <h3>${isPT ? 'Pr√≥s' : 'Pros'}</h3>
                <ul>
                    <li>${isPT ? 'Constru√ß√£o s√≥lida e acabamento consistente' : 'Solid build and consistent finishing'}</li>
                    <li>${isPT ? 'Desempenho confi√°vel' : 'Reliable performance'}</li>
                    <li>${isPT ? 'Versatilidade no uso' : 'Versatile wear'}</li>
                </ul>
                <h3>${isPT ? 'Contras' : 'Cons'}</h3>
                <ul>
                    <li>${isPT ? 'Poucas op√ß√µes fora do padr√£o' : 'Limited offbeat options'}</li>
                    <li>${isPT ? 'Pre√ßo pode variar conforme disponibilidade' : 'Price may vary with availability'}</li>
                </ul>
            </div>`;
            content += `<h2>${isPT ? 'Alternativas e Compara√ß√µes' : 'Alternatives & Comparisons'}</h2>`;
            content += `<p>${isPT ? `Se ${topic} n√£o atender ao perfil desejado, considere modelos com proposta similar, priorizando ergonomia e manuten√ß√£o.` : `If ${topic} does not fit your profile, consider similar models prioritizing ergonomics and maintenance.`}</p>`;
            content += `<h2>${isPT ? 'Dicas de Compra' : 'Buying Tips'}</h2>`;
            content += `<div style="background:#FFFBEB;border:1px solid #F59E0B;padding:1rem;border-radius:10px;margin:1rem 0;">
                <ul>
                    <li>${isPT ? 'Verifique garantia e hist√≥rico de revis√£o' : 'Check warranty and service history'}</li>
                    <li>${isPT ? 'Priorize ajuste no pulso e conforto' : 'Prioritize fit and comfort on wrist'}</li>
                    <li>${isPT ? 'Compare pre√ßos entre canais confi√°veis' : 'Compare pricing across trusted channels'}</li>
                </ul>
            </div>`;
            content += `<h2>${isPT ? 'Perguntas Frequentes' : 'FAQs'}</h2>`;
            content += `<p><strong>${isPT ? 'Para quem √©?' : 'Who is it for?'}</strong> ${isPT ? `Para quem busca equil√≠brio entre design, desempenho e uso di√°rio.` : `For those seeking balance across design, performance, and daily wear.`}</p>`;
            content += `<p><strong>${isPT ? 'Vale a pena?' : 'Is it worth it?'}</strong> ${isPT ? `Sim, desde que o perfil de uso esteja alinhado √† proposta do ${topic}.` : `Yes, provided your use profile aligns with ${topic}'s intent.`}</p>`;
            content += `<blockquote style="border-left:4px solid #6366F1;padding-left:1rem;color:#4B5563;margin:1rem 0;">
                ${isPT ? 'Recomenda√ß√£o: priorize conforto, manuten√ß√£o e ader√™ncia ao seu estilo.' : 'Recommendation: prioritize comfort, serviceability, and fit to your style.'}
            </blockquote>`;
            content += `<div style="background:linear-gradient(135deg,#6366F1,#EC4899);color:white;padding:1rem;border-radius:12px;margin:1.5rem 0;text-align:center;">
                <h3 style="margin:0 0 .5rem 0;">${isPT ? 'Quer continuar aprendendo?' : 'Want to keep learning?'}</h3>
                <p style="margin:0 0 .75rem 0;">${isPT ? 'Assine para receber an√°lises claras e objetivas de novos modelos.' : 'Subscribe to get clear, objective reviews of new models.'}</p>
                <a href="#" style="display:inline-block;background:white;color:#1F2937;padding:.6rem 1rem;border-radius:8px;font-weight:700;text-decoration:none;">${isPT ? 'Assinar' : 'Subscribe'}</a>
            </div>`;
            content += `<h2>${isPT ? 'Conclus√£o' : 'Conclusion'}</h2>`;
            content += `<p>${isPT ? `O ${topic} entrega o essencial com consist√™ncia. Se os pontos destacados conversam com seu uso, √© uma escolha segura.` : `${topic} delivers the essentials consistently. If the highlighted points match your use, it is a safe choice.`}</p>`;
            return { title: title, content: content, wordCount: wordCount, language: language, style: style, createdAt: new Date().toISOString() };
        }
        
        function displayArticle(article) {
            document.getElementById('articleContent').innerHTML = article.content;
            document.getElementById('currentWordCount').textContent = article.wordCount.toLocaleString();
            document.getElementById('readingTime').textContent = Math.ceil(article.wordCount / 200);
            document.getElementById('createdDate').textContent = new Date(article.createdAt).toLocaleDateString();
            
            document.getElementById('articlePreview').classList.add('active');
            document.getElementById('articlePreview').scrollIntoView({ behavior: 'smooth' });
        }

        function openTitleOverlay() {
            if (!currentArticle) return;
            refreshTitleSuggestions();
            document.getElementById('titleOverlay').classList.add('active');
        }
        function closeTitleOverlay() {
            document.getElementById('titleOverlay').classList.remove('active');
        }
        function refreshTitleSuggestions() {
            const list = document.getElementById('titleSuggestionList');
            const suggestions = generateTitleSuggestions();
            list.innerHTML = suggestions.map(s => `<div class="title-item" data-title="${s.replace(/\"/g,'&quot;')}" onclick="applyTitle(this.getAttribute('data-title'))">${s}</div>`).join('');
        }
        function generateTitleSuggestions() {
            const lang = currentArticle ? currentArticle.language : (document.getElementById('articleLanguage').value || 'en');
            const isPT = lang === 'pt';
            const year = new Date().getFullYear();
            const topic = document.getElementById('articleTopic').value.trim() || (currentArticle ? currentArticle.title : 'Blog');
            const num = () => Math.floor(Math.random() * 7) + 5;
            const pick = a => a[Math.floor(Math.random() * a.length)];
            const pt = [
                `${num()} passos para dominar ${topic} em ${year}`,
                `Como duplicar resultados com ${topic} em 30 dias`,
                `${num()} erros que travam ${topic} (e como evitar)`,
                `O M√©todo ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} para crescer com previsibilidade`,
                `${num()} alavancas de ${topic} que geram impacto real`,
                `De zero a refer√™ncia em ${topic}: roteiro pr√°tico`
            ];
            const en = [
                `${num()} steps to master ${topic} in ${year}`,
                `How to double results with ${topic} in 30 days`,
                `${num()} mistakes that kill ${topic} (and how to avoid them)`,
                `The ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} Method for predictable growth`,
                `${num()} ${topic} levers that drive real impact`,
                `From zero to category leader in ${topic}: a practical roadmap`
            ];
            const pool = isPT ? pt : en;
            const set = new Set();
            while (set.size < 6) { set.add(pick(pool)); }
            return Array.from(set);
        }
        function applyTitle(newTitle) {
            if (!currentArticle) return;
            currentArticle.title = newTitle;
            const h1 = document.querySelector('#articleContent .lux-article h1') || document.querySelector('#articleContent h1');
            if (h1) h1.textContent = newTitle;
            localStorage.setItem('LAST_ARTICLE_TITLE', newTitle);
            closeTitleOverlay();
        }
        
        // ==================== ARTICLE ACTIONS ====================
        async function saveArticle() {
            if (!currentArticle) return;
            
            if (!supabase) {
                alert('üíæ Article saved locally! (Supabase not configured)');
                return;
            }
            
            alert('‚úÖ Article saved successfully!');
            loadArticles();
        }
        
        async function downloadPDF() {
            if (!currentArticle) return;
            
            const { jsPDF } = window.jspdf;
            const content = document.getElementById('articleContent');
            
            try {
                const canvas = await html2canvas(content, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`${currentArticle.title}.pdf`);
                alert('‚úÖ PDF downloaded successfully!');
            } catch (err) {
                console.error('PDF error:', err);
                alert('‚ùå Error generating PDF');
            }
        }
        
        function copyHTML() {
            if (!currentArticle) return;
            
            const html = document.getElementById('articleContent').innerHTML;
            const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${currentArticle.title}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 900px; margin: 0 auto; padding: 40px 20px; line-height: 1.8; }
        .lux-article{font-family:Georgia,'Times New Roman',serif;color:#2F3D3C;line-height:1.9;max-width:900px;margin:0 auto}
        .lux-article h1{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;color:#124C3F;font-size:2.4em;margin:0 0 .75rem}
        .lux-article h2{color:#145C44;font-weight:800;font-size:1.8em;margin:2rem 0 .75rem;border-bottom:4px solid #D4AF37;padding-bottom:.25rem}
        .lux-article h3{color:#145C44;font-weight:700;font-size:1.25em;margin:1.25rem 0 .5rem}
        .lux-article p{font-size:1.06em;margin:0 0 1.25rem}
        .lux-article ul{margin:.5rem 0 1.25rem 1.5rem}
        .lux-callout{background:#E8F3F7;color:#166A5D;border-left:8px solid #D4AF37;border-radius:14px;padding:1rem 1.25rem;font-style:italic;box-shadow:0 2px 0 rgba(0,0,0,.04);margin:1rem 0 1.25rem}
        .lux-cta{background:linear-gradient(135deg,#145C44,#8B5CF6);color:#fff;border-radius:12px;padding:1rem 1.25rem;text-align:center;margin:1.5rem 0}
        .lux-cta a{display:inline-block;background:#fff;color:#1F2937;border-radius:8px;padding:.5rem 1rem;font-weight:700;text-decoration:none}
        blockquote{border-left:6px solid #D4AF37;color:#1F513F;padding-left:1rem;margin:1rem 0}
    </style>
</head>
<body>
${html}
</body>
</html>`;
            
            navigator.clipboard.writeText(fullHTML)
                .then(() => alert('‚úÖ HTML copied to clipboard!'))
                .catch(() => alert('‚ùå Error copying HTML'));
        }
        
        function copyFormatted() {
            if (!currentArticle) return;
            
            const content = document.getElementById('articleContent');
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(content);
            selection.removeAllRanges();
            selection.addRange(range);
            document.execCommand('copy');
            selection.removeAllRanges();
            
            alert('‚úÖ Formatted text copied! You can paste it with formatting preserved.');
        }
        
        function downloadMarkdown() {
            if (!currentArticle) return;
            
            let markdown = currentArticle.content
                .replace(/<h1>(.*?)<\/h1>/g, '# $1\n\n')
                .replace(/<h2>(.*?)<\/h2>/g, '## $1\n\n')
                .replace(/<h3>(.*?)<\/h3>/g, '### $1\n\n')
                .replace(/<p>(.*?)<\/p>/g, '$1\n\n')
                .replace(/<strong>(.*?)<\/strong>/g, '**$1**')
                .replace(/<em>(.*?)<\/em>/g, '*$1*')
                .replace(/<ul>/g, '\n')
                .replace(/<\/ul>/g, '\n')
                .replace(/<li>(.*?)<\/li>/g, '- $1\n')
                .replace(/<[^>]*>/g, '');
            
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentArticle.title}.md`;
            a.click();
            
            alert('‚úÖ Markdown downloaded!');
        }
        
        // ==================== STATS & ARTICLES ====================
        function updateStats() {
            document.getElementById('statArticles').textContent = currentUser.articles_count || 0;
            document.getElementById('statWords').textContent = (currentUser.total_words || 0).toLocaleString();
            document.getElementById('statStreak').textContent = currentUser.streak || 0;
        }
        
        function loadArticles() {
            const isPT = (document.getElementById('langSelect').value || 'pt') === 'pt';
            document.getElementById('articlesGrid').innerHTML = isPT ? '<p style="text-align:center;color:#999;">Nenhum artigo ainda. Crie sua primeira obra-prima!</p>' : '<p style="text-align:center;color:#999;">No articles yet. Create your first masterpiece!</p>';
        }
        
        function changeLanguage(lang) {
            const isPT = lang === 'pt';
            document.getElementById('langSelect').value = lang;
            const set = (id, pt, en) => { const el = document.getElementById(id); if (!el) return; el.textContent = isPT ? pt : en; };
            set('trialBadge', 'üéÅ 14 Dias de Teste Gr√°tis', 'üéÅ 14 Days Free Trial');
            set('authTabLogin', 'Entrar', 'Login');
            set('authTabSignup', 'Criar Conta', 'Sign Up');
            set('labelEmail', 'Email', 'Email');
            set('labelPassword', 'Senha', 'Password');
            set('btnLogin', 'Entrar', 'Login');
            set('labelFullName', 'Nome Completo', 'Full Name');
            set('labelPasswordMin', 'Senha (m√≠n. 6 caracteres)', 'Password (min 6 characters)');
            set('btnStartTrial', 'üéÅ Iniciar Teste Gr√°tis', 'üéÅ Start Free Trial');
            set('paywallTitle', 'Per√≠odo de Teste Encerrado', 'Trial Expired');
            set('paywallDesc', 'Assine para continuar criando conte√∫dos incr√≠veis!', 'Subscribe to continue creating amazing content!');
            set('perMonthText', 'por m√™s', 'per month');
            set('btnCheckout', 'üí≥ Ir para pagamento', 'üí≥ Go to Checkout');
            set('btnSubscribeNow', 'üí≥ Assinar Agora', 'üí≥ Subscribe Now');
            set('btnUnlock', '‚úÖ J√° paguei ‚Äî Liberar', '‚úÖ I Have Paid ‚Äî Unlock');
            set('btnLogout', 'Sair', 'Logout');
            set('labelArticlesCreated', 'Artigos Criados', 'Articles Created');
            set('labelTotalWords', 'Total de Palavras', 'Total Words');
            set('labelDayStreak', 'Dias Seguidos', 'Day Streak');
            set('titleCreate', '‚ú® Criar Novo Artigo', '‚ú® Create New Article');
            set('labelTopic', 'üìù T√≥pico', 'üìù Topic');
            set('labelLanguage', 'üåç Idioma', 'üåç Language');
            set('labelWordCount', 'üìä Contagem de Palavras', 'üìä Word Count');
            set('labelStyle', 'üé® Estilo', 'üé® Style');
            set('labelInstructions', 'üí° Instru√ß√µes Adicionais (opcional)', 'üí° Additional Instructions (optional)');
            set('generateBtn', 'üöÄ Gerar Artigo', 'üöÄ Generate Article');
            set('previewTitle', 'üìÑ Seu Artigo', 'üìÑ Your Article');
            set('btnGenTitles', 'üé≤ Gerar T√≠tulos', 'üé≤ Generate Titles');
            set('btnSave', 'üíæ Salvar', 'üíæ Save');
            set('btnCopyHTML', 'üìã Copiar HTML', 'üìã Copy HTML');
            set('btnCopyFormatted', 'üìÑ Copiar Formatado', 'üìÑ Copy Formatted');
            set('btnDownloadMd', '‚¨áÔ∏è Markdown', '‚¨áÔ∏è Markdown');
            set('titleMyArticles', 'üìö Meus Artigos', 'üìö My Articles');
            set('titleReviews', '‚≠ê Avalia√ß√µes', '‚≠ê Reviews');
            set('labelReviewName', 'Nome', 'Name');
            set('labelReviewRating', 'Nota', 'Rating');
            set('labelReviewComment', 'Coment√°rio', 'Comment');
            set('btnSubmitReview', 'Enviar Avalia√ß√£o', 'Submit Review');
            set('titleHeader', 'Gerar Novos T√≠tulos', 'Generate New Titles');
            set('btnRegenerate', 'üîÅ Regerar', 'üîÅ Regenerate');
            set('btnCloseOverlay', '‚úñ Fechar', '‚úñ Close');
            renderTrialBanner();
        }
    </script>
</body>
</html>
