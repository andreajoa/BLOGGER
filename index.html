<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366F1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Blog Writer">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
    <title>‚úçÔ∏è Blog Writer ULTRA - AI Content Generator</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #000000;
            --secondary: #555555;
            --success: #0A7F3B;
            --warning: #B86E00;
            --danger: #CC0000;
            --dark: #111111;
            --light: #FFFFFF;
            --gray: #E6E6E6;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #FFFFFF;
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Loading Screen */
        .loading {
            position: fixed;
            inset: 0;
            background: #FFFFFF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading-text {
            color: #000;
            font-size: 1.2em;
            margin-top: 1.5rem;
            font-weight: 600;
        }
        
        /* Auth Container */
        .auth-container {
            display: none;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #FFFFFF;
        }
        
        .auth-box {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            width: 100%;
            max-width: 520px;
            box-shadow: none;
            border: 1px solid var(--gray);
        }
        
        .auth-logo {
            text-align: left;
            margin-bottom: 1.25rem;
        }
        
        .auth-logo-icon {
            font-size: 4em;
            margin-bottom: 0.5rem;
        }
        
        .auth-logo h1 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.2em;
            font-weight: 900;
            color: #000000;
            background: none;
        }
        
        .trial-badge {
            background: #000000;
            color: #FFFFFF;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 700;
            display: inline-block;
        }
        
        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0 1.5rem 0;
            background: transparent;
            border-radius: 0;
            padding: 0;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.7rem;
            border: 1px solid #000000;
            background: #FFFFFF;
            cursor: pointer;
            font-weight: 600;
            border-radius: 6px;
            color: #000000;
            transition: all 0.2s;
        }
        
        .auth-tab.active {
            background: #000000;
            color: #FFFFFF;
            box-shadow: none;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            font-size: 0.95em;
            color: #000000;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid #000000;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
            background: #FFFFFF;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: none;
        }
        
        .btn-auth {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 700;
            background: #000000;
            color: #FFFFFF;
            font-size: 1.05em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-auth:hover {
            background: #FFFFFF;
            color: #000000;
        }
        
        .btn-auth:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .auth-msg {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9em;
            display: none;
            border: 1px solid var(--gray);
        }
        
        .auth-error {
            background: #FFFFFF;
            color: #CC0000;
            border-color: #CC0000;
        }
        
        .auth-success {
            background: #FFFFFF;
            color: #0A7F3B;
            border-color: #0A7F3B;
        }
        
        /* Paywall */
        .paywall-overlay {
            display: none;
            position: fixed;
            z-index: 9999;
            inset: 0;
            background: rgba(0,0,0,0.95);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .paywall-overlay.active {
            display: flex;
        }
        
        .paywall-box {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            max-width: 550px;
            width: 100%;
            text-align: center;
        }
        
        .paywall-icon {
            font-size: 5em;
            margin-bottom: 1rem;
        }
        
        .paywall-title {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #000000;
        }
        
        .price-box {
            background: #F0F0F0;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .price-amount {
            font-size: 3.5em;
            font-weight: 800;
            color: #000000;
        }
        
        .price-currency {
            font-size: 0.5em;
            opacity: 0.7;
        }
        
        .btn-subscribe {
            width: 100%;
            padding: 1rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1.05em;
            background: #000000;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-subscribe:hover {
            background: #FFFFFF;
            color: #000000;
        }
        
        /* App Container */
        .app-container {
            display: none;
            background: #FFFFFF;
            min-height: 100vh;
        }
        
        .app-container.active {
            display: block;
        }
        
        /* Navbar */
        .navbar {
            background: #FFFFFF;
            color: var(--dark);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--gray);
            box-shadow: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .ticker{position:sticky;top:0;z-index:1000;background:linear-gradient(90deg,#0F172A,#1E293B);color:#FFFFFF;border-bottom:1px solid rgba(255,255,255,.15)}
        .ticker-inner{display:flex;align-items:center;gap:.75rem;overflow:hidden;padding:.4rem .75rem}
        .ticker-track{display:inline-block;white-space:nowrap;animation:ticker-scroll 28s linear infinite;opacity:.92}
        .ticker-item{display:inline-block;margin-right:2rem;font-weight:600}
        .ticker-cta{margin-left:auto;background:#FFFFFF;color:#0F172A;border:1px solid #FFFFFF;border-radius:6px;padding:.35rem .7rem;font-weight:700;cursor:pointer}
        @keyframes ticker-scroll{0%{transform:translateX(0%)}100%{transform:translateX(-50%)}}
        
        .navbar-title {
            font-size: 1.4em;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .user-badge {
            background: #F0F0F0;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .btn-nav {
            background: #FFFFFF;
            border: 1px solid #000000;
            color: #000000;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-nav:hover {
            background: #000000;
            color: #FFFFFF;
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        /* Generator Section */
        .generator-section {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.2em;
            font-weight: 900;
            margin-bottom: 1.25rem;
            color: #000000;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 0.9rem;
            border: 2px solid var(--gray);
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #000000;
        }
        
        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn-generate {
            width: 100%;
            padding: 1rem;
            border: 1px solid #000000;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05em;
            background: #000000;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
        }
        
        .btn-generate:hover {
            background: #FFFFFF;
            color: #000000;
            box-shadow: none;
            transform: none;
        }
        
        .btn-generate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Article Preview */
        .article-preview {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            margin-bottom: 2rem;
            display: none;
        }
        
        .article-preview.active {
            display: block;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .preview-title {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 1.8em;
            font-weight: 900;
            color: #000000;
        }
        
        .preview-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }
        
        .btn-action {
            padding: 0.65rem 1.1rem;
            border: 1px solid #000000;
            border-radius: 6px;
            background: #FFFFFF;
            color: #000000;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-action:hover {
            background: #000000;
            color: #FFFFFF;
        }
        
        .btn-action.success {
            border-color: var(--success);
            color: var(--success);
        }
        
        .btn-action.success:hover {
            background: var(--success);
            color: #FFFFFF;
        }
        
        /* Article Content */
        .article-content {
            background: #FFFFFF;
            border-radius: 0;
            padding: 2rem 0;
            line-height: 1.9;
            font-size: 1.125em;
            color: #111111;
        }
        
        .article-content h1 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2.6em;
            font-weight: 900;
            margin-bottom: 1rem;
            color: #000000;
            line-height: 1.15;
        }
        
        .article-content h2 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 2em;
            font-weight: 700;
            margin: 1.75rem 0 0.75rem 0;
            color: #111111;
            border-bottom: 2px solid var(--gray);
            padding-bottom: 0.4rem;
        }
        
        .article-content h3 {
            font-family: 'Merriweather', Georgia, 'Times New Roman', serif;
            font-size: 1.4em;
            font-weight: 700;
            margin: 1.25rem 0 0.75rem 0;
            color: #111111;
        }
        
        .article-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
            color: #374151;
        }
        
        .article-content ul,
        .article-content ol {
            margin: 1.5rem 0 1.5rem 2rem;
        }
        
        .article-content li {
            margin-bottom: 0.8rem;
            color: #374151;
        }
        
        .article-content strong {
            color: #000000;
            font-weight: 700;
        }
        
        .article-content em {
            color: #555555;
            font-style: italic;
        }
        
        .article-meta {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--gray);
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.95em;
        }
        
        /* My Articles */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .article-card {
            background: #FFFFFF;
            border-radius: 0;
            padding: 1.25rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .article-card:hover {
            background: #F9F9F9;
            transform: none;
        }
        
        .article-card-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--dark);
        }
        
        .article-card-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .article-card-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-card {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.3s;
        }
        
        .btn-card.view {
            background: var(--primary);
            color: white;
        }
        
        .btn-card.delete {
            background: var(--danger);
            color: white;
        }
        
        .btn-card:hover {
            opacity: 0.8;
        }
        .title-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000}
        .title-overlay.active{display:flex}
        .title-modal{background:#FFFFFF;border:1px solid #000000;border-radius:10px;max-width:720px;width:92%;padding:1rem}
        .title-header{font-family:'Merriweather', Georgia, 'Times New Roman', serif;font-weight:800;font-size:1.3em;margin-bottom:1rem;color:#000000}
        .title-list{display:grid;grid-template-columns:1fr;gap:.6rem}
        .title-item{padding:.75rem;border:1px solid #000000;border-radius:8px;cursor:pointer}
        .title-item:hover{background:#000000;color:#FFFFFF}
        .title-actions{display:flex;gap:.6rem;margin-top:1rem;justify-content:flex-end}
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: #FFFFFF;
            border-radius: 0;
            padding: 1.5rem;
            border: 1px solid var(--gray);
            box-shadow: none;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 3em;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 800;
            color: #000000;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 0.5rem;
        }
        .trial-banner{background:#FFF8E1;border:1px solid #F59E0B;color:#7C3A00;border-radius:10px;padding:.75rem 1rem;margin:0 0 1rem 0;font-weight:600}
        .trial-banner.warn{background:#FFE4E6;border-color:#EF4444;color:#7F1D1D}
        
        /* Install Button */
.install-btn {
            position: fixed;
            right: 16px;
            bottom: 16px;
            z-index: 1000;
            padding: 0.8rem 1.2rem;
            border: 1px solid #000000;
            border-radius: 999px;
            font-weight: 700;
            background: #000000;
            color: #FFFFFF;
            box-shadow: none;
            cursor: pointer;
            transition: all 0.2s;
    display: inline-flex;
}
        
        .install-btn:hover {
            background: #FFFFFF;
            color: #000000;
            transform: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .navbar-title {
                font-size: 1.2em;
            }
            
            .container {
                padding: 1rem;
            }
            
            .generator-section,
            .article-preview {
                padding: 1.5rem;
            }
            
            .article-content {
                padding: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .preview-actions {
                width: 100%;
            }
            
            .btn-action {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="ticker" id="benefitsTicker" style="display:none">
        <div class="ticker-inner">
            <div class="ticker-track" id="benefitsTrack"></div>
            <button class="ticker-cta" onclick="redirectToStripe()" id="tickerCta">Assinar</button>
        </div>
    </div>
    <!-- Loading Screen -->
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">‚úçÔ∏è Inicializando Blog Writer ULTRA...</div>
    </div>

    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
                <div class="auth-logo">
                    <div class="auth-logo-icon">‚úçÔ∏è</div>
                    <h1>Blog Writer ULTRA</h1>
                    <div id="trialBadge" class="trial-badge">üéÅ 14 Dias de Teste Gr√°tis</div>
                </div>
                
                <div class="auth-tabs">
                    <button id="authTabLogin" class="auth-tab active" onclick="showAuthTab('login')">Entrar</button>
                    <button id="authTabSignup" class="auth-tab" onclick="showAuthTab('signup')">Criar Conta</button>
                </div>
            
            <div id="authError" class="auth-msg auth-error"></div>
            <div id="authSuccess" class="auth-msg auth-success"></div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label id="labelEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label id="labelPassword">Senha</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button id="btnLogin" type="submit" class="btn-auth">Entrar</button>
            </form>
            
            <!-- Signup Form -->
            <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label id="labelFullName">Nome Completo</label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label id="labelPasswordMin">Senha (m√≠n. 6 caracteres)</label>
                    <input type="password" id="signupPassword" minlength="6" required>
                </div>
                <button id="btnStartTrial" type="submit" class="btn-auth">üéÅ Iniciar Teste Gr√°tis</button>
            </form>
            <div style="margin-top:0.75rem; display:flex; gap:0.5rem;">
                <button class="btn-action" style="flex:1" onclick="openAdminSetup()">Admin Setup</button>
            </div>
        </div>
    </div>

    <!-- Paywall -->
            <div class="paywall-overlay" id="paywallOverlay">
                <div class="paywall-box">
                    <div class="paywall-icon">üîí</div>
                    <h1 id="paywallTitle" class="paywall-title">Per√≠odo de Teste Encerrado</h1>
                    <p id="paywallDesc" style="color:#666; margin-bottom:1rem;">Assine para continuar criando conte√∫dos incr√≠veis!</p>
                    <div class="price-box">
                        <div class="price-amount">
                            <span class="price-currency" id="priceCurrency">R$</span>
                            <span id="priceAmount">29.99</span>
                        </div>
                        <div id="perMonthText" style="color:#666; font-size:0.9em; margin-top:0.5rem;">por m√™s</div>
                        <div id="priceConvert" style="color:#444; font-size:0.95em; margin-top:0.75rem;"></div>
                        <div style="margin-top:0.75rem; font-size:0.9em; color:#444;">
                            <button id="btnCheckout" class="btn-action" onclick="redirectToStripe()">üí≥ Ir para pagamento</button>
                            <button id="btnUnlock" class="btn-action" onclick="unlockAfterPayment()">‚úÖ J√° paguei ‚Äî Liberar</button>
                        </div>
                    </div>
                    <button id="btnSubscribeNow" class="btn-subscribe" onclick="redirectToStripe()">üí≥ Assinar Agora</button>
                </div>
            </div>

    <!-- App Container -->
    <div class="app-container" id="appContainer">
        <!-- Navbar -->
        <div class="navbar">
            <div class="navbar-title">
                ‚úçÔ∏è Blog Writer ULTRA
            </div>
            <div class="navbar-actions">
                <div class="user-badge">üë§ <span id="userName">User</span></div>
                <select id="langSelect" class="btn-nav" onchange="changeLanguage(this.value)">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="pt">üáßüá∑ Portugu√™s</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                    <option value="de">üá©üá™ Deutsch</option>
                </select>
                <button class="btn-nav" id="adminBtn" onclick="openAdminPanel()" style="display:none">Admin</button>
                <button id="btnSubscribeTop" class="btn-nav" onclick="redirectToStripe()">Assinar</button>
                <button id="btnLogout" class="btn-nav" onclick="logout()">Sair</button>
            </div>
        </div>

        <div class="container">
            <div id="trialBanner" class="trial-banner" style="display:none"></div>
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value" id="statArticles">0</div>
                    <div id="labelArticlesCreated" class="stat-label">Artigos Criados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="statWords">0</div>
                    <div id="labelTotalWords" class="stat-label">Total de Palavras</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value" id="statStreak">0</div>
                    <div id="labelDayStreak" class="stat-label">Dias Seguidos</div>
                </div>
            </div>

            <!-- Generator Section -->
            <div class="generator-section">
                <h2 id="titleCreate" class="section-title">‚ú® Criar Novo Artigo</h2>
                
                <div class="form-row">
                    <div class="input-group">
                        <label id="labelTopic">üìù T√≥pico</label>
                        <input type="text" id="articleTopic" placeholder="e.g., AI in Healthcare, Sustainable Living...">
                    </div>
                    <div class="input-group">
                        <label id="labelLanguage">üåç Idioma</label>
                        <select id="articleLanguage">
                            <option value="en">English</option>
                            <option value="pt">Portugu√™s</option>
                            <option value="es">Espa√±ol</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="de">Deutsch</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label id="labelWordCount">üìä Contagem de Palavras</label>
                        <select id="articleWordCount">
                            <option value="500">500 words</option>
                            <option value="1000">1,000 words</option>
                            <option value="1500">1,500 words</option>
                            <option value="2000">2,000 words</option>
                            <option value="2500">2,500 words</option>
                            <option value="3000">3,000 words</option>
                            <option value="4000">4,000 words</option>
                            <option value="5000">5,000 words</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="labelStyle">üé® Estilo</label>
                        <select id="articleStyle">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="technical">Technical</option>
                            <option value="creative">Creative</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="labelAcademic">üéì Modo Acad√™mico (tese/doutorado)</label>
                        <select id="academicMode"><option value="off">Off</option><option value="on">On</option></select>
                    </div>
                    <div class="input-group">
                        <label id="labelSourceType">üìö Tipo de Fonte</label>
                        <select id="sourceType">
                            <option value="book">Livro</option>
                            <option value="article">Artigo</option>
                            <option value="conference">Confer√™ncia</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="labelCitationStyle">üìù Estilo de Cita√ß√£o</label>
                        <select id="citationStyle">
                            <option value="abnt">ABNT</option>
                            <option value="apa">APA</option>
                            <option value="mla">MLA</option>
                            <option value="chicago">Chicago</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="labelAcademicLevel">üè∑Ô∏è N√≠vel Acad√™mico</label>
                        <select id="academicLevel">
                            <option value="undergrad">Gradua√ß√£o</option>
                            <option value="masters">Mestrado</option>
                            <option value="phd">Doutorado</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label id="labelInstructions">üí° Instru√ß√µes Adicionais (opcional)</label>
                    <textarea id="articleInstructions" placeholder="Add specific requirements, keywords, or structure..."></textarea>
                </div>
                <div class="input-group">
                    <label id="labelReferences">üìë Bibliografia (opcional)</label>
                    <textarea id="referencesInput" placeholder="Autor; Ano; T√≠tulo; Cidade; Editora; Revista; Volume; N√∫mero; P√°ginas; DOI/Link\nUm por linha"></textarea>
                </div>
                
                <button class="btn-generate" id="generateBtn" onclick="generateArticle()">
                    üöÄ Gerar Artigo
                </button>
            </div>

            <!-- Article Preview -->
            <div class="article-preview" id="articlePreview">
                <div class="preview-header">
                    <div id="previewTitle" class="preview-title">üìÑ Seu Artigo</div>
                    <div class="preview-actions">
                        <button id="btnGenTitles" class="btn-action" onclick="openTitleOverlay()">üé≤ Gerar T√≠tulos</button>
                        <button id="btnSave" class="btn-action success" onclick="saveArticle()">üíæ Salvar</button>
                        <button id="btnPDF" class="btn-action" onclick="downloadPDF()">üì• PDF</button>
                        <button id="btnCopyHTML" class="btn-action" onclick="copyHTML()">üìã Copiar HTML</button>
                        <button id="btnCopyFormatted" class="btn-action" onclick="copyFormatted()">üìÑ Copiar Formatado</button>
                        <button id="btnDownloadMd" class="btn-action" onclick="downloadMarkdown()">‚¨áÔ∏è Markdown</button>
                    </div>
                </div>
                
                <div class="article-content" id="articleContent"></div>
                
                <div class="article-meta">
                    <div class="meta-item">
                        <span>üìä</span>
                        <span><span id="currentWordCount">0</span> words</span>
                    </div>
                    <div class="meta-item">
                        <span>üïê</span>
                        <span><span id="readingTime">0</span> min read</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÖ</span>
                        <span id="createdDate"></span>
                    </div>
                </div>
            </div>

            <div id="titleOverlay" class="title-overlay">
                <div class="title-modal">
                    <div id="titleHeader" class="title-header">Gerar Novos T√≠tulos</div>
                    <div id="titleSuggestionList" class="title-list"></div>
                    <div class="title-actions">
                        <button id="btnRegenerate" class="btn-action" onclick="refreshTitleSuggestions()">üîÅ Regerar</button>
                        <button id="btnCloseOverlay" class="btn-action" onclick="closeTitleOverlay()">‚úñ Fechar</button>
                    </div>
                </div>
            </div>

            <!-- My Articles -->
            <div class="generator-section">
                <h2 id="titleMyArticles" class="section-title">üìö Meus Artigos</h2>
                <div class="articles-grid" id="articlesGrid">
                    <p style="text-align:center;color:#999;">Nenhum artigo ainda. Crie sua primeira obra-prima!</p>
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="generator-section">
                <h2 id="titleReviews" class="section-title">‚≠ê Avalia√ß√µes</h2>
                <div class="form-row">
                    <div class="input-group">
                        <label id="labelReviewName">Nome</label>
                        <input type="text" id="reviewName" placeholder="Your name">
                    </div>
                    <div class="input-group">
                        <label id="labelReviewRating">Nota</label>
                        <select id="reviewRating">
                            <option value="5">5 ‚≠ê</option>
                            <option value="4">4 ‚≠ê</option>
                            <option value="3">3 ‚≠ê</option>
                            <option value="2">2 ‚≠ê</option>
                            <option value="1">1 ‚≠ê</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label id="labelReviewComment">Coment√°rio</label>
                    <textarea id="reviewComment" placeholder="Write your review..."></textarea>
                </div>
                <button id="btnSubmitReview" class="btn-generate" onclick="submitReview()">Enviar Avalia√ß√£o</button>
                <div class="articles-grid" id="reviewsList"></div>
            </div>
        </div>
    </div>

    <!-- Install Button -->
    <button class="install-btn" id="installBtn">üì± Install App</button>
    <div id="installGuideOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10002;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; border-radius:12px; padding:1.25rem; width:100%; max-width:700px;">
            <h2 class="section-title" id="installGuideTitle">Instalar App</h2>
            <div id="installGuideBody" style="color:#111; line-height:1.7;">
            </div>
            <div style="display:flex; gap:.5rem; justify-content:flex-end; margin-top:.75rem;">
                <button class="btn-action" onclick="closeInstallGuide()" id="installGuideClose">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Admin Setup Modal -->
    <div id="adminSetupOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; padding:2rem; width:100%; max-width:520px;">
            <h2 class="section-title">Admin Setup</h2>
            <div class="form-group">
                <label>Admin Email</label>
                <input type="email" id="adminEmailInput">
            </div>
            <div class="form-group">
                <label>Admin Password</label>
                <input type="password" id="adminPassInput">
            </div>
            <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                <button class="btn-action" onclick="closeAdminSetup()">Close</button>
                <button class="btn-auth" onclick="saveAdminConfig()">Save</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10001;">
        <div style="background:#FFFFFF; border:1px solid #E6E6E6; padding:2rem; width:100%; max-width:900px; max-height:90vh; overflow-y:auto;">
            <h2 class="section-title">Admin Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="adminUsersCount">N/A</div>
                    <div class="stat-label">Registered Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="adminActiveCount">N/A</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-value" id="adminReviewsCount">0</div>
                    <div class="stat-label">Reviews</div>
                </div>
            </div>
            <div class="generator-section" style="margin-top:1rem;">
                <h2 id="adminAccessTitle" class="section-title">Access Control</h2>
                <div class="form-row">
                    <div class="form-group" style="flex:1;">
                        <label id="adminAccessEmailLabel">User Email</label>
                        <input type="email" id="adminAccessEmail" placeholder="user@example.com">
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label id="adminAccessDaysLabel">Access Days</label>
                        <input type="number" id="adminAccessDays" min="1" placeholder="30">
                    </div>
                    <div class="form-group" style="flex:1; display:flex; align-items:center; gap:.5rem;">
                        <input type="checkbox" id="adminAccessIndef">
                        <span id="adminAccessIndefLabel">Indefinite Access</span>
                    </div>
                </div>
                <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                    <button id="adminAccessGrantBtn" class="btn-action" onclick="grantAccess()">Grant Access</button>
                    <button id="adminAccessRemoveBtn" class="btn-action" onclick="removeAccess()">Remove Override</button>
                </div>
            </div>
            <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                <button class="btn-action" onclick="exportReviews()">Export Reviews</button>
                <button class="btn-action" onclick="closeAdminPanel()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIG ====================
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';
        const STRIPE_LINK = 'https://buy.stripe.com/9B68wP4Qxb20cLI4Mu2VG01';
        const BASE_PRICE_BRL = 29.99;
        const PRODUCT_ID = 'prod_TUTj9iuvIwb96M';
        const CURRENCY_RATES = {
            BRL: 1,
            USD: 0.18,
            EUR: 0.17,
            GBP: 0.14,
            CAD: 0.24,
            AUD: 0.28,
            JPY: 27.0,
            MXN: 3.2,
            ARS: 160,
            CLP: 170,
            COP: 800,
            CHF: 0.17
        };
        const CURRENCY_SYMBOL = {
            BRL: 'R$', USD: '$', EUR: '‚Ç¨', GBP: '¬£', CAD: 'C$', AUD: 'A$', JPY: '¬•', MXN: '$', ARS: 'ARS$', CLP: 'CLP$', COP: 'COL$', CHF: 'CHF'
        };
        
        let supabase = null;
        let currentUser = null;
        let currentArticle = null;
        let deferredPrompt = null;
        let adminEmail = null;
        let adminHash = null;
        let USER_COUNTRY = 'US';
        let USER_CURRENCY = { symbol: '$', code: 'USD', price: convertFromBRL(BASE_PRICE_BRL, 'USD') };
        function getUILangFromCountry(country) {
            const map = {
                BR: 'pt', PT: 'pt', AO: 'pt', MZ: 'pt', CV: 'pt',
                US: 'en', GB: 'en', IE: 'en', AU: 'en', NZ: 'en', CA: 'en',
                ES: 'es', MX: 'es', AR: 'es', CO: 'es', CL: 'es', PE: 'es', UY: 'es', VE: 'es', EC: 'es',
                FR: 'fr', BE: 'fr', CH: 'fr', LU: 'fr',
                DE: 'de', AT: 'de', CH_DE: 'de'
            };
            return map[country] || (navigator.language && navigator.language.startsWith('pt') ? 'pt' : (navigator.language && navigator.language.startsWith('es') ? 'es' : (navigator.language && navigator.language.startsWith('fr') ? 'fr' : (navigator.language && navigator.language.startsWith('de') ? 'de' : 'en'))));
        }
        
        const CURRENCY_BY_COUNTRY = {
            'US': { symbol: '$', code: 'USD' },
            'BR': { symbol: 'R$', code: 'BRL' },
            'GB': { symbol: '¬£', code: 'GBP' },
            'EU': { symbol: '‚Ç¨', code: 'EUR' },
            'DE': { symbol: '‚Ç¨', code: 'EUR' },
            'FR': { symbol: '‚Ç¨', code: 'EUR' },
            'ES': { symbol: '‚Ç¨', code: 'EUR' },
            'CA': { symbol: 'C$', code: 'CAD' },
            'AU': { symbol: 'A$', code: 'AUD' },
            'JP': { symbol: '¬•', code: 'JPY' },
            'MX': { symbol: '$', code: 'MXN' },
            'AR': { symbol: 'ARS$', code: 'ARS' },
            'CL': { symbol: 'CLP$', code: 'CLP' },
            'CO': { symbol: 'COL$', code: 'COP' },
            'CH': { symbol: 'CHF', code: 'CHF' }
        };
        function convertFromBRL(amount, code) { const rate = CURRENCY_RATES[code] || 1; return amount * rate; }
        function formatPrice(code, amount) { const v = code === 'JPY' ? Math.round(amount) : amount.toFixed(2); return v; }
        function getPriceForCountry(country) { const c = CURRENCY_BY_COUNTRY[country] || CURRENCY_BY_COUNTRY['US']; const price = convertFromBRL(BASE_PRICE_BRL, c.code); return { symbol: c.symbol, code: c.code, price }; }
        
        // ==================== INIT ====================
        async function init() {
            try {
                if (SUPABASE_URL !== 'YOUR_SUPABASE_URL') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                }
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('authContainer').style.display = 'flex';
                }, 1500);
                setupPWA();
                await detectUserLocation();
                renderBenefitsTicker();
                loadAdminConfig();
                renderReviews();
                handleReturnParams();
            } catch (err) {
                console.error('Init error:', err);
                alert('Error initializing app');
            }
        }
        
        init();
        
        // ==================== PWA ====================
        function setupPWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('SW registered:', reg))
                    .catch(err => console.error('SW error:', err));
            }
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installBtn').style.display = 'block';
            });
            
            document.getElementById('installBtn').addEventListener('click', async () => {
                if (!deferredPrompt) { openInstallGuide(); return; }
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('Install outcome:', outcome);
                deferredPrompt = null;
            });
        }

        function openInstallGuide(){
            const lang = (document.getElementById('langSelect').value || 'pt');
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
            const isAndroid = /Android/.test(ua);
            const isMac = /Macintosh/.test(ua);
            const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
            const isChrome = /Chrome/i.test(ua);
            const T = {
                pt: { title:'Instalar App', android:'No Android (Chrome): toque o bot√£o acima ou o √≠cone de instalar na barra do navegador.', ios:'No iPhone/iPad (Safari): Compartilhar ‚Üí Adicionar √† Tela de In√≠cio.', mac:'No Mac: Safari ‚Üí Arquivo ‚Üí Adicionar ao Dock. No Chrome: Mais ferramentas ‚Üí Criar atalho‚Ä¶ e marque ‚ÄúAbrir como janela‚Äù.', close:'Fechar' },
                en: { title:'Install App', android:'On Android (Chrome): tap the button above or the install icon in the address bar.', ios:'On iPhone/iPad (Safari): Share ‚Üí Add to Home Screen.', mac:'On Mac: Safari ‚Üí File ‚Üí Add to Dock. Chrome: More Tools ‚Üí Create Shortcut‚Ä¶ and check ‚ÄúOpen as window‚Äù.', close:'Close' },
                es: { title:'Instalar App', android:'En Android (Chrome): toca el bot√≥n arriba o el icono de instalar.', ios:'En iPhone/iPad (Safari): Compartir ‚Üí A√±adir a Pantalla de Inicio.', mac:'En Mac: Safari ‚Üí Archivo ‚Üí A√±adir al Dock. Chrome: M√°s herramientas ‚Üí Crear acceso directo‚Ä¶ y marcar ‚ÄúAbrir como ventana‚Äù.', close:'Cerrar' },
                fr: { title:'Installer l‚ÄôApp', android:'Sur Android (Chrome)¬†: appuyez sur le bouton ou l‚Äôic√¥ne d‚Äôinstallation.', ios:'Sur iPhone/iPad (Safari)¬†: Partager ‚Üí Ajouter √† l‚Äô√©cran d‚Äôaccueil.', mac:'Sur Mac¬†: Safari ‚Üí Fichier ‚Üí Ajouter au Dock. Chrome¬†: Plus d‚Äôoutils ‚Üí Cr√©er un raccourci‚Ä¶ et cochez ‚ÄúOuvrir comme fen√™tre‚Äù.', close:'Fermer' },
                de: { title:'App installieren', android:'Auf Android (Chrome): Tippen Sie auf den Button oder das Installationssymbol.', ios:'Auf iPhone/iPad (Safari): Teilen ‚Üí Zum Home-Bildschirm.', mac:'Auf Mac: Safari ‚Üí Ablage ‚Üí Zum Dock hinzuf√ºgen. Chrome: Weitere Tools ‚Üí Verkn√ºpfung erstellen‚Ä¶ und ‚ÄúAls Fenster √∂ffnen‚Äù.', close:'Schlie√üen' }
            }[lang];
            document.getElementById('installGuideTitle').textContent = T.title;
            document.getElementById('installGuideClose').textContent = T.close;
            let body = '';
            if (isAndroid || isChrome) body += `<p>${T.android}</p>`;
            if (isIOS) body += `<p>${T.ios}</p>`;
            if (isMac || isSafari) body += `<p>${T.mac}</p>`;
            if (!body) body = `<p>${T.android}</p><p>${T.ios}</p><p>${T.mac}</p>`;
            document.getElementById('installGuideBody').innerHTML = body;
            document.getElementById('installGuideOverlay').style.display = 'flex';
        }
        function closeInstallGuide(){ document.getElementById('installGuideOverlay').style.display = 'none'; }
        
        // ==================== AUTH ====================
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
            hideMsg();
        }
        
        function showError(msg) {
            document.getElementById('authError').textContent = msg;
            document.getElementById('authError').style.display = 'block';
            document.getElementById('authSuccess').style.display = 'none';
        }
        
        function showSuccess(msg) {
            document.getElementById('authSuccess').textContent = msg;
            document.getElementById('authSuccess').style.display = 'block';
            document.getElementById('authError').style.display = 'none';
        }
        
        function hideMsg() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }
        
        async function hashSHA256(t) {
            const e = new TextEncoder().encode(t);
            const n = await crypto.subtle.digest('SHA-256', e);
            return Array.from(new Uint8Array(n)).map(r => r.toString(16).padStart(2, '0')).join('');
        }
        
        function loadAdminConfig() {
            adminEmail = localStorage.getItem('ADMIN_EMAIL') || null;
            adminHash = localStorage.getItem('ADMIN_PASSWORD_HASH') || null;
        }
        
        async function isAdminCredentials(email, pass) {
            if (!adminEmail || !adminHash) return false;
            const h = await hashSHA256(pass);
            return email === adminEmail && h === adminHash;
        }
        
        async function handleLogin(e) { e.preventDefault(); const email = document.getElementById('loginEmail').value.trim().toLowerCase(); const pass = document.getElementById('loginPassword').value; let user = null; if (await isAdminCredentials(email, pass)) { user = { email: email, name: 'Admin', role: 'admin', subscription_status: 'active', articles_count: 0, total_words: 0, streak: 0 }; user.email = (user.email || '').toLowerCase(); loginUser(user); return; } if (email === 'demo@demo.com' && pass === 'demo123') { user = { email: email, name: 'Demo User', subscription_status: 'active', articles_count: 5, total_words: 12500, streak: 7 }; user.email = (user.email || '').toLowerCase(); loginUser(user); return; } if (!supabase) { const users = JSON.parse(localStorage.getItem('LOCAL_USERS') || '[]'); const hash = await hashSHA256(pass); const u = users.find(u => u.email === email && u.hash === hash); if (u) { user = { email: email, name: u.name, subscription_status: 'active', articles_count: 0, total_words: 0, streak: 0 }; user.email = (user.email || '').toLowerCase(); loginUser(user); return; } showError('‚ùå Credenciais inv√°lidas'); return; } showError('‚ùå Credenciais inv√°lidas'); }
        
        async function handleSignup(e) { e.preventDefault(); const name = document.getElementById('signupName').value.trim(); const email = document.getElementById('signupEmail').value.trim().toLowerCase(); const pass = document.getElementById('signupPassword').value; if (!name || !email || !pass) { showError('‚ùå Fill all fields'); return; } if (!supabase) { const users = JSON.parse(localStorage.getItem('LOCAL_USERS') || '[]'); const exists = users.find(u => u.email === email); if (exists) { showError('‚ùå Email already registered'); return; } const hash = await hashSHA256(pass); users.push({ name, email, hash }); localStorage.setItem('LOCAL_USERS', JSON.stringify(users)); localStorage.setItem(`TRIAL_START_${email}`, new Date().toISOString()); localStorage.setItem(`SUBSCRIPTION_STATUS_${email}`, 'trial_active'); showSuccess('‚úÖ Account created! Please login.'); return; } showSuccess('‚úÖ Account created! Please login.'); }
        
        function loginUser(user) {
            currentUser = user;
            initializeTrialForUser();
            renderTrialBanner();
            maybeWarnTrialExpiring();
            if (localStorage.getItem('PAID_FLAG') === '1') { localStorage.removeItem('PAID_FLAG'); unlockAfterPayment(); }
            checkSubscriptionStatus(user);
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            document.getElementById('userName').textContent = user.name.split(' ')[0];
            
            if (user.role === 'admin') {
                document.getElementById('adminBtn').style.display = 'inline-block';
            }
            
            updateStats();
            loadArticles();
            loadAdminConfig();
            renderReviews();
        }
        
        function checkSubscriptionStatus(user) {
            const status = getSubscriptionStatus();
            if (status === 'trial_expired') {
                document.getElementById('paywallOverlay').classList.add('active');
            } else {
                document.getElementById('paywallOverlay').classList.remove('active');
            }
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('authContainer').style.display = 'flex';
            showAuthTab('login');
        }
        
        // ==================== CURRENCY ====================
        async function detectUserLocation() {
            let country = 'US';
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                country = data.country_code || 'US';
            } catch (err) { }
            USER_COUNTRY = country;
            renderPaywallPrice(country);
            const lang = getUILangFromCountry(country);
            changeLanguage(lang);
            document.getElementById('langSelect').value = lang;
            renderBenefitsTicker();
        }
        function renderBenefitsTicker() { const bar = document.getElementById('benefitsTicker'); const track = document.getElementById('benefitsTrack'); const btn = document.getElementById('tickerCta'); if (!bar || !track || !btn) return; const lang = (document.getElementById('langSelect').value || 'pt'); const sym = USER_CURRENCY.symbol; const amt = formatPrice(USER_CURRENCY.code, USER_CURRENCY.price); const pt = [`Assine por ${sym}${amt}/m√™s`,`Gere artigos profissionais com poucos cliques`,`M√≥dulo acad√™mico: TCC, tese e doutorado`,`Estrutura avan√ßada com se√ß√µes e exemplos reais`,`Ferramentas de cita√ß√£o: ABNT/APA/MLA/Chicago`,`Acesso imediato ‚Äî sem limita√ß√µes`,`Suporte e atualiza√ß√µes constantes`]; const en = [`Subscribe for ${sym}${amt}/month`,`Create professional articles in minutes`,`Academic module: thesis and PhD writing`,`Advanced structure with real examples`,`Citation tools: ABNT/APA/MLA/Chicago`,`Immediate access ‚Äî no limits`,`Support and ongoing updates`]; const es = [`Suscr√≠bete por ${sym}${amt}/mes`,`Crea art√≠culos profesionales en minutos`,`M√≥dulo acad√©mico: tesis y doctorado`,`Estructura avanzada con ejemplos reales`,`Herramientas de citaci√≥n: ABNT/APA/MLA/Chicago`,`Acceso inmediato ‚Äî sin l√≠mites`,`Soporte y actualizaciones continuas`]; const fr = [`Abonnez‚Äëvous pour ${sym}${amt}/mois`,`R√©digez des articles professionnels en minutes`,`Module acad√©mique¬†: th√®se et doctorat`,`Structure avanc√©e avec exemples r√©els`,`Outils de citation¬†: ABNT/APA/MLA/Chicago`,`Acc√®s imm√©diat ‚Äî sans limites`,`Support et mises √† jour continues`]; const de = [`Abonnieren f√ºr ${sym}${amt}/Monat`,`Professionelle Artikel in Minuten erstellen`,`Akademisches Modul: Thesis und Promotion`,`Erweiterte Struktur mit echten Beispielen`,`Zitations‚ÄëTools: ABNT/APA/MLA/Chicago`,`Sofortiger Zugang ‚Äî ohne Limits`,`Support und laufende Updates`]; const pool = lang==='pt'?pt:lang==='es'?es:lang==='fr'?fr:lang==='de'?de:en; track.innerHTML = `${pool.concat(pool).map(t=>`<span class="ticker-item">${t}</span>`).join('')}`; btn.textContent = lang==='pt'?'Assinar':lang==='es'?'Suscribirse':lang==='fr'?'S‚Äôabonner':lang==='de'?'Abonnieren':'Subscribe'; bar.style.display = 'block'; }
        function renderPaywallPrice(country) {
            const data = getPriceForCountry(country);
            USER_CURRENCY = data;
            document.getElementById('priceCurrency').textContent = data.symbol;
            document.getElementById('priceAmount').textContent = formatPrice(data.code, data.price);
            const pc = document.getElementById('priceConvert');
            if (pc) { pc.textContent = ''; pc.style.display = 'none'; }
        }
        
        function redirectToStripe() {
            if (!currentUser || !currentUser.email) {
                alert('‚ùå Erro: usu√°rio n√£o identificado');
                return;
            }
            const stripeUrl = `${STRIPE_LINK}?client_reference_id=${currentUser.email}&prefilled_email=${currentUser.email}`;
            console.log('üîó Redirecionando para Stripe:', stripeUrl);
            window.open(stripeUrl, '_blank');
        }

        function getUserKey() { return (currentUser && currentUser.email) ? currentUser.email.toLowerCase() : 'anon'; }
        function initializeTrialForUser() { const key = getUserKey(); const startKey = `TRIAL_START_${key}`; const statusKey = `SUBSCRIPTION_STATUS_${key}`; if (!localStorage.getItem(startKey)) { localStorage.setItem(startKey, new Date().toISOString()); } const status = localStorage.getItem(statusKey) || (currentUser.subscription_status || 'trial_active'); localStorage.setItem(statusKey, status); const overrideStr = localStorage.getItem(`ADMIN_ACCESS_${key}`); if (overrideStr) { try { const o = JSON.parse(overrideStr); if (o && o.indefinite) { localStorage.setItem(statusKey, 'active'); } else if (o && o.days && o.days > 0) { const grantStartKey = `GRANT_START_${key}`; if (!localStorage.getItem(grantStartKey)) { const now = new Date().toISOString(); localStorage.setItem(grantStartKey, now); localStorage.setItem(startKey, now); } localStorage.setItem(`TRIAL_LENGTH_${key}`, String(o.days)); localStorage.setItem(statusKey, 'trial_active'); } } catch (e) {} } }
        function getRemainingTrialDays() { const key = getUserKey(); const startStr = localStorage.getItem(`TRIAL_START_${key}`); const lenStr = localStorage.getItem(`TRIAL_LENGTH_${key}`); const length = lenStr ? (parseInt(lenStr) || 14) : 14; if (!startStr) return length; const start = new Date(startStr); const now = new Date(); const days = Math.ceil((now - start) / (1000*60*60*24)); return Math.max(0, length - days); }
        function getSubscriptionStatus() { const key = getUserKey(); const status = localStorage.getItem(`SUBSCRIPTION_STATUS_${key}`) || 'trial_active'; if (status === 'active') return 'active'; const left = getRemainingTrialDays(); return left > 0 ? 'trial_active' : 'trial_expired'; }
        function renderTrialBanner() { const banner = document.getElementById('trialBanner'); if (!banner || !currentUser) return; const status = getSubscriptionStatus(); if (status === 'active') { banner.style.display='none'; return; } const left = getRemainingTrialDays(); const lang = (document.getElementById('langSelect').value || 'pt'); const isPT = lang === 'pt'; const isEN = lang === 'en'; const isES = lang === 'es'; const isFR = lang === 'fr'; const isDE = lang === 'de'; const localSym = USER_CURRENCY.symbol; const localAmt = formatPrice(USER_CURRENCY.code, USER_CURRENCY.price); const priceLine = isPT ? `Assine por ${localSym}${localAmt}/m√™s` : (isEN ? `Subscribe for ${localSym}${localAmt}/month` : (isES ? `Suscr√≠bete por ${localSym}${localAmt}/mes` : (isFR ? `Abonnez‚Äëvous pour ${localSym}${localAmt}/mois` : `Abonnieren f√ºr ${localSym}${localAmt}/Monat`))); const msg = isPT ? `Seu teste gratuito termina em ${left} dia${left===1?'':'s'}.` : (isEN ? `Your free trial ends in ${left} day${left===1?'':'s'}.` : (isES ? `Tu prueba gratuita termina en ${left} d√≠a${left===1?'':'s'}.` : (isFR ? `Votre essai gratuit se termine dans ${left} jour${left===1?'':'s'}.` : `Ihre kostenlose Testphase endet in ${left} Tag${left===1?'':'en'}.`))); const nudge = isPT ? `Crie um artigo hoje ‚Äî pequenos ciclos geram resultados.` : (isEN ? `Create an article today ‚Äî short cycles compound results.` : (isES ? `Crea un art√≠culo hoy ‚Äî ciclos cortos generan resultados.` : (isFR ? `Cr√©ez un article aujourd‚Äôhui ‚Äî les cycles courts composent les r√©sultats.` : `Erstellen Sie heute einen Artikel ‚Äî kurze Zyklen verst√§rken die Ergebnisse.`))); banner.style.display='block'; banner.classList.toggle('warn', left <= 3); const btnText = isPT ? 'Assinar Agora' : (isEN ? 'Subscribe Now' : (isES ? 'Suscribirse' : (isFR ? 'S‚Äôabonner' : 'Jetzt abonnieren'))); banner.innerHTML = `<span>${msg}</span> <span style="margin-left:.5rem;color:#444;font-weight:500">${priceLine}</span> <button class="btn-action" onclick="redirectToStripe()" style="margin-left:.5rem;padding:.35rem .7rem">${btnText}</button> <span style="margin-left:.5rem;color:#6B7280;font-weight:500">${nudge}</span>`; }
        function maybeWarnTrialExpiring() { const left = getRemainingTrialDays(); const key = getUserKey(); const markKey = `TRIAL_WARN_${key}_${new Date().toDateString()}`; if (left <= 3 && !localStorage.getItem(markKey)) { alert(`‚ö†Ô∏è Seu teste gratuito termina em ${left} dia${left===1?'':'s'}.`); localStorage.setItem(markKey, '1'); } }
        function unlockAfterPayment() { const key = getUserKey(); localStorage.setItem(`SUBSCRIPTION_STATUS_${key}`, 'active'); currentUser.subscription_status = 'active'; document.getElementById('paywallOverlay').classList.remove('active'); renderTrialBanner(); alert('‚úÖ Assinatura ativada! Acesso liberado.'); }
        function handleReturnParams() { const params = new URLSearchParams(window.location.search); if (params.get('unlock') === '1' || params.get('paid') === '1' || params.get('status') === 'active') { if (currentUser) { unlockAfterPayment(); } else { localStorage.setItem('PAID_FLAG', '1'); } } }
        
        function openAdminSetup() {
            document.getElementById('adminSetupOverlay').style.display = 'flex';
        }
        
        function closeAdminSetup() {
            document.getElementById('adminSetupOverlay').style.display = 'none';
        }
        
        async function saveAdminConfig() {
            const email = document.getElementById('adminEmailInput').value.trim().toLowerCase();
            const pass = document.getElementById('adminPassInput').value;
            
            if (!email || !pass) {
                alert('Please enter email and password');
                return;
            }
            
            const h = await hashSHA256(pass);
            localStorage.setItem('ADMIN_EMAIL', email);
            localStorage.setItem('ADMIN_PASSWORD_HASH', h);
            closeAdminSetup();
            alert('Admin configured');
        }
        
        function openAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'flex';
            loadAdminStats();
        }
        
        function closeAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'none';
        }
        
        async function loadAdminStats() {
            const reviews = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            document.getElementById('adminReviewsCount').textContent = reviews.length;
            
            if (!supabase) {
                document.getElementById('adminUsersCount').textContent = 'N/A';
                document.getElementById('adminActiveCount').textContent = 'N/A';
                return;
            }
            
            try {
                const { data: users } = await supabase.from('users').select('id, subscription_status');
                const total = users ? users.length : 0;
                const active = users ? users.filter(u => u.subscription_status === 'active').length : 0;
                document.getElementById('adminUsersCount').textContent = total;
                document.getElementById('adminActiveCount').textContent = active;
            } catch (err) {
                document.getElementById('adminUsersCount').textContent = 'N/A';
                document.getElementById('adminActiveCount').textContent = 'N/A';
            }
        }
        function grantAccess(){ const email=(document.getElementById('adminAccessEmail').value||'').trim().toLowerCase(); const days=parseInt(document.getElementById('adminAccessDays').value||'0'); const indef=document.getElementById('adminAccessIndef').checked; if(!email){ alert('Informe o email'); return; } if(indef){ const data={indefinite:true, createdAt:new Date().toISOString()}; localStorage.setItem(`ADMIN_ACCESS_${email}`, JSON.stringify(data)); alert('Acesso indeterminado concedido'); return; } const d=Math.max(1, days); const data={indefinite:false, days:d, createdAt:new Date().toISOString(), startAt:null}; localStorage.setItem(`ADMIN_ACCESS_${email}`, JSON.stringify(data)); alert(`Acesso por ${d} dias concedido`); }
        function removeAccess(){ const email=(document.getElementById('adminAccessEmail').value||'').trim().toLowerCase(); if(!email){ alert('Informe o email'); return; } localStorage.removeItem(`ADMIN_ACCESS_${email}`); alert('Override removido'); }
        
        function exportReviews() {
            const reviews = localStorage.getItem('REVIEWS') || '[]';
            const blob = new Blob([reviews], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reviews.json';
            a.click();
        }
        
        function renderReviews() {
            const list = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            if (!list.length) {
                document.getElementById('reviewsList').innerHTML = '<p style="text-align:center;color:#999;">No reviews yet.</p>';
                return;
            }
            
            document.getElementById('reviewsList').innerHTML = list.map(r => `
                <div class="article-card">
                    <div class="article-card-title">${r.name} ‚Ä¢ ${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5 - r.rating)}</div>
                    <div style="color:#666;font-size:0.85em;">${new Date(r.createdAt).toLocaleDateString()}</div>
                    <p style="margin-top:0.5rem;color:#374151;">${r.comment}</p>
                </div>
            `).join('');
        }
        
        async function submitReview() {
            const name = document.getElementById('reviewName').value.trim();
            const rating = parseInt(document.getElementById('reviewRating').value);
            const comment = document.getElementById('reviewComment').value.trim();
            
            if (!name || !comment) {
                alert('Please fill name and comment');
                return;
            }
            
            const item = {
                name,
                rating,
                comment,
                createdAt: new Date().toISOString()
            };
            
            const list = JSON.parse(localStorage.getItem('REVIEWS') || '[]');
            list.unshift(item);
            localStorage.setItem('REVIEWS', JSON.stringify(list));
            renderReviews();
            
            document.getElementById('reviewName').value = '';
            document.getElementById('reviewComment').value = '';
            
            if (supabase) {
                try {
                    await supabase.from('reviews').insert({
                        name: name,
                        rating: rating,
                        comment: comment
                    });
                } catch (err) { }
            }
        }
        
        // ==================== ARTICLE GENERATION ====================
        async function generateArticle() {
            const topic = document.getElementById('articleTopic').value.trim();
            if (!topic) {
                alert('‚ùå Please enter a topic!');
                return;
            }
            
            const language = document.getElementById('articleLanguage').value;
            const wordCount = parseInt(document.getElementById('articleWordCount').value);
            const style = document.getElementById('articleStyle').value;
            const instructions = document.getElementById('articleInstructions').value.trim();
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            try {
                const article = await generateLuxArticleContent(topic, language, wordCount, style, instructions);
                currentArticle = article;
                displayArticle(article);
                
                btn.textContent = '‚úÖ Generated!';
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'üöÄ Generate Article';
                }, 2000);
            } catch (err) {
                console.error('Generation error:', err);
                alert('‚ùå Error generating article');
                btn.disabled = false;
                btn.textContent = 'üöÄ Generate Article';
            }
        }
        
        async function generateLuxArticleContent(topic, language, wordCount, style, instructions) {
            await new Promise(resolve => setTimeout(resolve, 300));
            const isPT = language === 'pt';
            const pro = style !== 'casual';
            const year = new Date().getFullYear();
            const academic = (document.getElementById('academicMode') && document.getElementById('academicMode').value === 'on');
    const css = `
<style>
.lux-article{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia','Times New Roman',serif;color:#2F3D3C;line-height:1.9;max-width:900px;margin:0 auto}
.lux-article h1{font-family:'Times New Roman',Times,serif;font-weight:400;color:#124C3F;font-size:2.4em;margin:0 0 .75rem}
.lux-article h2{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia',serif;font-weight:500;color:#145C44;font-size:1.8em;margin:2rem 0 .75rem;border-bottom:4px solid #D4AF37;padding-bottom:.25rem}
.lux-article h3{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia',serif;font-weight:400;color:#145C44;font-size:1.25em;margin:1.25rem 0 .5rem}
.lux-article p{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia','Times New Roman',serif;font-weight:400;font-size:1.06em;margin:0 0 1.25rem;text-align:justify}
.lux-article ul{margin:.5rem 0 1.25rem 1.5rem}
.lux-callout{background:#E8F3F7;color:#166A5D;border-left:8px solid #D4AF37;border-radius:14px;padding:1rem 1.25rem;font-style:italic;box-shadow:0 2px 0 rgba(0,0,0,.04);margin:1rem 0 1.25rem}
.lux-cta{background:#FFFFFF;border:2px solid #8B5CF6;color:#111;border-radius:12px;padding:1rem 1.25rem;text-align:center;margin:1.5rem 0;display:flex;flex-direction:column;align-items:center;gap:.5rem}
.lux-cta h3{color:#111;margin:0}
.lux-cta p{color:#111;text-align:center;margin:0}
.lux-cta a{display:inline-block;background:#fff;color:#111;border:2px solid #8B5CF6;border-radius:8px;padding:.5rem 1rem;font-weight:700;text-decoration:none}
.lux-meta{background:#F8FAFF;border:2px solid #8B5CF6;color:#111;border-radius:12px;padding:.5rem .75rem;text-align:center;margin:.75rem 0;font-weight:600}
.lux-platforms{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;margin-top:.25rem}
.lux-chip{display:inline-flex;align-items:center;gap:.35rem;border:2px solid #8B5CF6;color:#111;border-radius:999px;padding:.35rem .7rem;text-decoration:none;font-weight:600}
.lux-chip svg{width:16px;height:16px;fill:#8B5CF6}
blockquote{border-left:6px solid #D4AF37;color:#1F513F;padding-left:1rem;margin:1rem 0}
</style>`;
    const strip = s => s.replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<[^>]+>/g, '');
    const count = s => strip(s).trim().split(/\s+/).filter(Boolean).length;
    const targetMin = wordCount;
    const seedStr = `${topic}|${language}|${style}|${wordCount}|${year}|${localStorage.getItem('LAST_ARTICLE_TITLE')||''}|${Date.now()}`;
    const seedInit = (()=>{ try { const u = new Uint32Array(1); crypto.getRandomValues(u); return (u[0] ^ Array.from(seedStr).reduce((a,c)=>((a*31 + c.charCodeAt(0))>>>0),0))>>>0; } catch(e) { return Array.from(seedStr).reduce((a,c)=>((a*31 + c.charCodeAt(0))>>>0),0); } })();
    function mulberry32(a){ return function(){ a|=0; a = (a + 0x6D2B79F5) | 0; let t = Math.imul(a ^ (a >>> 15), 1 | a); t ^= t + Math.imul(t ^ (t >>> 7), 61 | t); return ((t ^ (t >>> 14)) >>> 0) / 4294967296; } }
    const R = mulberry32(seedInit);
    const pick = a => a[Math.floor(R() * a.length)];
    const num = (min, max) => Math.floor(R() * (max - min + 1)) + min;

    const lang = ['pt','en','es','fr','de'].includes(language) ? language : 'en';
    if (academic) {
        try {
        const stylePref = (document.getElementById('citationStyle') && document.getElementById('citationStyle').value) || 'abnt';
        const level = (document.getElementById('academicLevel') && document.getElementById('academicLevel').value) || 'masters';
        const sourceType = (document.getElementById('sourceType') && document.getElementById('sourceType').value) || 'article';
        const refsInputTxt = (document.getElementById('referencesInput') && document.getElementById('referencesInput').value.trim()) || '';
        function makeRefs(lang){
            const y1 = year-3, y2 = year-2, y3 = year-1;
            const base = lang==='pt'?
                [
                    {author:'Silva, A.', year:y1, title:`Fundamentos de ${topic}`, city:'S√£o Paulo', publisher:'Editora X', journal:'', volume:'', number:'', pages:'', conference:'', doi:''},
                    {author:'Pereira, M.', year:y2, title:`M√©todos aplicados em ${topic}`, city:'Rio de Janeiro', publisher:'Revista Y', journal:'Revista Y', volume:'12', number:'2', pages:'45-67', conference:'', doi:'https://doi.org/10.0000/xyz'},
                    {author:'Souza, R.', year:y3, title:`Debates contempor√¢neos sobre ${topic}`, city:'Belo Horizonte', publisher:'Congresso Z', journal:'', volume:'', number:'', pages:'123-129', conference:'Congresso Z', doi:''}
                ]:
                lang==='es'?
                [
                    {author:'P√©rez, M.', year:y1, title:`Fundamentos de ${topic}`, city:'Madrid', publisher:'Editorial X', journal:'', volume:'', number:'', pages:'', conference:'', doi:''},
                    {author:'Garc√≠a, L.', year:y2, title:`M√©todos aplicados en ${topic}`, city:'Ciudad de M√©xico', publisher:'Revista Y', journal:'Revista Y', volume:'8', number:'1', pages:'15-32', conference:'', doi:'https://doi.org/10.0000/abc'},
                    {author:'Rodr√≠guez, A.', year:y3, title:`Debates contempor√°neos sobre ${topic}`, city:'Buenos Aires', publisher:'Congreso Z', journal:'', volume:'', number:'', pages:'77-82', conference:'Congreso Z', doi:''}
                ]:
                lang==='fr'?
                [
                    {author:'Dupont, C.', year:y1, title:`Fondements de ${topic}`, city:'Paris', publisher:'√âditions X', journal:'', volume:'', number:'', pages:'', conference:'', doi:''},
                    {author:'Martin, L.', year:y2, title:`M√©thodes appliqu√©es √† ${topic}`, city:'Lyon', publisher:'Revue Y', journal:'Revue Y', volume:'21', number:'3', pages:'201-223', conference:'', doi:'https://doi.org/10.0000/fr1'},
                    {author:'Bernard, S.', year:y3, title:`D√©bats contemporains sur ${topic}`, city:'Marseille', publisher:'Conf√©rence Z', journal:'', volume:'', number:'', pages:'55-60', conference:'Conf√©rence Z', doi:''}
                ]:
                lang==='de'?
                [
                    {author:'M√ºller, T.', year:y1, title:`Grundlagen von ${topic}`, city:'Berlin', publisher:'Verlag X', journal:'', volume:'', number:'', pages:'', conference:'', doi:''},
                    {author:'Schmidt, K.', year:y2, title:`Angewandte Methoden in ${topic}`, city:'M√ºnchen', publisher:'Zeitschrift Y', journal:'Zeitschrift Y', volume:'5', number:'4', pages:'301-318', conference:'', doi:'https://doi.org/10.0000/de1'},
                    {author:'Schneider, P.', year:y3, title:`Zeitgen√∂ssische Debatten √ºber ${topic}`, city:'Hamburg', publisher:'Konferenz Z', journal:'', volume:'', number:'', pages:'90-96', conference:'Konferenz Z', doi:''}
                ]:
                [
                    {author:'Smith, J.', year:y1, title:`Fundamentals of ${topic}`, city:'New York', publisher:'Press X', journal:'', volume:'', number:'', pages:'', conference:'', doi:''},
                    {author:'Johnson, L.', year:y2, title:`Applied Methods in ${topic}`, city:'San Francisco', publisher:'Journal Y', journal:'Journal Y', volume:'14', number:'2', pages:'101-120', conference:'', doi:'https://doi.org/10.0000/en1'},
                    {author:'Chen, K.', year:y3, title:`Contemporary Debates on ${topic}`, city:'Boston', publisher:'Conference Z', journal:'', volume:'', number:'', pages:'33-39', conference:'Conference Z', doi:''}
                ];
            return base;
        }
        function surname(a){ return (a.split(',')[0]||a).trim(); }
        function fmtRef(ref, style, type){
            const s = surname(ref.author);
            if (style==='abnt') {
                if (type==='article') return `${s.toUpperCase()}, ${ref.author.split(',')[1]?.trim()||''}. ${ref.title}. ${ref.journal}, v. ${ref.volume}, n. ${ref.number}, p. ${ref.pages}, ${ref.year}. ${ref.doi||''}`.trim();
                if (type==='conference') return `${s.toUpperCase()}, ${ref.author.split(',')[1]?.trim()||''}. ${ref.title}. In: ${ref.conference}. ${ref.city}, ${ref.year}. p. ${ref.pages}.`;
                return `${s.toUpperCase()}, ${ref.author.split(',')[1]?.trim()||''}. ${ref.title}. ${ref.city}: ${ref.publisher}, ${ref.year}.`;
            }
            if (style==='apa') {
                if (type==='article') return `${s}, ${ref.author.split(',')[1]?.trim()||''}. (${ref.year}). ${ref.title}. ${ref.journal}, ${ref.volume}(${ref.number}), ${ref.pages}. ${ref.doi||''}`.trim();
                if (type==='conference') return `${s}, ${ref.author.split(',')[1]?.trim()||''}. (${ref.year}). ${ref.title}. In ${ref.conference} (pp. ${ref.pages}). ${ref.city}.`;
                return `${s}, ${ref.author.split(',')[1]?.trim()||''}. (${ref.year}). ${ref.title}. ${ref.publisher}.`;
            }
            if (style==='mla') {
                if (type==='article') return `${ref.author}. "${ref.title}." ${ref.journal}, vol. ${ref.volume}, no. ${ref.number}, ${ref.year}, pp. ${ref.pages}. ${ref.doi||''}`.trim();
                if (type==='conference') return `${ref.author}. "${ref.title}." ${ref.conference}, ${ref.year}, ${ref.city}, pp. ${ref.pages}.`;
                return `${ref.author}. ${ref.title}. ${ref.publisher}, ${ref.year}.`;
            }
            // Chicago author-date (simplified)
            if (type==='article') return `${ref.author}. ${ref.year}. "${ref.title}." ${ref.journal} ${ref.volume}(${ref.number}): ${ref.pages}. ${ref.doi?`doi:${ref.doi}`:''}`.trim();
            if (type==='conference') return `${ref.author}. ${ref.year}. "${ref.title}." In ${ref.conference}, ${ref.city}, ${ref.pages}.`;
            return `${ref.author}. ${ref.year}. ${ref.title}. ${ref.publisher}.`;
        }
        function cite(ref, style){ const s = surname(ref.author); return style==='abnt'?`(${s.toUpperCase()}, ${ref.year})`:style==='mla'?`(${s} ${ref.year})`:`(${s}, ${ref.year})`; }
        function parseRefsFromInput(txt){
            const lines = txt.split(/\n+/).map(l=>l.trim()).filter(Boolean);
            const arr = [];
            for (const l of lines){
                const parts = l.split(';').map(p=>p.trim());
                const [author, year, title, city, publisher, journal, volume, number, pages, doi] = parts;
                arr.push({author:author||'Anon', year:Number(year)||year||year, title:title||'Untitled', city:city||'', publisher:publisher||'', journal:journal||'', volume:volume||'', number:number||'', pages:pages||'', conference:publisher||'', doi:doi||''});
            }
            return arr.length?arr:null;
        }
        const refsData = refsInputTxt ? (parseRefsFromInput(refsInputTxt) || makeRefs(lang)) : makeRefs(lang);
        let title = lang==='pt'?`Proposta Acad√™mica: ${topic}`:lang==='es'?`Propuesta Acad√©mica: ${topic}`:lang==='fr'?`Proposition Acad√©mique¬†: ${topic}`:lang==='de'?`Akademische Vorlage: ${topic}`:`Academic Proposal: ${topic}`;
        const prevTitle = localStorage.getItem('LAST_ARTICLE_TITLE') || '';
        if (prevTitle === title) title = `${title} ${num(10,99)}`;
        let content = `${css}<section class="lux-article"><h1>${title}</h1>`;
        const acaPool = [
            lang==='pt'?`Estrutura rigorosa e replic√°vel para ${topic} em ${year}.`:
            lang==='es'?`Estructura rigurosa y replicable para ${topic} en ${year}.`:
            lang==='fr'?`Structure rigoureuse et reproductible pour ${topic} en ${year}.`:
            lang==='de'?`Strenge und reproduzierbare Struktur f√ºr ${topic} im ${year}.`:`A rigorous, reproducible structure for ${topic} in ${year}.`,
            lang==='pt'?`${topic} exige m√©todo transparente, dados observ√°veis e valida√ß√£o em ${year}.`:
            lang==='es'?`${topic} exige m√©todo transparente, datos observables y validaci√≥n en ${year}.`:
            lang==='fr'?`${topic} exige une m√©thode transparente, des donn√©es observables et une validation en ${year}.`:
            lang==='de'?`${topic} verlangt transparente Methode, beobachtbare Daten und Validierung im ${year}.`:`${topic} demands transparent method, observable data and validation in ${year}.`,
            lang==='pt'?`Roteiro acad√™mico completo para ${topic}: problema, literatura, m√©todo, resultados e discuss√£o.`:
            lang==='es'?`Gu√≠a acad√©mica completa para ${topic}: problema, literatura, m√©todo, resultados y discusi√≥n.`:
            lang==='fr'?`Parcours acad√©mique complet pour ${topic}¬†: probl√©matique, litt√©rature, m√©thode, r√©sultats et discussion.`:
            lang==='de'?`Akademischer Leitfaden f√ºr ${topic}: Frage, Literatur, Methode, Ergebnisse und Diskussion.`:`Complete academic path for ${topic}: problem, literature, method, results and discussion.`
        ];
        const lastA = localStorage.getItem('LAST_HOOK_ACAD') || '';
        const poolA = acaPool.filter(h => h !== lastA);
        const hook = (poolA.length ? poolA : acaPool)[Math.floor(Math.random() * (poolA.length ? poolA.length : acaPool.length))];
        localStorage.setItem('LAST_HOOK_ACAD', hook);
        content += `<div class="lux-callout">${hook}</div>`;
        const levelName = level==='phd'?(lang==='pt'?'Doutorado':lang==='es'?'Doctorado':lang==='fr'?'Doctorat':lang==='de'?'Promotion':'PhD'):
                          level==='masters'?(lang==='pt'?'Mestrado':lang==='es'?'Maestr√≠a':lang==='fr'?'Master':lang==='de'?'Master':'Masters'):
                          (lang==='pt'?'Gradua√ß√£o':lang==='es'?'Grado':lang==='fr'?'Licence':lang==='de'?'Bachelor':'Undergraduate');
        const styleName = stylePref.toUpperCase();
        const typeName = sourceType==='article'?(lang==='pt'?'Artigo':lang==='es'?'Art√≠culo':lang==='fr'?'Article':lang==='de'?'Artikel':'Article'):sourceType==='book'?(lang==='pt'?'Livro':lang==='es'?'Libro':lang==='fr'?'Livre':lang==='de'?'Buch':'Book'):(lang==='pt'?'Confer√™ncia':lang==='es'?'Conferencia':lang==='fr'?'Conf√©rence':lang==='de'?'Konferenz':'Conference');
        const metaLabel = lang==='pt'?`Gerado com: ${levelName} ¬∑ Estilo: ${styleName} ¬∑ Fonte: ${typeName} ¬∑ Meta: ${wordCount}`:
                           lang==='es'?`Generado con: ${levelName} ¬∑ Estilo: ${styleName} ¬∑ Fuente: ${typeName} ¬∑ Meta: ${wordCount}`:
                           lang==='fr'?`G√©n√©r√© avec¬†: ${levelName} ¬∑ Style¬†: ${styleName} ¬∑ Source¬†: ${typeName} ¬∑ Objectif¬†: ${wordCount}`:
                           lang==='de'?`Erzeugt mit: ${levelName} ¬∑ Stil: ${styleName} ¬∑ Quelle: ${typeName} ¬∑ Ziel: ${wordCount}`:
                           `Generated with: ${levelName} ¬∑ Style: ${styleName} ¬∑ Source: ${typeName} ¬∑ Target: ${wordCount}`;
        content += `<div class="lux-meta">${metaLabel}</div>`;

        const H = {
            abs: lang==='pt'?'Resumo':lang==='es'?'Resumen':lang==='fr'?'R√©sum√©':lang==='de'?'Abstract':'Abstract',
            intro: lang==='pt'?'Introdu√ß√£o':lang==='es'?'Introducci√≥n':lang==='fr'?'Introduction':lang==='de'?'Einleitung':'Introduction',
            rq: lang==='pt'?'Objetivos e Pergunta de Pesquisa':lang==='es'?'Objetivos y Pregunta de Investigaci√≥n':lang==='fr'?'Objectifs et Question de Recherche':lang==='de'?'Ziele und Forschungsfrage':'Objectives and Research Question',
            lit: lang==='pt'?'Revis√£o de Literatura':lang==='es'?'Revisi√≥n de Literatura':lang==='fr'?'Revue de Litt√©rature':lang==='de'?'Literatur√ºberblick':'Literature Review',
            meth: lang==='pt'?'Metodologia':lang==='es'?'Metodolog√≠a':lang==='fr'?'M√©thodologie':lang==='de'?'Methodik':'Methodology',
            res: lang==='pt'?'Resultados':lang==='es'?'Resultados':lang==='fr'?'R√©sultats':lang==='de'?'Ergebnisse':'Results',
            disc: lang==='pt'?'Discuss√£o':lang==='es'?'Discusi√≥n':lang==='fr'?'Discussion':lang==='de'?'Diskussion':'Discussion',
            lim: lang==='pt'?'Limita√ß√µes':lang==='es'?'Limitaciones':lang==='fr'?'Limites':lang==='de'?'Grenzen':'Limitations',
            fut: lang==='pt'?'Trabalhos Futuros':lang==='es'?'Trabajos Futuros':lang==='fr'?'Travaux Futurs':lang==='de'?'Zuk√ºnftige Arbeiten':'Future Work',
            concl: lang==='pt'?'Conclus√£o':lang==='es'?'Conclusi√≥n':lang==='fr'?'Conclusion':lang==='de'?'Fazit':'Conclusion',
            refs: lang==='pt'?'Refer√™ncias':lang==='es'?'Referencias':lang==='fr'?'R√©f√©rences':lang==='de'?'Referenzen':'References'
        };

        const absAdd = level==='phd'?(lang==='pt'?` Enquadra contribui√ß√£o original e base te√≥rica robusta.`:lang==='es'?` Enmarca contribuci√≥n original y base te√≥rica s√≥lida.`:lang==='fr'?` Cadrage d‚Äôune contribution originale et d‚Äôun socle th√©orique solide.`:lang==='de'?` Rahmung eines originellen Beitrags mit solider Theorie.`:` Frames original contribution with solid theoretical basis.`):
                         level==='masters'?(lang==='pt'?` Evidencia replicabilidade e consist√™ncia metodol√≥gica.`:lang==='es'?` Evidencia replicabilidad y consistencia metodol√≥gica.`:lang==='fr'?` Met en √©vidence la reproductibilit√© et la coh√©rence m√©thodologique.`:lang==='de'?` Hebt Replizierbarkeit und methodische Konsistenz hervor.`:` Highlights replicability and methodological consistency.`):
                         (lang==='pt'?` Resume fundamentos e aplica√ß√µes diretas.`:lang==='es'?` Resume fundamentos y aplicaciones directas.`:lang==='fr'?` R√©sume les fondamentaux et les applications directes.`:lang==='de'?` Fasst Grundlagen und direkte Anwendungen zusammen.`:` Summarizes fundamentals and direct applications.`);
        const methAdd = level==='phd'?(lang==='pt'?` Emprega desenho multi‚Äëm√©todo e triangula√ß√£o.`:lang==='es'?` Emplea dise√±o multi‚Äëm√©todo y triangulaci√≥n.`:lang==='fr'?` Utilise un design multi‚Äëm√©thodes et triangulation.`:lang==='de'?` Nutzt Multi‚ÄëMethoden‚ÄëDesign und Triangulation.`:` Uses multi‚Äëmethod design and triangulation.`):
                         level==='masters'?(lang==='pt'?` Prioriza replica√ß√£o com instrumentos validados.`:lang==='es'?` Prioriza la r√©plica con instrumentos validados.`:lang==='fr'?` Priorise la r√©plication avec instruments valid√©s.`:lang==='de'?` Priorisiert Replikation mit validierten Instrumenten.`:` Prioritizes replication with validated instruments.`):
                         (lang==='pt'?` Aplica delineamento simples com crit√©rios objetivos.`:lang==='es'?` Aplica dise√±o simple con criterios objetivos.`:lang==='fr'?` Applique un design simple avec crit√®res objectifs.`:lang==='de'?` Verwendet einfaches Design mit objektiven Kriterien.`:` Applies simple design with objective criteria.`);
        const resAdd = level==='phd'?(lang==='pt'?` Inclui an√°lises avan√ßadas e sensibilidade.`:lang==='es'?` Incluye an√°lisis avanzados y sensibilidad.`:lang==='fr'?` Inclut des analyses avanc√©es et de sensibilit√©.`:lang==='de'?` Enth√§lt fortgeschrittene Analysen und Sensitivit√§t.`:` Includes advanced and sensitivity analyses.`):
                         level==='masters'?(lang==='pt'?` Apresenta efeitos consistentes com testes apropriados.`:lang==='es'?` Presenta efectos consistentes con pruebas apropiadas.`:lang==='fr'?` Pr√©sente des effets coh√©rents avec tests appropri√©s.`:lang==='de'?` Zeigt konsistente Effekte mit passenden Tests.`:` Shows consistent effects with appropriate tests.`):
                         (lang==='pt'?` Mostra resultados claros e mensur√°veis.`:lang==='es'?` Muestra resultados claros y medibles.`:lang==='fr'?` Montre des r√©sultats clairs et mesurables.`:lang==='de'?` Zeigt klare, messbare Ergebnisse.`:` Shows clear, measurable results.`);
        const discAdd = level==='phd'?(lang==='pt'?` √änfase em contribui√ß√£o original e robustez anal√≠tica.`:lang==='es'?` √ânfasis en contribuci√≥n original y robustez anal√≠tica.`:lang==='fr'?` Accent sur la contribution originale et la robustesse analytique.`:lang==='de'?` Fokus auf Originalbeitrag und analytische Robustheit.`:` Emphasis on original contribution and analytical robustness.`):
                         level==='masters'?(lang==='pt'?` Foco em replicabilidade e consist√™ncia metodol√≥gica.`:lang==='es'?` Enfoque en replicabilidad y consistencia metodol√≥gica.`:lang==='fr'?` Accent sur la reproductibilit√© et la coh√©rence m√©thodologique.`:lang==='de'?` Schwerpunkt auf Replizierbarkeit und methodischer Konsistenz.`:` Focus on replicability and methodological consistency.`):
                         (lang==='pt'?` Consolida√ß√£o de fundamentos e aplica√ß√£o pr√°tica.`:lang==='es'?` Consolidaci√≥n de fundamentos y aplicaci√≥n pr√°ctica.`:lang==='fr'?` Consolidation des fondamentaux et application pratique.`:lang==='de'?` Konsolidierung von Grundlagen und praktischer Anwendung.`:` Consolidation of fundamentals and practical application.`);
        const limAdd = level==='phd'?(lang==='pt'?` Discute validade externa e vieses residuais.`:lang==='es'?` Discute validez externa y sesgos residuales.`:lang==='fr'?` Discute la validit√© externe et les biais r√©siduels.`:lang==='de'?` Diskutiert externe Validit√§t und verbleibende Verzerrungen.`:` Discusses external validity and residual biases.`):
                         level==='masters'?(lang==='pt'?` Aborda limites operacionais e amostrais.`:lang==='es'?` Aborda l√≠mites operativos y muestrales.`:lang==='fr'?` Aborde les limites op√©rationnelles et d‚Äô√©chantillon.`:lang==='de'?` Geht auf operative und Stichproben‚ÄëGrenzen ein.`:` Addresses operational and sampling limits.`):
                         (lang==='pt'?` Aponta restri√ß√µes de escopo e instrumentos.`:lang==='es'?` Se√±ala restricciones de alcance e instrumentos.`:lang==='fr'?` Indique les restrictions de p√©rim√®tre et d‚Äôinstruments.`:lang==='de'?` Nennt Einschr√§nkungen von Umfang und Instrumenten.`:` Notes scope and instrument constraints.`);
        const futAdd = level==='phd'?(lang==='pt'?` Prop√µe agenda de pesquisa e replica√ß√µes com dados abertos.`:lang==='es'?` Propone agenda de investigaci√≥n y r√©plicas con datos abiertos.`:lang==='fr'?` Propose un agenda de recherche et des r√©pliques avec donn√©es ouvertes.`:lang==='de'?` Schl√§gt Forschungsagenda und Replikationen mit offenen Daten vor.`:` Proposes research agenda and replications with open data.`):
                         level==='masters'?(lang==='pt'?` Sugere extens√µes e r√©plicas em contextos distintos.`:lang==='es'?` Sugiere extensiones y r√©plicas en contextos distintos.`:lang==='fr'?` Sugg√®re des extensions et r√©pliques dans des contextes distincts.`:lang==='de'?` Schl√§gt Erweiterungen und Replikationen in verschiedenen Kontexten vor.`:` Suggests extensions and replications in distinct contexts.`):
                         (lang==='pt'?` Indica aplica√ß√µes pr√°ticas e estudos simples de continuidade.`:lang==='es'?` Indica aplicaciones pr√°cticas y estudios simples de continuidad.`:lang==='fr'?` Indique des applications pratiques et des √©tudes de continuit√© simples.`:lang==='de'?` Zeigt praktische Anwendungen und einfache Folgestudien auf.`:` Indicates practical applications and simple continuation studies.`);
        const conclAdd = level==='phd'?(lang==='pt'?` Destaca originalidade e implica√ß√µes te√≥ricas.`:lang==='es'?` Destaca originalidad e implicaciones te√≥ricas.`:lang==='fr'?` Met en avant l‚Äôoriginalit√© et les implications th√©oriques.`:lang==='de'?` Hebt Originalit√§t und theoretische Implikationen hervor.`:` Highlights originality and theoretical implications.`):
                         level==='masters'?(lang==='pt'?` Sublinha robustez e aplicabilidade.`:lang==='es'?` Subraya robustez y aplicabilidad.`:lang==='fr'?` Souligne robustesse et applicabilit√©.`:lang==='de'?` Betont Robustheit und Anwendbarkeit.`:` Underscores robustness and applicability.`):
                         (lang==='pt'?` Refor√ßa aprendizagem de base e utilidade imediata.`:lang==='es'?` Refuerza aprendizaje de base y utilidad inmediata.`:lang==='fr'?` Renforce l‚Äôapprentissage de base et l‚Äôutilit√© imm√©diate.`:lang==='de'?` Verst√§rkt Grundlagenlernen und unmittelbaren Nutzen.`:` Reinforces foundational learning and immediate utility.`);

        const tocLabel = lang==='pt'? 'Sum√°rio' : lang==='es'? 'Contenido' : lang==='fr'? 'Sommaire' : lang==='de'? 'Inhaltsverzeichnis' : 'Table of Contents';
        content += `<h2>${tocLabel}</h2>`;
        content += `<ul><li><a href="#sec-abs">${H.abs}</a></li><li><a href="#sec-intro">${H.intro}</a></li><li><a href="#sec-rq">${H.rq}</a></li><li><a href="#sec-lit">${H.lit}</a></li><li><a href="#sec-meth">${H.meth}</a></li><li><a href="#sec-res">${H.res}</a></li><li><a href="#sec-disc">${H.disc}</a></li><li><a href="#sec-lim">${H.lim}</a></li><li><a href="#sec-fut">${H.fut}</a></li><li><a href="#sec-concl">${H.concl}</a></li><li><a href="#sec-refs">${H.refs}</a></li></ul>`;
        const L = {
            abs: lang==='pt'?`Este trabalho sobre ${topic} apresenta objetivo, m√©todo e principais achados em linguagem clara para facilitar avalia√ß√£o e replica√ß√£o.`:
                 lang==='es'?`Este trabajo sobre ${topic} expone objetivo, m√©todo y hallazgos principales en lenguaje claro para facilitar evaluaci√≥n y r√©plica.`:
                 lang==='fr'?`Ce travail sur ${topic} pr√©sente l‚Äôobjectif, la m√©thode et les principaux r√©sultats en langage clair afin de faciliter l‚Äô√©valuation et la r√©plication.`:
                 lang==='de'?`Diese Arbeit zu ${topic} stellt Ziel, Methode und wichtigste Ergebnisse klar dar, um Bewertung und Replikation zu erleichtern.`:`This work on ${topic} states objective, method, and key findings clearly to support evaluation and replication.`,
            intro: lang==='pt'?`${topic} exige rigor conceitual e operacional. Em ${year}, pesquisas avan√ßam quando hip√≥teses s√£o testadas com m√©todos transparentes e dados observ√°veis.`:
                   lang==='es'?`${topic} requiere rigor conceptual y operativo. En ${year}, la investigaci√≥n avanza cuando las hip√≥tesis se prueban con m√©todos transparentes y datos observables.`:
                   lang==='fr'?`${topic} requiert une rigueur conceptuelle et op√©rationnelle. En ${year}, la recherche progresse quand les hypoth√®ses sont test√©es avec des m√©thodes transparentes et des donn√©es observables.`:
                   lang==='de'?`${topic} verlangt konzeptionelle und operative Strenge. Im ${year} schreitet Forschung voran, wenn Hypothesen mit transparenten Methoden und beobachtbaren Daten gepr√ºft werden.`:`${topic} demands conceptual and operational rigor. In ${year}, research advances when hypotheses are tested with transparent methods and observable data.`,
            rq: lang==='pt'?`Pergunta central: como ${topic} se comporta sob condi√ß√µes controladas? Objetivos: delimitar escopo, definir vari√°veis e estimar efeitos.`:
                lang==='es'?`Pregunta central: ¬øc√≥mo se comporta ${topic} bajo condiciones controladas? Objetivos: delimitar alcance, definir variables y estimar efectos.`:
                lang==='fr'?`Question centrale¬†: comment ${topic} se comporte‚Äët‚Äëil en conditions contr√¥l√©es¬†? Objectifs¬†: d√©limiter le p√©rim√®tre, d√©finir les variables et estimer les effets.`:
                lang==='de'?`Zentrale Frage: Wie verh√§lt sich ${topic} unter kontrollierten Bedingungen? Ziele: Umfang abgrenzen, Variablen definieren und Effekte absch√§tzen.`:`Central question: how does ${topic} behave under controlled conditions? Objectives: delimit scope, define variables, estimate effects.`,
            lit: lang==='pt'?`A literatura recente indica avan√ßos e lacunas. Este trabalho sintetiza correntes principais e posiciona a contribui√ß√£o incremental de ${topic}.`:
                 lang==='es'?`La literatura reciente indica avances y vac√≠os. Este trabajo sintetiza corrientes principales y posiciona la contribuci√≥n incremental de ${topic}.`:
                 lang==='fr'?`La litt√©rature r√©cente montre des avanc√©es et des lacunes. Ce travail synth√©tise les courants principaux et positionne l‚Äôapport incr√©mental de ${topic}.`:
                 lang==='de'?`Die aktuelle Literatur zeigt Fortschritte und L√ºcken. Diese Arbeit fasst Hauptstr√∂mungen zusammen und positioniert den inkrementellen Beitrag von ${topic}.`:`Recent literature shows advances and gaps. This work synthesizes main strands and positions the incremental contribution of ${topic}.`,
            meth: lang==='pt'?`M√©todo: delineamento, amostra, instrumentos, procedimentos e an√°lise. Guardrails √©ticos e reprodutibilidade s√£o descritos.`:
                 lang==='es'?`M√©todo: dise√±o, muestra, instrumentos, procedimientos y an√°lisis. Se describen guardas √©ticas y reproducibilidad.`:
                 lang==='fr'?`M√©thode¬†: design, √©chantillon, instruments, proc√©dures et analyse. Les garde‚Äëfous √©thiques et la reproductibilit√© sont d√©crits.`:
                 lang==='de'?`Methode: Design, Stichprobe, Instrumente, Verfahren und Analyse. Ethische Leitplanken und Reproduzierbarkeit werden beschrieben.`:`Method: design, sample, instruments, procedures, and analysis. Ethical guardrails and reproducibility are detailed.`,
            res: lang==='pt'?`Resultados: efeitos principais, varia√ß√µes por coorte e signific√¢ncia estat√≠stica.`:
                 lang==='es'?`Resultados: efectos principales, variaciones por cohorte y significancia estad√≠stica.`:
                 lang==='fr'?`R√©sultats¬†: effets principaux, variations par cohorte et significativit√© statistique.`:
                 lang==='de'?`Ergebnisse: Haupteffekte, Kohortenvariationen und statistische Signifikanz.`:`Results: main effects, cohort variations, and statistical significance.`,
            disc: lang==='pt'?`Discuss√£o: interpreta√ß√µes, implica√ß√µes e confronto com literatura.`:
                  lang==='es'?`Discusi√≥n: interpretaciones, implicaciones y contraste con la literatura.`:
                  lang==='fr'?`Discussion¬†: interpr√©tations, implications et confrontation √† la litt√©rature.`:
                  lang==='de'?`Diskussion: Interpretationen, Implikationen und Bezug zur Literatur.`:`Discussion: interpretations, implications, and relation to literature.`,
            lim: lang==='pt'?`Limita√ß√µes: escopo, vi√©s, instrumentos e validade externa.`:
                 lang==='es'?`Limitaciones: alcance, sesgo, instrumentos y validez externa.`:
                 lang==='fr'?`Limites¬†: p√©rim√®tre, biais, instruments et validit√© externe.`:
                 lang==='de'?`Grenzen: Umfang, Bias, Instrumente und externe Validit√§t.`:`Limitations: scope, bias, instruments, and external validity.`,
            fut: lang==='pt'?`Trabalhos futuros: replica√ß√µes, extens√µes e aplica√ß√µes pr√°ticas.`:
                 lang==='es'?`Trabajos futuros: replicaciones, extensiones y aplicaciones pr√°cticas.`:
                 lang==='fr'?`Travaux futurs¬†: r√©plications, extensions et applications pratiques.`:
                 lang==='de'?`Zuk√ºnftige Arbeiten: Replikationen, Erweiterungen und praktische Anwendungen.`:`Future work: replications, extensions, and practical applications.`,
            concl: lang==='pt'?`Conclus√£o: s√≠ntese dos achados, utilidade e pr√≥ximos passos.`:
                  lang==='es'?`Conclusi√≥n: s√≠ntesis de hallazgos, utilidad y pr√≥ximos pasos.`:
                  lang==='fr'?`Conclusion¬†: synth√®se des r√©sultats, utilit√© et prochaines √©tapes.`:
                  lang==='de'?`Fazit: Zusammenfassung der Ergebnisse, Nutzen und n√§chste Schritte.`:`Conclusion: synthesis of findings, utility, and next steps.`,
            refsIntro: lang==='pt'?`Refer√™ncias exemplificativas:`:lang==='es'?`Referencias de ejemplo:`:lang==='fr'?`R√©f√©rences d‚Äôexemple¬†:`:lang==='de'?`Beispielhafte Referenzen:`:`Sample references:`
        };

        content += `<h2 id="sec-abs">${H.abs}</h2><p>${L.abs} ${absAdd}</p>`;
        content += `<h2 id="sec-intro">${H.intro}</h2><p>${L.intro}</p>`;
        content += `<h2 id="sec-rq">${H.rq}</h2><p>${L.rq}</p>`;
        const c0 = refsData[0] ? cite(refsData[0], stylePref) : '';
        content += `<h2 id="sec-lit">${H.lit}</h2><p>${L.lit} ${c0}</p>`;
        const c2 = refsData[2] ? cite(refsData[2], stylePref) : '';
        const MB = lang==='pt'?(level==='phd'?[`Desenho multi‚Äëm√©todo/longitudinal`,`Triangula√ß√£o de dados`,`Modelos hier√°rquicos`,`Testes de robustez`]:level==='masters'?[`Amostra estratificada e poder amostral`,`Instrumentos validados`,`Procedimentos replic√°veis`,`An√°lise de sensibilidade`]:[`Amostra b√°sica com crit√©rios objetivos`,`Instrumentos introdut√≥rios`,`Procedimentos claros e replic√°veis`]):
                    lang==='es'?(level==='phd'?[`Dise√±o multi‚Äëm√©todo/longitudinal`,`Triangulaci√≥n de datos`,`Modelos jer√°rquicos`,`Pruebas de robustez`]:level==='masters'?[`Muestra estratificada y poder estad√≠stico`,`Instrumentos validados`,`Procedimientos replicables`,`An√°lisis de sensibilidad`]:[`Muestra b√°sica con criterios objetivos`,`Instrumentos introductorios`,`Procedimientos claros y replicables`]):
                    lang==='fr'?(level==='phd'?[`Design multi‚Äëm√©thodes/longitudinal`,`Triangulation des donn√©es`,`Mod√®les hi√©rarchiques`,`Tests de robustesse`]:level==='masters'?[`√âchantillon stratifi√© et puissance statistique`,`Instruments valid√©s`,`Proc√©dures r√©plicables`,`Analyse de sensibilit√©`]:[`√âchantillon de base avec crit√®res objectifs`,`Instruments introductifs`,`Proc√©dures claires et r√©plicables`]):
                    lang==='de'?(level==='phd'?[`Multi‚ÄëMethoden/longitudinales Design`,`Daten‚ÄëTriangulation`,`Hierarchische Modelle`,`Robustheits‚ÄëTests`]:level==='masters'?[`Stratifizierte Stichprobe und Testst√§rke`,`Validierte Instrumente`,`Replizierbare Verfahren`,`Sensitivit√§tsanalyse`]:[`Grundstichprobe mit objektiven Kriterien`,`Einf√ºhrungsinstrumente`,`Klare, replizierbare Verfahren`]):
                    (level==='phd'?[`Multi‚Äëmethod/longitudinal design`,`Data triangulation`,`Hierarchical models`,`Robustness checks`]:level==='masters'?[`Stratified sample and power analysis`,`Validated instruments`,`Replicable procedures`,`Sensitivity analysis`]:[`Basic sample with objective criteria`,`Introductory instruments`,`Clear, replicable procedures`] );
        content += `<h2 id="sec-meth">${H.meth}</h2><p>${L.meth} ${c2} ${methAdd}</p><ul>${MB.map(li=>`<li>${li}</li>`).join('')}</ul>`;
        const c1 = refsData[1] ? cite(refsData[1], stylePref) : '';
        content += `<h2 id="sec-res">${H.res}</h2><p>${L.res} ${c1} ${resAdd}</p>`;
        content += `<h2 id="sec-disc">${H.disc}</h2><p>${L.disc} ${c0} ${discAdd}</p>`;
        content += `<h2 id="sec-lim">${H.lim}</h2><p>${L.lim}</p>`;
        content += `<h2 id="sec-fut">${H.fut}</h2><p>${L.fut} ${c2} ${futAdd}</p>`;
            const localSymMid = USER_CURRENCY.symbol;
            const localAmtMid = formatPrice(USER_CURRENCY.code, USER_CURRENCY.price);
            const priceLineMid = lang==='pt'?`Assine por ${localSymMid}${localAmtMid}/m√™s`:
                              lang==='es'?`Suscr√≠bete por ${localSymMid}${localAmtMid}/mes`:
                              lang==='fr'?`Abonnez‚Äëvous pour ${localSymMid}${localAmtMid}/mois`:
                              lang==='de'?`Abonnieren f√ºr ${localSymMid}${localAmtMid}/Monat`:`Subscribe for ${localSymMid}${localAmtMid}/month`;
        const ctaHead = lang==='pt'?'Modo Acad√™mico Ativo':'Academic Mode Enabled';
        const ctaLink = lang==='pt'?'Assinar':'Subscribe';
        const installLabel = lang==='pt'?'Instalar App':(lang==='es'?'Instalar App':(lang==='fr'?'Installer l‚ÄôApp':(lang==='de'?'App installieren':'Install App')));
        const chipAndroid = lang==='pt'?'Android':(lang==='es'?'Android':(lang==='fr'?'Android':(lang==='de'?'Android':'Android')));
        const chipIOS = lang==='pt'?'iOS':(lang==='es'?'iOS':(lang==='fr'?'iOS':(lang==='de'?'iOS':'iOS')));
        const chipMac = lang==='pt'?'macOS':(lang==='es'?'macOS':(lang==='fr'?'macOS':(lang==='de'?'macOS':'macOS')));
        const payHref = `${STRIPE_LINK}?client_reference_id=${currentUser?currentUser.email:''}&prefilled_email=${currentUser?currentUser.email:''}`;
        content += `<div class="lux-cta"><h3>${ctaHead}</h3><p>${priceLineMid}</p><div style="display:flex;gap:.5rem;justify-content:center"><a href="${payHref}" target="_blank" rel="noopener">${ctaLink}</a><a href="#" onclick="openInstallGuide()">${installLabel}</a></div><div class="lux-platforms"><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M12 2l3 3-3 3-3-3 3-3zm-6 6l3 3-3 3-3-3 3-3zm12 0l3 3-3 3-3-3 3-3zm-6 6l3 3-3 3-3-3 3-3z"/></svg>${chipAndroid}</a><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M16 2c-2 0-3 1-4 2-1-1-2-2-4-2-3 0-6 3-6 7 0 6 7 10 10 13 3-3 10-7 10-13 0-4-3-7-6-7z"/></svg>${chipIOS}</a><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z M7 7h10v10H7z"/></svg>${chipMac}</a></div></div>`;

        content += `<h2 id="sec-concl">${H.concl}</h2><p>${L.concl} ${conclAdd}</p>`;
        content += `<h2 id="sec-refs">${H.refs}</h2><p>${L.refsIntro}</p><ul>`;
        for (const r of refsData) content += `<li>${fmtRef(r, stylePref, sourceType)}</li>`;
        content += `</ul>`;

        const A = lang==='pt'?{
            method:[
                `Defini√ß√£o de vari√°veis e controles para ${topic}.`,
                `Plano amostral e crit√©rios de inclus√£o para ${topic}.`,
                `Instrumenta√ß√£o para observabilidade e replica√ß√£o.`,
                `Estrat√©gia ${level==='phd'?`multi‚Äëm√©todo`:`de amostragem controlada`} aplicada a ${topic}.`,
                `Valida√ß√£o cruzada e teste de robustez em ${topic}.`,
                `Transpar√™ncia: pr√©‚Äëregistro e dados abertos.`
            ],
            lit:[
                `S√≠ntese das correntes e lacunas na literatura de ${topic}.`,
                `Mapa de debates e converg√™ncias recentes sobre ${topic}.`,
                `Referenciais te√≥ricos contrastantes sobre ${topic}.`,
                `Panorama de m√©todos e limita√ß√µes em ${topic}.`
            ],
            apps:[
                `Aplica√ß√µes pr√°ticas de ${topic} com efeito estimado entre ${num(5,15)}% e ${num(16,28)}%.`,
                `Cen√°rios de uso e implica√ß√µes de ${topic} em ${year}.`,
                `Impacto operacional de ${topic} com ganhos de ${num(12,35)}%.`,
                `Estudos de caso com replica√ß√£o leve em ${year}.`
            ],
            stats:[
                `An√°lise estat√≠stica: testes apropriados, intervalos de confian√ßa e poder amostral.`,
                `Poder alvo ${num(80,95)}% com Œ±=0.${num(1,5)} e IC ${num(90,99)}%.`,
                `Checagens de pressupostos e an√°lises de sensibilidade.`
            ],
            ethics:[
                `Cuidados √©ticos e mitiga√ß√£o de vieses no estudo.`,
                `Privacidade, compliance e governan√ßa de dados.`
            ],
            repl:[
                `Plano de replica√ß√£o e compartilhamento de dados.`,
                `Checklist de replica√ß√£o, materiais e scripts versionados.`
            ]
        }:(lang==='es'?{
            method:[
                `Definici√≥n de variables y controles para ${topic}.`,
                `Plan muestral y criterios de inclusi√≥n para ${topic}.`,
                `Instrumentaci√≥n para observabilidad y r√©plica.`,
                `Estrategia ${level==='phd'?`multi‚Äëm√©todo`:`de muestreo controlado`} aplicada a ${topic}.`,
                `Validaci√≥n cruzada y pruebas de robustez en ${topic}.`,
                `Transparencia: pre‚Äëregistro y datos abiertos.`
            ],
            lit:[
                `S√≠ntesis de corrientes y vac√≠os en la literatura de ${topic}.`,
                `Mapa de debates y convergencias recientes de ${topic}.`,
                `Marcos te√≥ricos contrastantes sobre ${topic}.`,
                `Panorama de m√©todos y limitaciones en ${topic}.`
            ],
            apps:[
                `Aplicaciones pr√°cticas de ${topic} con efecto estimado entre ${num(5,15)}% y ${num(16,28)}%.`,
                `Escenarios de uso e implicaciones en ${year}.`,
                `Impacto operativo de ${topic} con mejoras de ${num(12,35)}%.`,
                `Estudios de caso con r√©plica ligera en ${year}.`
            ],
            stats:[
                `An√°lisis estad√≠stico: pruebas adecuadas, intervalos de confianza y potencia.`,
                `Potencia objetivo ${num(80,95)}% con Œ±=0.${num(1,5)} e IC ${num(90,99)}%.`,
                `Chequeos de supuestos y an√°lisis de sensibilidad.`
            ],
            ethics:[
                `Cuidados √©ticos y mitigaci√≥n de sesgos.`,
                `Privacidad, cumplimiento y gobernanza de datos.`
            ],
            repl:[
                `Plan de r√©plica y datos abiertos.`,
                `Lista de verificaci√≥n, materiales y scripts versionados.`
            ]
        }:(lang==='fr'?{
            method:[
                `D√©finition des variables et contr√¥les pour ${topic}.`,
                `Plan d‚Äô√©chantillonnage et crit√®res d‚Äôinclusion pour ${topic}.`,
                `Instrumentation pour observabilit√© et r√©plication.`,
                `Strat√©gie ${level==='phd'?`multi‚Äëm√©thodes`:`d‚Äô√©chantillonnage contr√¥l√©`} appliqu√©e √† ${topic}.`,
                `Validation crois√©e et tests de robustesse sur ${topic}.`,
                `Transparence¬†: pr√©‚Äëenregistrement et donn√©es ouvertes.`
            ],
            lit:[
                `Synth√®se des courants et lacunes de la litt√©rature sur ${topic}.`,
                `Carte des d√©bats et convergences r√©centes.`,
                `Cadres th√©oriques contrast√©s autour de ${topic}.`,
                `Panorama des m√©thodes et de leurs limites en ${topic}.`
            ],
            apps:[
                `Applications pratiques de ${topic} avec effet estim√© entre ${num(5,15)}% et ${num(16,28)}%.`,
                `Sc√©narios d‚Äôusage et implications en ${year}.`,
                `Impact op√©rationnel de ${topic} avec gains de ${num(12,35)}%.`,
                `√âtudes de cas avec r√©plication l√©g√®re en ${year}.`
            ],
            stats:[
                `Analyse statistique¬†: tests appropri√©s, intervalles de confiance et puissance.`,
                `Puissance cible ${num(80,95)}% avec Œ±=0.${num(1,5)} et IC ${num(90,99)}%.`,
                `V√©rifications d‚Äôhypoth√®ses et analyses de sensibilit√©.`
            ],
            ethics:[
                `Pr√©cautions √©thiques et r√©duction des biais.`,
                `Confidentialit√©, conformit√© et gouvernance des donn√©es.`
            ],
            repl:[
                `Plan de r√©plication et ouverture des donn√©es.`,
                `Liste de contr√¥le, mat√©riels et scripts versionn√©s.`
            ]
        }:(lang==='de'?{
            method:[
                `Definition von Variablen und Kontrollen f√ºr ${topic}.`,
                `Stichprobenplan und Einschlusskriterien f√ºr ${topic}.`,
                `Instrumentierung f√ºr Beobachtbarkeit und Replikation.`,
                `Strategie ${level==='phd'?`Multi‚ÄëMethoden`:`kontrolliertes Sampling`} f√ºr ${topic}.`,
                `Kreuzvalidierung und Robustheits‚ÄëTests f√ºr ${topic}.`,
                `Transparenz: Pr√§registrierung und offene Daten.`
            ],
            lit:[
                `Synthese von Str√∂mungen und L√ºcken in der Literatur zu ${topic}.`,
                `Landkarte aktueller Debatten und Konvergenzen.`,
                `Kontrastierende theoretische Rahmen zu ${topic}.`,
                `√úbersicht √ºber Methoden und deren Grenzen in ${topic}.`
            ],
            apps:[
                `Praktische Anwendungen von ${topic} mit gesch√§tztem Effekt zwischen ${num(5,15)}% und ${num(16,28)}%.`,
                `Nutzungs¬≠szenarien und Implikationen im ${year}.`,
                `Operativer Impact von ${topic} mit Zugewinnen von ${num(12,35)}%.`,
                `Fallstudien mit leichter Replikation im ${year}.`
            ],
            stats:[
                `Statistische Analyse: geeignete Tests, Konfidenzintervalle und Power.`,
                `Angestrebte Testst√§rke ${num(80,95)}% bei Œ±=0.${num(1,5)} und KI ${num(90,99)}%.`,
                `Annahmen pr√ºfen und Sensitivit√§tsanalysen.`
            ],
            ethics:[
                `Ethische Leitplanken und Bias‚ÄëMinderung.`,
                `Datenschutz, Compliance und Daten‚ÄëGovernance.`
            ],
            repl:[
                `Replikationsplan und offene Daten.`,
                `Checkliste, Materialien und versionierte Skripte.`
            ]
        }:{
            method:[
                `Definition of variables and controls for ${topic}.`,
                `Sampling plan and inclusion criteria for ${topic}.`,
                `Instrumentation for observability and replication.`,
                `${level==='phd'?`Multi‚Äëmethod`:`Controlled sampling`} strategy applied to ${topic}.`,
                `Cross‚Äëvalidation and robustness checks for ${topic}.`,
                `Transparency: preregistration and open data.`
            ],
            lit:[
                `Synthesis of strands and gaps in ${topic} literature.`,
                `Map of debates and recent convergences.`,
                `Contrasting theoretical frameworks on ${topic}.`,
                `Overview of methods and their limits in ${topic}.`
            ],
            apps:[
                `Practical applications of ${topic} with estimated effect between ${num(5,15)}% and ${num(16,28)}%.`,
                `Use scenarios and implications in ${year}.`,
                `Operational impact of ${topic} with gains of ${num(12,35)}%.`,
                `Case studies with light replication in ${year}.`
            ],
            stats:[
                `Statistical analysis: appropriate tests, confidence intervals, and power.`,
                `Target power ${num(80,95)}% at Œ±=0.${num(1,5)} and CI ${num(90,99)}%.`,
                `Assumption checks and sensitivity analyses.`
            ],
            ethics:[
                `Ethical guardrails and bias mitigation.`,
                `Privacy, compliance, and data governance.`
            ],
            repl:[
                `Replication plan and open data.`,
                `Replication checklist, materials, and versioned scripts.`
            ]
        })))
        const keys = ['method','lit','apps','stats','ethics','repl'];
        const ix = {method:0, lit:0, apps:0, stats:0, ethics:0, repl:0};
        let k = 0;
        while (count(content) < targetMin && k < 400) {
            const sec = keys[k % keys.length];
            const arr = A[sec];
            const s = arr[ix[sec] % arr.length];
            ix[sec]++;
            content += `<p>${s}</p>`;
            k++;
        }

        const finalCount = count(content);
        return { title: title, content: content, wordCount: finalCount, language: language, style: style, createdAt: new Date().toISOString() };
        } catch (err) {
            console.error('Academic generation error:', err);
        }
    }
    if (!academic) {
        const isPTn = lang==='pt';
        const isENn = lang==='en';
        const isESn = lang==='es';
        const isFRn = lang==='fr';
        const isDEn = lang==='de';
        const s500 = wordCount <= 500;
        const s1000 = wordCount > 500 && wordCount <= 1000;
        const s2000 = wordCount > 1000 && wordCount <= 2000;
        const s5000 = wordCount > 2000;
        const usedGlobal = new Set();
        const pickU = a => { let s = a[Math.floor(R() * a.length)]; let c=0; while(usedGlobal.has(s) && c<a.length){ s=a[Math.floor(R()*a.length)]; c++; } usedGlobal.add(s); return s; };
        const F = s500?{intro:.18,plan:.16,meth:.26,apps:.18,metrics:.12,faq:.05,concl:.05} : s1000?{intro:.14,plan:.12,meth:.22,apps:.18,metrics:.14,faq:.1,concl:.1} : s2000?{intro:.12,plan:.12,meth:.2,apps:.2,metrics:.12,faq:.12,concl:.12} : {intro:.09,plan:.11,meth:.22,apps:.22,metrics:.15,faq:.11,concl:.1};
        const fillFrac = (arr, frac) => { const start = count(content); const targetAdd = Math.max(0, Math.floor((targetMin - start) * frac)); let k=0; while (count(content) < start + targetAdd && k < 300) { content += `<p>${pickU(arr)}</p>`; k++; } };
        let title = isPTn?`${topic} em ${year}: ${style==='creative'?'Narrativa s√≥lida':style==='casual'?'Guia direto':style==='technical'?'Especifica√ß√£o t√©cnica':'Estrat√©gia profissional'}`:
                    isESn?`${topic} en ${year}: ${style==='creative'?'Narrativa s√≥lida':style==='casual'?'Gu√≠a directa':style==='technical'?'Especificaci√≥n t√©cnica':'Estrategia profesional'}`:
                    isFRn?`${topic} en ${year}¬†: ${style==='creative'?'R√©cit solide':style==='casual'?'Guide direct':style==='technical'?'Sp√©cification technique':'Strat√©gie professionnelle'}`:
                    isDEn?`${topic} im ${year}: ${style==='creative'?'Solider Narrativ':style==='casual'?'Direkter Leitfaden':style==='technical'?'Technische Spezifikation':'Professionelle Strategie'}`:
                    `${topic} in ${year}: ${style==='creative'?'Solid narrative':style==='casual'?'Direct guide':style==='technical'?'Technical spec':'Professional strategy'}`;
        const prevTitleN = localStorage.getItem('LAST_ARTICLE_TITLE') || '';
        if (prevTitleN === title) title = `${title} ${num(10,99)}`;
        let content = `${css}<section class="lux-article"><h1>${title}</h1>`;
        const hookN = isPTn?`Estrutura objetiva para ${topic} com foco em clareza, evid√™ncia e aplicabilidade em ${year}.`:
                        isESn?`Estructura objetiva para ${topic} con foco en claridad, evidencia y aplicabilidad en ${year}.`:
                        isFRn?`Structure objective pour ${topic}, ax√©e sur clart√©, preuves et applicabilit√© en ${year}.`:
                        isDEn?`Objektive Struktur f√ºr ${topic} mit Fokus auf Klarheit, Evidenz und Anwendbarkeit im ${year}.`:
                        `Objective structure for ${topic}, focused on clarity, evidence, and applicability in ${year}.`;
        content += `<div class="lux-callout">${hookN}</div>`;
        const HN = {
            intro: isPTn?'Introdu√ß√£o':isESn?'Introducci√≥n':isFRn?'Introduction':isDEn?'Einleitung':'Introduction',
            plan: isPTn?'Plano de A√ß√£o':isESn?'Plan de Acci√≥n':isFRn?'Plan d‚ÄôAction':isDEn?'Aktionsplan':'Action Plan',
            meth: isPTn?'M√©todo e Estrutura':isESn?'M√©todo y Estructura':isFRn?'M√©thode et Structure':isDEn?'Methode und Struktur':'Method and Structure',
            apps: isPTn?'Aplica√ß√µes e Cen√°rios':isESn?'Aplicaciones y Escenarios':isFRn?'Applications et Sc√©narios':isDEn?'Anwendungen und Szenarien':'Applications and Scenarios',
            metrics: isPTn?'M√©tricas e Evid√™ncia':isESn?'M√©tricas y Evidencia':isFRn?'M√©triques et Preuves':isDEn?'Metriken und Evidenz':'Metrics and Evidence',
            faq: isPTn?'Perguntas Frequentes':isESn?'Preguntas Frecuentes':isFRn?'FAQs':isDEn?'FAQs':'FAQs',
            concl: isPTn?'Conclus√£o':isESn?'Conclusi√≥n':isFRn?'Conclusion':isDEn?'Fazit':'Conclusion'
        };
        const S_PT = {
            creative:{
                intro:[
                    `Em ${year}, ${topic} ganha contorno n√≠tido: uma hist√≥ria sem floreios desnecess√°rios, guiada por objetivos claros e resultados observ√°veis.`,
                    `${topic} pede estrutura direta. Em ${year}, o roteiro foca problema, evid√™ncia e a√ß√£o, com leitura fluida e sem rodeios.`,
                    `A jornada de ${topic} em ${year} √© enxuta: contexto, escolha de alavancas e ciclos curtos com prova.`,
                    `Para ${topic}, ${year} traz um mapa simples: clareza de inten√ß√£o, passos concretos e medida de impacto.`,
                    `${topic} avan√ßa quando a escrita √© rigorosa e acess√≠vel: objetivo, m√©todo e efeito em poucas p√°ginas.`
                ],
                plan:[
                    `Mapa de a√ß√£o: definir objetivo, transformar em passos observ√°veis e executar ciclos curtos com revis√£o por evid√™ncia.`,
                    `Agenda pr√°tica: uma alavanca por vez, hip√≥teses claras e medi√ß√£o direta antes de qualquer expans√£o.`,
                    `Sequ√™ncia: diagn√≥stico, mudan√ßa m√≠nima, instrumenta√ß√£o e compara√ß√£o pr√©/p√≥s para decidir com confian√ßa.`,
                    `Trilho: eliminar ru√≠do, focar tarefas com rela√ß√£o causal e documentar apenas o essencial.`,
                    `Fechamento: compor ganhos com repeti√ß√£o disciplinada no mesmo ponto antes de abrir outro.`
                ],
                meth:[
                    `Estrutura: delimita√ß√£o de escopo, defini√ß√£o de vari√°veis, crit√©rios de amostra, instrumentos validados e procedimentos replic√°veis.`,
                    `Fluxo: hip√≥teses expl√≠citas, plano experimental m√≠nimo, observabilidade antes e depois, guardrails e revis√£o r√°pida.`,
                    `Organiza√ß√£o: se√ß√µes curtas, objetivos mensur√°veis e linguagem que privilegia o entendimento imediato.`,
                    `Cad√™ncia: ciclos de ${num(7,14)} dias, registros objetivos e decis√µes baseadas em sinais confi√°veis.`,
                    `Risco: testes seguros com revers√£o simples e documenta√ß√£o sucinta.`
                ],
                apps:[
                    `Aplica√ß√µes pr√°ticas com ganhos entre ${num(8,18)}% e ${num(19,32)}% quando focadas em uma alavanca por vez.`,
                    `Cen√°rios: ado√ß√£o inicial, reten√ß√£o e decis√£o ‚Äî cada um com uma mudan√ßa clara e mensur√°vel.`,
                    `Casos: varia√ß√µes de c√≥pia, fric√ß√£o reduzida e tempo‚Äëao‚Äëvalor encurtado com impacto direto.`,
                    `Na opera√ß√£o, ${topic} mostra efeito em coortes espec√≠ficas; o ajuste fino amplia resultado.`,
                    `Resultados consistentes surgem da repeti√ß√£o disciplinada sobre o mesmo ponto de alavanca.`
                ],
                metrics:[
                    `M√©tricas essenciais: uma principal, duas diagn√≥sticas e um guardrail. Evid√™ncia espec√≠fica evita leituras enviesadas.`,
                    `Acompanhar convers√£o por etapa, lat√™ncia e sinais de sanidade reduz ambiguidade e acelera decis√µes.`,
                    `An√°lise de sensibilidade confirma robustez: cortes por coorte e verifica√ß√£o de pressupostos.`,
                    `Instrumenta√ß√£o pr√©/p√≥s garante atribui√ß√£o: o efeito √© ligado √† mudan√ßa escolhida.`,
                    `Relato conciso com n√∫meros e notas curtas d√° contexto sem perder objetividade.`
                ],
                faq:[
                    `Quanto tempo por ciclo? ${num(7,14)} dias com decis√£o clara no fim.`,
                    `Funciona sem or√ßamento alto? Sim, mudan√ßas m√≠nimas com medi√ß√£o objetiva.`,
                    `E se houver discord√¢ncia? Transformar opini√µes em hip√≥teses test√°veis resolve.`
                ],
                concl:[
                    `Conclus√£o: escolha uma alavanca, execute r√°pido e me√ßa. A disciplina d√° previsibilidade e aprendizado √∫til.`,
                    `Encerramento: clareza, cad√™ncia e evid√™ncia tornam ${topic} pr√°tico e confi√°vel em ${year}.`
                ]
            },
            casual:{
                intro:[`${topic} em ${year} pede um guia direto: o que fazer, como medir e quando ajustar.`,`Vamos simplificar ${topic}: poucos passos, resultados vis√≠veis e linguagem leve.`,`Para come√ßar com ${topic}, foque no b√°sico e acompanhe o que muda de verdade.`,`${topic} funciona melhor quando voc√™ escolhe uma a√ß√£o clara e observa o efeito.`,`Em ${year}, o segredo de ${topic} √© repetir o que funciona e cortar o resto.`],
                plan:[`Plano r√°pido: definir um objetivo, listar 3 a√ß√µes simples e medir cada uma por etapa.`,`Sequ√™ncia curta: escolher uma alavanca, aplicar mudan√ßa m√≠nima e comparar antes/depois.`,`Agenda semanal: dois experimentos, uma decis√£o objetiva no fim da semana.`,`Roteiro: foco em uma m√©trica principal e duas auxiliares para diagnosticar.`,`Fechamento: manter o que funcionou e ajustar o resto sem burocracia.`],
                meth:[`Passo a passo com objetivos simples e instrumentos f√°ceis de aplicar.`,`Hip√≥teses curtas, teste m√≠nimo e acompanhamento objetivo.`,`Anote o antes e depois; decida com base no que mudou.`,`Use ciclos curtos e ajuste r√°pido quando os n√∫meros pedirem.`,`Garanta revers√£o f√°cil se algo sair do esperado.`],
                apps:[`Exemplos pr√°ticos com ganhos entre ${num(6,14)}% e ${num(15,28)}%.`,`Mudan√ßas pequenas em texto ou fluxo j√° fazem diferen√ßa.`,`Aplique onde a aten√ß√£o cai; um ajuste pode destravar.`,`Cortes por grupo mostram onde insistir ou mudar.`,`Repetir o que deu certo aumenta o efeito com pouco esfor√ßo.`],
                metrics:[`Escolha uma m√©trica principal e duas de apoio.`,`Me√ßa por etapa e por grupo para entender melhor.`,`Evite dados gen√©ricos; foque no que guia decis√µes.`,`Inclua um guardrail para evitar efeitos colaterais.`,`Se o resultado for claro, avance; se n√£o, ajuste.`],
                faq:[`Quanto tempo? ${num(7,14)} dias costumam bastar.`,`Precisa de investimento grande? N√£o.`,`E quando h√° opini√µes diferentes? Teste e decida pelo sinal.`],
                concl:[`${topic} fica pr√°tico com foco e medida.`,`Fechar com o que funciona ajuda a manter a cad√™ncia.`]
            },
            technical:{
                intro:[`Contexto de ${topic} em ${year} com objetivos definidos e linguagem precisa.`,`Escopo de ${topic} com vari√°veis, crit√©rios e procedimentos objetivos.`,`Defini√ß√£o operacional clara para infer√™ncia consistente.`,`Princ√≠pios e restri√ß√µes de ${topic} alinhados a resultados mensur√°veis.`,`Estrutura t√©cnica para observabilidade e replica√ß√£o.`],
                plan:[`Plano t√©cnico: hip√≥teses expl√≠citas, delineamento, poder alvo ${num(80,95)}% e Œ±=0.${num(1,5)}.`,`Sequ√™ncia: instrumenta√ß√£o pr√©/p√≥s, sensibilidade e verifica√ß√£o de pressupostos.`,`Opera√ß√£o: amostra estratificada, coortes e procedimentos replic√°veis.`,`Diagn√≥stico: m√©tricas por etapa e guardrails para revers√£o segura.`,`Registro: versionamento de materiais e scripts com hash.`],
                meth:[`Design: amostra, instrumentos, procedimentos, an√°lise. Poder alvo ${num(80,95)}% e Œ±=0.${num(1,5)}.`,`Plano: hip√≥teses, experimento m√≠nimo, coleta pr√©/p√≥s e guardrails.`,`Valida√ß√£o: pressupostos, sensibilidade e cortes por coorte.`,`Atribui√ß√£o: instrumenta√ß√£o garante rela√ß√£o causa‚Äëefeito.`,`Registro: vers√£o de materiais e resultados com hash.`],
                apps:[`Aplica√ß√µes com efeito estimado entre ${num(9,17)}% e ${num(18,30)}% sob condi√ß√µes controladas.`,`Cen√°rios com redu√ß√£o de lat√™ncia e aumento de convers√£o por etapa.`,`Replica√ß√µes leves demonstram consist√™ncia operacional.`,`Ajustes finos maximizam ganho em segmentos alvo.`,`Relatos concisos com tabela de m√©tricas principais.`],
                metrics:[`M√©tricas: principal, duas diagn√≥sticas e um guardrail; IC ${num(90,99)}%.`,`Evid√™ncia observ√°vel por etapa e por coorte.`,`Sensibilidade e verifica√ß√£o de pressupostos.`,`Logs de instrumenta√ß√£o e vers√£o de scripts.`,`Relato autor‚Äëdata simplificado quando aplic√°vel.`],
                faq:[`Janela de ${num(7,14)} dias com decis√£o objetiva.`,`Mudan√ßas m√≠nimas com medi√ß√£o adequada.`,`Testes resolvem diverg√™ncias de opini√£o.`],
                concl:[`S√≠ntese t√©cnica com pr√≥ximos passos mensur√°veis.`,`Aplicabilidade direta em ${year} com risco controlado.`]
            },
            professional:{
                intro:[`${topic} tratado com rigor pr√°tico em ${year}: inten√ß√£o clara, a√ß√£o mensur√°vel e relato objetivo.`,`${topic} exige disciplina: poucas alavancas, observa√ß√£o precisa e decis√£o r√°pida.`,`Estrat√©gia direta para ${topic}: foco, execu√ß√£o e evid√™ncia espec√≠fica.`,`${topic} se beneficia de ciclos curtos e documenta√ß√£o enxuta.`,`Resultados confi√°veis surgem de m√©todo e clareza de linguagem.`],
                plan:[`Plano executivo: priorizar uma alavanca, executar mudan√ßa m√≠nima e medir por etapa.`,`Roteiro: decis√£o em ${num(7,14)} dias com evid√™ncia espec√≠fica e guardrails.`,`Sequ√™ncia: diagn√≥stico, execu√ß√£o enxuta, revis√£o e comunica√ß√£o objetiva.`,`Governan√ßa: visibilidade por coorte, sanidade e atribui√ß√£o inequ√≠voca.`,`Fechamento: ampliar efeito no mesmo ponto antes de abrir novo projeto.`],
                meth:[`Delimita√ß√£o, vari√°veis, amostra, instrumentos, procedimentos e an√°lise com guardrails.`,`Hip√≥teses test√°veis e experimentos m√≠nimos com atribui√ß√£o clara.`,`Medi√ß√£o pr√©/p√≥s e revis√£o semanal.`,`Cortes por coorte, sensibilidade e verifica√ß√£o de pressupostos.`,`Registros e dados essenciais dispon√≠veis.`],
                apps:[`Ganhos t√≠picos entre ${num(8,16)}% e ${num(17,29)}% ao focar um ponto.`,`Casos mostram benef√≠cio em ado√ß√£o e reten√ß√£o.`,`Ajustes simples de fluxo produzem efeito mensur√°vel.`,`Execu√ß√£o alinhada √† prioridade reduz ru√≠do.`,`Relatos breves sustentam comunica√ß√£o executiva.`],
                metrics:[`Uma m√©trica principal e duas auxiliares com guardrail.`,`Evid√™ncia por etapa confirma alavanca.`,`Sensibilidade e sanidade evitam falsos positivos.`,`Decis√µes ancoradas em n√∫meros e contexto curto.`,`Relato objetivo com linguagem neutra.`],
                faq:[`Ciclos de ${num(7,14)} dias.`,`Sem necessidade de grande or√ßamento.`,`Diverg√™ncias resolvidas com testes instrumentados.`],
                concl:[`Fechamento executivo: clareza, cad√™ncia e avan√ßo previs√≠vel.`,`Pr√≥ximo passo: manter foco na mesma alavanca antes de abrir outra.`]
            }
        };

        const S_EN = {
            creative:{intro:[`In ${year}, ${topic} gains sharp focus: a story without fluff, guided by clear goals and observable results.`,`${topic} demands direct structure. In ${year}, the roadmap focuses on problem, evidence, and action.`,`The journey of ${topic} in ${year} is lean: context, lever choice, and short cycles with proof.`,`For ${topic}, ${year} brings a simple map: clear intent, concrete steps, and impact measurement.`,`${topic} advances when writing is rigorous yet accessible: objective, method, and effect in few pages.`],plan:[`Action map: define objective, transform into observable steps, and execute short cycles with evidence review.`,`Practical agenda: one lever at a time, clear hypotheses, and direct measurement before expansion.`,`Sequence: diagnosis, minimal change, instrumentation, and pre/post comparison to decide with confidence.`,`Track: eliminate noise, focus on tasks with causal relation, and document only essentials.`,`Closing: compound gains with disciplined repetition on the same point before opening another.`],meth:[`Structure: scope delimitation, variable definition, sample criteria, validated instruments, and reproducible procedures.`,`Flow: explicit hypotheses, minimal experimental plan, observability before/after, guardrails, and quick review.`,`Organization: short sections, measurable objectives, and language favoring immediate understanding.`,`Cadence: ${num(7,14)}-day cycles, objective records, and decisions based on reliable signals.`,`Risk: safe tests with simple rollback and concise documentation.`],apps:[`Practical applications with gains between ${num(8,18)}% and ${num(19,32)}% when focused on one lever at a time.`,`Scenarios: initial adoption, retention, and decision ‚Äî each with a clear, measurable change.`,`Cases: copy variations, reduced friction, and shortened time-to-value with direct impact.`,`In operation, ${topic} shows effect in specific cohorts; fine-tuning amplifies result.`,`Consistent results emerge from disciplined repetition on the same leverage point.`],metrics:[`Essential metrics: one main, two diagnostic, and one guardrail. Specific evidence avoids biased readings.`,`Track conversion by step, latency, and sanity signals to reduce ambiguity and speed up decisions.`,`Sensitivity analysis confirms robustness: cohort cuts and assumption verification.`,`Pre/post instrumentation ensures attribution: the effect is linked to the chosen change.`,`Concise reporting with numbers and short notes gives context without losing objectivity.`],faq:[`How long per cycle? ${num(7,14)} days with clear decision at the end.`,`Works without big budget? Yes, minimal changes with objective measurement.`,`What about disagreements? Transforming opinions into testable hypotheses resolves them.`],concl:[`Conclusion: choose a lever, execute fast, and measure. Discipline gives predictability and useful learning.`,`Closing: clarity, cadence, and evidence make ${topic} practical and reliable in ${year}.`]},
            casual:{intro:[`${topic} in ${year} asks for a direct guide: what to do, how to measure, and when to adjust.`,`Let's simplify ${topic}: few steps, visible results, and light language.`,`To start with ${topic}, focus on basics and track what really changes.`,`${topic} works best when you choose a clear action and observe the effect.`,`In ${year}, the secret of ${topic} is repeating what works and cutting the rest.`],plan:[`Quick plan: define a goal, list 3 simple actions, and measure each by step.`,`Short sequence: choose a lever, apply minimal change, and compare before/after.`,`Weekly agenda: two experiments, one objective decision at the end of the week.`,`Roadmap: focus on one main metric and two auxiliaries to diagnose.`,`Closing: keep what worked and adjust the rest without bureaucracy.`],meth:[`Step by step with simple goals and easy-to-apply instruments.`,`Short hypotheses, minimal test, and objective tracking.`,`Note before and after; decide based on what changed.`,`Use short cycles and adjust quickly when numbers ask for it.`,`Ensure easy rollback if something goes off track.`],apps:[`Practical examples with gains between ${num(6,14)}% and ${num(15,28)}%.`,`Small changes in text or flow make a difference.`,`Apply where attention drops; an adjustment can unlock value.`,`Group cuts show where to insist or change.`,`Repeating what worked increases effect with little effort.`],metrics:[`Pick one main metric and two supporting ones.`,`Measure by step and group to understand better.`,`Avoid generic data; focus on what guides decisions.`,`Include a guardrail to avoid side effects.`,`If the result is clear, advance; if not, adjust.`],faq:[`How long? ${num(7,14)} days are usually enough.`,`Need big investment? No.`,`Different opinions? Test and decide by the signal.`],concl:[`${topic} gets practical with focus and measure.`,`Closing with what works helps maintain cadence.`]},
            technical:{intro:[`Context of ${topic} in ${year} with defined objectives and precise language.`,`Scope of ${topic} with variables, criteria, and objective procedures.`,`Clear operational definition for consistent inference.`,`Principles and constraints of ${topic} aligned with measurable results.`,`Technical structure for observability and replication.`],plan:[`Technical plan: explicit hypotheses, design, target power ${num(80,95)}% and Œ±=0.${num(1,5)}.`,`Sequence: pre/post instrumentation, sensitivity, and assumption verification.`,`Operation: stratified sample, cohorts, and reproducible procedures.`,`Diagnosis: metrics by step and guardrails for safe rollback.`,`Record: material versioning and scripts with hash.`],meth:[`Design: sample, instruments, procedures, analysis. Target power ${num(80,95)}% and Œ±=0.${num(1,5)}.`,`Plan: hypotheses, minimal experiment, pre/post collection, and guardrails.`,`Validation: assumptions, sensitivity, and cohort cuts.`,`Attribution: instrumentation ensures cause-effect relationship.`,`Record: material version and results with hash.`],apps:[`Applications with estimated effect between ${num(9,17)}% and ${num(18,30)}% under controlled conditions.`,`Scenarios with latency reduction and conversion increase per step.`,`Light replications demonstrate operational consistency.`,`Fine-tuning maximizes gain in target segments.`,`Concise reports with main metrics table.`],metrics:[`Metrics: main, two diagnostic, and one guardrail; CI ${num(90,99)}%.`,`Observable evidence by step and cohort.`,`Sensitivity and assumption verification.`,`Instrumentation logs and script versioning.`,`Simplified author-date report when applicable.`],faq:[`Window of ${num(7,14)} days with objective decision.`,`Minimal changes with adequate measurement.`,`Tests resolve opinion divergences.`],concl:[`Technical synthesis with measurable next steps.`,`Direct applicability in ${year} with controlled risk.`]},
            professional:{intro:[`${topic} treated with practical rigor in ${year}: clear intent, measurable action, and objective reporting.`,`${topic} requires discipline: few levers, precise observation, and quick decision.`,`Direct strategy for ${topic}: focus, execution, and specific evidence.`,`${topic} benefits from short cycles and lean documentation.`,`Reliable results come from method and language clarity.`],plan:[`Executive plan: prioritize one lever, execute minimal change, and measure by step.`,`Roadmap: decision in ${num(7,14)} days with specific evidence and guardrails.`,`Sequence: diagnosis, lean execution, review, and objective communication.`,`Governance: visibility by cohort, sanity, and unequivocal attribution.`,`Closing: amplify effect on the same point before opening new project.`],meth:[`Delimitation, variables, sample, instruments, procedures, and analysis with guardrails.`,`Testable hypotheses and minimal experiments with clear attribution.`,`Pre/post measurement and weekly review.`,`Cohort cuts, sensitivity, and assumption verification.`,`Essential records and data available.`],apps:[`Typical gains between ${num(8,16)}% and ${num(17,29)}% when focusing on a point.`,`Cases show benefit in adoption and retention.`,`Simple flow adjustments produce measurable effect.`,`Aligned execution reduces noise.`,`Brief reports sustain executive communication.`],metrics:[`One main metric and two auxiliaries with guardrail.`,`Evidence by step confirms lever.`,`Sensitivity and sanity avoid false positives.`,`Decisions anchored in numbers and short context.`,`Objective report with neutral language.`],faq:[`Cycles of ${num(7,14)} days.`,`No need for big budget.`,`Divergences resolved with instrumented tests.`],concl:[`Executive closing: clarity, cadence, and predictable advance.`,`Next step: keep focus on the same lever before opening another.`]}
        };

        const S_ES = {
            creative:{intro:[`En ${year}, ${topic} gana contorno n√≠tido: una historia sin adornos, guiada por objetivos claros.`,`${topic} pide estructura directa. En ${year}, el guion enfoca problema, evidencia y acci√≥n.`,`La jornada de ${topic} en ${year} es √°gil: contexto, elecci√≥n de palancas y ciclos cortos.`,`Para ${topic}, ${year} trae un mapa simple: claridad de intenci√≥n y pasos concretos.`,`${topic} avanza cuando la escritura es rigurosa y accesible: objetivo y m√©todo en pocas p√°ginas.`],plan:[`Mapa de acci√≥n: definir objetivo, transformar en pasos observables y ejecutar ciclos cortos.`,`Agenda pr√°ctica: una palanca a la vez, hip√≥tesis claras y medici√≥n directa.`,`Secuencia: diagn√≥stico, cambio m√≠nimo, instrumentaci√≥n y comparaci√≥n pre/post.`,`Camino: eliminar ruido, enfocar tareas con relaci√≥n causal y documentar lo esencial.`,`Cierre: componer ganancias con repetici√≥n disciplinada en el mismo punto.`],meth:[`Estructura: delimitaci√≥n de alcance, definici√≥n de variables y criterios de muestra.`,`Flujo: hip√≥tesis expl√≠citas, plan experimental m√≠nimo y observabilidad antes/despu√©s.`,`Organizaci√≥n: secciones cortas, objetivos medibles y lenguaje claro.`,`Cadencia: ciclos de ${num(7,14)} d√≠as, registros objetivos y decisiones basadas en se√±ales.`,`Riesgo: pruebas seguras con reversi√≥n simple y documentaci√≥n sucinta.`],apps:[`Aplicaciones pr√°cticas con ganancias entre ${num(8,18)}% y ${num(19,32)}% al enfocar una palanca.`,`Escenarios: adopci√≥n inicial, retenci√≥n y decisi√≥n ‚Äî cada uno con cambio medible.`,`Casos: variaciones de copia, fricci√≥n reducida y tiempo-al-valor acortado.`,`En operaci√≥n, ${topic} muestra efecto en cohortes espec√≠ficas.`,`Resultados consistentes surgen de la repetici√≥n disciplinada.`],metrics:[`M√©tricas esenciales: una principal, dos diagn√≥sticas y un guardrail.`,`Acompa√±ar conversi√≥n por etapa, latencia y se√±ales de sanidad.`,`An√°lisis de sensibilidad confirma robustez y verificaci√≥n de supuestos.`,`Instrumentaci√≥n pre/post garantiza atribuci√≥n del efecto.`,`Relato conciso con n√∫meros y notas cortas da contexto sin perder objetividad.`],faq:[`¬øCu√°nto tiempo por ciclo? ${num(7,14)} d√≠as con decisi√≥n clara.`,`¬øFunciona sin gran presupuesto? S√≠, cambios m√≠nimos con medici√≥n.`,`¬øY si hay desacuerdo? Transformar opiniones en hip√≥tesis testables.`],concl:[`Conclusi√≥n: elija una palanca, ejecute r√°pido y mida.`,`Cierre: claridad, cadencia y evidencia hacen ${topic} pr√°ctico en ${year}.`]},
            casual:{intro:[`${topic} en ${year} pide una gu√≠a directa: qu√© hacer, c√≥mo medir y cu√°ndo ajustar.`,`Vamos a simplificar ${topic}: pocos pasos, resultados visibles y lenguaje ligero.`,`Para empezar con ${topic}, enfoque en lo b√°sico y acompa√±e lo que cambia de verdad.`,`${topic} funciona mejor cuando elige una acci√≥n clara y observa el efecto.`,`En ${year}, el secreto de ${topic} es repetir lo que funciona y cortar el resto.`],plan:[`Plan r√°pido: definir un objetivo, listar 3 acciones simples y medir.`,`Secuencia corta: elegir una palanca, aplicar cambio m√≠nimo y comparar.`,`Agenda semanal: dos experimentos, una decisi√≥n objetiva al fin de semana.`,`Guion: foco en una m√©trica principal y dos auxiliares para diagnosticar.`,`Cierre: mantener lo que funcion√≥ y ajustar el resto sin burocracia.`],meth:[`Paso a paso con objetivos simples e instrumentos f√°ciles de aplicar.`,`Hip√≥tesis cortas, prueba m√≠nima y seguimiento objetivo.`,`Anote el antes y despu√©s; decida con base en lo que cambi√≥.`,`Use ciclos cortos y ajuste r√°pido cuando los n√∫meros lo pidan.`,`Garantice reversi√≥n f√°cil si algo sale de lo esperado.`],apps:[`Ejemplos pr√°cticos con ganancias entre ${num(6,14)}% y ${num(15,28)}%.`,`Cambios peque√±os en texto o flujo ya hacen diferencia.`,`Aplique donde la atenci√≥n cae; un ajuste puede destrabar.`,`Cortes por grupo muestran d√≥nde insistir o cambiar.`,`Repetir lo que dio cierto aumenta el efecto con poco esfuerzo.`],metrics:[`Elija una m√©trica principal y dos de apoyo.`,`Mida por etapa y por grupo para entender mejor.`,`Evite datos gen√©ricos; enfoque en lo que gu√≠a decisiones.`,`Incluya un guardrail para evitar efectos colaterales.`,`Si el resultado es claro, avance; si no, ajuste.`],faq:[`¬øCu√°nto tiempo? ${num(7,14)} d√≠as suelen bastar.`,`¬øNecesita gran inversi√≥n? No.`,`¬øY opiniones diferentes? Pruebe y decida por la se√±al.`],concl:[`${topic} se vuelve pr√°ctico con foco y medida.`,`Cerrar con lo que funciona ayuda a mantener la cadencia.`]},
            technical:{intro:[`Contexto de ${topic} en ${year} con objetivos definidos y lenguaje preciso.`,`Alcance de ${topic} con variables, criterios y procedimientos objetivos.`,`Definici√≥n operacional clara para inferencia consistente.`,`Principios y restricciones de ${topic} alineados a resultados medibles.`,`Estructura t√©cnica para observabilidad y replicaci√≥n.`],plan:[`Plan t√©cnico: hip√≥tesis expl√≠citas, dise√±o, poder objetivo ${num(80,95)}% y Œ±=0.${num(1,5)}.`,`Secuencia: instrumentaci√≥n pre/post, sensibilidad y verificaci√≥n de supuestos.`,`Operaci√≥n: muestra estratificada, cohortes y procedimientos replicables.`,`Diagn√≥stico: m√©tricas por etapa y guardrails para reversi√≥n segura.`,`Registro: versionamiento de materiales y scripts con hash.`],meth:[`Dise√±o: muestra, instrumentos, procedimientos, an√°lisis. Poder objetivo ${num(80,95)}% y Œ±=0.${num(1,5)}.`,`Plan: hip√≥tesis, experimento m√≠nimo, recolecci√≥n pre/post y guardrails.`,`Validaci√≥n: supuestos, sensibilidad y cortes por cohorte.`,`Atribuci√≥n: instrumentaci√≥n garantiza relaci√≥n causa-efecto.`,`Registro: versi√≥n de material y resultados con hash.`],apps:[`Aplicaciones con efecto estimado entre ${num(9,17)}% y ${num(18,30)}% bajo condiciones controladas.`,`Escenarios con reducci√≥n de latencia y aumento de conversi√≥n por etapa.`,`Replicaciones ligeras demuestran consistencia operacional.`,`Ajustes finos maximizan ganancia en segmentos objetivo.`,`Relatos concisos con tabla de m√©tricas principales.`],metrics:[`M√©tricas: principal, dos diagn√≥sticas y un guardrail; IC ${num(90,99)}%.`,`Evidencia observable por etapa y cohorte.`,`Sensibilidad y verificaci√≥n de supuestos.`,`Logs de instrumentaci√≥n y versionamiento de scripts.`,`Relato autor-fecha simplificado cuando aplicable.`],faq:[`Ventana de ${num(7,14)} d√≠as con decisi√≥n objetiva.`,`Cambios m√≠nimos con medici√≥n adecuada.`,`Pruebas resuelven divergencias de opini√≥n.`],concl:[`S√≠ntesis t√©cnica con pr√≥ximos pasos medibles.`,`Aplicabilidad directa en ${year} con riesgo controlado.`]},
            professional:{intro:[`${topic} tratado con rigor pr√°ctico en ${year}: intenci√≥n clara y acci√≥n medible.`,`${topic} exige disciplina: pocas palancas, observaci√≥n precisa y decisi√≥n r√°pida.`,`Estrategia directa para ${topic}: foco, ejecuci√≥n y evidencia espec√≠fica.`,`${topic} se beneficia de ciclos cortos y documentaci√≥n √°gil.`,`Resultados confiables surgen de m√©todo y claridad de lenguaje.`],plan:[`Plan ejecutivo: priorizar una palanca, ejecutar cambio m√≠nimo y medir.`,`Guion: decisi√≥n en ${num(7,14)} d√≠as con evidencia espec√≠fica y guardrails.`,`Secuencia: diagn√≥stico, ejecuci√≥n √°gil, revisi√≥n y comunicaci√≥n objetiva.`,`Gobernanza: visibilidad por cohorte, sanidad y atribuci√≥n inequ√≠voca.`,`Cierre: ampliar efecto en el mismo punto antes de abrir nuevo proyecto.`],meth:[`Delimitaci√≥n, variables, muestra, instrumentos, procedimientos y an√°lisis.`,`Hip√≥tesis testables y experimentos m√≠nimos con atribuci√≥n clara.`,`Medici√≥n pre/post y revisi√≥n semanal.`,`Cortes por cohorte, sensibilidad y verificaci√≥n de supuestos.`,`Registros y datos esenciales disponibles.`],apps:[`Ganancias t√≠picas entre ${num(8,16)}% y ${num(17,29)}% al enfocar un punto.`,`Casos muestran beneficio en adopci√≥n y retenci√≥n.`,`Ajustes simples de flujo producen efecto medible.`,`Ejecuci√≥n alineada a la prioridad reduce ruido.`,`Relatos breves sostienen comunicaci√≥n ejecutiva.`],metrics:[`Una m√©trica principal y dos auxiliares con guardrail.`,`Evidencia por etapa confirma palanca.`,`Sensibilidad y sanidad evitan falsos positivos.`,`Decisiones ancladas en n√∫meros y contexto corto.`,`Relato objetivo con lenguaje neutral.`],faq:[`Ciclos de ${num(7,14)} d√≠as.`,`Sin necesidad de gran presupuesto.`,`Divergencias resueltas con pruebas instrumentadas.`],concl:[`Cierre ejecutivo: claridad, cadencia y avance previsible.`,`Pr√≥ximo paso: mantener foco en la misma palanca antes de abrir otra.`]}
        };

        const S_FR = {
            creative:{intro:[`En ${year}, ${topic} gagne un contour net : une histoire sans fioritures, guid√©e par des objectifs clairs.`,`${topic} demande une structure directe. En ${year}, la feuille de route se concentre sur le probl√®me et l'action.`,`Le parcours de ${topic} en ${year} est simple : contexte, choix de levier et cycles courts.`,`Pour ${topic}, ${year} apporte une carte simple : clart√© d'intention et √©tapes concr√®tes.`,`${topic} avance quand l'√©criture est rigoureuse et accessible : objectif et m√©thode en quelques pages.`],plan:[`Carte d'action : d√©finir l'objectif, transformer en √©tapes observables et ex√©cuter des cycles courts.`,`Agenda pratique : un levier √† la fois, hypoth√®ses claires et mesure directe.`,`S√©quence : diagnostic, changement minimal, instrumentation et comparaison pr√©/post.`,`Piste : √©liminer le bruit, se concentrer sur les t√¢ches causales et documenter l'essentiel.`,`Cl√¥ture : composer les gains avec une r√©p√©tition disciplin√©e sur le m√™me point.`],meth:[`Structure : d√©limitation de la port√©e, d√©finition des variables et crit√®res d'√©chantillon.`,`Flux : hypoth√®ses explicites, plan exp√©rimental minimal et observabilit√© avant/apr√®s.`,`Organisation : sections courtes, objectifs mesurables et langage clair.`,`Cadence : cycles de ${num(7,14)} jours, enregistrements objectifs et d√©cisions bas√©es sur des signaux.`,`Risque : tests s√ªrs avec retour en arri√®re simple et documentation succincte.`],apps:[`Applications pratiques avec des gains entre ${num(8,18)}% et ${num(19,32)}% en se concentrant sur un levier.`,`Sc√©narios : adoption initiale, r√©tention et d√©cision ‚Äî chacun avec un changement mesurable.`,`Cas : variations de copie, friction r√©duite et temps de valorisation raccourci.`,`En op√©ration, ${topic} montre un effet dans des cohortes sp√©cifiques.`,`Des r√©sultats coh√©rents √©mergent d'une r√©p√©tition disciplin√©e.`],metrics:[`M√©triques essentielles : une principale, deux diagnostiques et un garde-fou.`,`Suivre la conversion par √©tape, la latence et les signaux de sant√©.`,`L'analyse de sensibilit√© confirme la robustesse et la v√©rification des hypoth√®ses.`,`L'instrumentation pr√©/post garantit l'attribution de l'effet.`,`Un rapport concis avec des chiffres et des notes courtes donne le contexte.`],faq:[`Combien de temps par cycle ? ${num(7,14)} jours avec une d√©cision claire.`,`Fonctionne sans gros budget ? Oui, changements minimes avec mesure.`,`Et en cas de d√©saccord ? Transformer les opinions en hypoth√®ses testables.`],concl:[`Conclusion : choisissez un levier, ex√©cutez rapidement et mesurez.`,`Cl√¥ture : clart√©, cadence et preuves rendent ${topic} pratique en ${year}.`]},
            casual:{intro:[`${topic} en ${year} demande un guide direct : quoi faire, comment mesurer et quand ajuster.`,`Simplifions ${topic} : peu d'√©tapes, r√©sultats visibles et langage l√©ger.`,`Pour commencer avec ${topic}, concentrez-vous sur l'essentiel et suivez ce qui change vraiment.`,`${topic} fonctionne mieux lorsque vous choisissez une action claire et observez l'effet.`,`En ${year}, le secret de ${topic} est de r√©p√©ter ce qui fonctionne et de couper le reste.`],plan:[`Plan rapide : d√©finir un objectif, lister 3 actions simples et mesurer.`,`S√©quence courte : choisir un levier, appliquer un changement minimal et comparer.`,`Agenda hebdomadaire : deux exp√©riences, une d√©cision objective en fin de semaine.`,`Feuille de route : focus sur une m√©trique principale et deux auxiliaires.`,`Cl√¥ture : garder ce qui a fonctionn√© et ajuster le reste sans bureaucratie.`],meth:[`Pas √† pas avec des objectifs simples et des instruments faciles √† appliquer.`,`Hypoth√®ses courtes, test minimal et suivi objectif.`,`Notez l'avant et l'apr√®s ; d√©cidez en fonction de ce qui a chang√©.`,`Utilisez des cycles courts et ajustez rapidement lorsque les chiffres le demandent.`,`Garantissez un retour facile si quelque chose ne va pas.`],apps:[`Exemples pratiques avec des gains entre ${num(6,14)}% et ${num(15,28)}%.`,`De petits changements de texte ou de flux font d√©j√† la diff√©rence.`,`Appliquez o√π l'attention tombe ; un ajustement peut d√©bloquer.`,`Les coupes par groupe montrent o√π insister ou changer.`,`R√©p√©ter ce qui a fonctionn√© augmente l'effet avec peu d'effort.`],metrics:[`Choisissez une m√©trique principale et deux de soutien.`,`Mesurez par √©tape et par groupe pour mieux comprendre.`,`√âvitez les donn√©es g√©n√©riques ; concentrez-vous sur ce qui guide les d√©cisions.`,`Incluez un garde-fou pour √©viter les effets secondaires.`,`Si le r√©sultat est clair, avancez ; sinon, ajustez.`],faq:[`Combien de temps ? ${num(7,14)} jours suffisent g√©n√©ralement.`,`Besoin d'un gros investissement ? Non.`,`Et des opinions diff√©rentes ? Testez et d√©cidez par le signal.`],concl:[`${topic} devient pratique avec focus et mesure.`,`Conclure avec ce qui fonctionne aide √† maintenir la cadence.`]},
            technical:{intro:[`Contexte de ${topic} en ${year} avec des objectifs d√©finis et un langage pr√©cis.`,`Port√©e de ${topic} avec variables, crit√®res et proc√©dures objectives.`,`D√©finition op√©rationnelle claire pour une inf√©rence coh√©rente.`,`Principes et contraintes de ${topic} align√©s sur des r√©sultats mesurables.`,`Structure technique pour l'observabilit√© et la r√©plication.`],plan:[`Plan technique : hypoth√®ses explicites, conception, puissance cible ${num(80,95)}% et Œ±=0.${num(1,5)}.`,`S√©quence : instrumentation pr√©/post, sensibilit√© et v√©rification des hypoth√®ses.`,`Op√©ration : √©chantillon stratifi√©, cohortes et proc√©dures reproductibles.`,`Diagnostic : m√©triques par √©tape et garde-fous pour un retour s√ªr.`,`Enregistrement : versionnage des mat√©riaux et scripts avec hachage.`],meth:[`Conception : √©chantillon, instruments, proc√©dures, analyse. Puissance cible ${num(80,95)}%.`,`Plan : hypoth√®ses, exp√©rience minimale, collecte pr√©/post et garde-fous.`,`Validation : hypoth√®ses, sensibilit√© et coupes de cohorte.`,`Attribution : l'instrumentation garantit la relation cause-effet.`,`Enregistrement : version du mat√©riel et r√©sultats avec hachage.`],apps:[`Applications avec effet estim√© entre ${num(9,17)}% et ${num(18,30)}% sous conditions contr√¥l√©es.`,`Sc√©narios avec r√©duction de latence et augmentation de conversion par √©tape.`,`Les r√©plications l√©g√®res d√©montrent une coh√©rence op√©rationnelle.`,`Les r√©glages fins maximisent le gain dans les segments cibles.`,`Rapports concis avec tableau des m√©triques principales.`],metrics:[`M√©triques : principale, deux diagnostiques et un garde-fou ; IC ${num(90,99)}%.`,`Preuve observable par √©tape et cohorte.`,`Sensibilit√© et v√©rification des hypoth√®ses.`,`Journaux d'instrumentation et versionnage de scripts.`,`Rapport auteur-date simplifi√© si applicable.`],faq:[`Fen√™tre de ${num(7,14)} jours avec d√©cision objective.`,`Changements minimes avec mesure ad√©quate.`,`Les tests r√©solvent les divergences d'opinion.`],concl:[`Synth√®se technique avec prochaines √©tapes mesurables.`,`Applicabilit√© directe en ${year} avec risque contr√¥l√©.`]},
            professional:{intro:[`${topic} trait√© avec rigueur pratique en ${year} : intention claire et action mesurable.`,`${topic} exige de la discipline : peu de leviers, observation pr√©cise et d√©cision rapide.`,`Strat√©gie directe pour ${topic} : focus, ex√©cution et preuves sp√©cifiques.`,`${topic} b√©n√©ficie de cycles courts et d'une documentation all√©g√©e.`,`Des r√©sultats fiables proviennent de la m√©thode et de la clart√© du langage.`],plan:[`Plan ex√©cutif : prioriser un levier, ex√©cuter un changement minimal et mesurer.`,`Feuille de route : d√©cision dans ${num(7,14)} jours avec preuves sp√©cifiques.`,`S√©quence : diagnostic, ex√©cution all√©g√©e, r√©vision et communication objective.`,`Gouvernance : visibilit√© par cohorte, sant√© et attribution sans √©quivoque.`,`Cl√¥ture : amplifier l'effet sur le m√™me point avant d'ouvrir un nouveau projet.`],meth:[`D√©limitation, variables, √©chantillon, instruments, proc√©dures et analyse.`,`Hypoth√®ses testables et exp√©riences minimales avec attribution claire.`,`Mesure pr√©/post et r√©vision hebdomadaire.`,`Coupes de cohorte, sensibilit√© et v√©rification des hypoth√®ses.`,`Enregistrements et donn√©es essentiels disponibles.`],apps:[`Gains typiques entre ${num(8,16)}% et ${num(17,29)}% en se concentrant sur un point.`,`Les cas montrent un b√©n√©fice en adoption et r√©tention.`,`De simples ajustements de flux produisent un effet mesurable.`,`Une ex√©cution align√©e sur la priorit√© r√©duit le bruit.`,`Des rapports brefs soutiennent la communication ex√©cutive.`],metrics:[`Une m√©trique principale et deux auxiliaires avec garde-fou.`,`La preuve par √©tape confirme le levier.`,`Sensibilit√© et sant√© √©vitent les faux positifs.`,`D√©cisions ancr√©es dans les chiffres et contexte court.`,`Rapport objectif avec langage neutre.`],faq:[`Cycles de ${num(7,14)} jours.`,`Pas besoin de gros budget.`,`Divergences r√©solues par des tests instrument√©s.`],concl:[`Cl√¥ture ex√©cutive : clart√©, cadence et avance pr√©visible.`,`Prochaine √©tape : garder le focus sur le m√™me levier avant d'en ouvrir un autre.`]}
        };

        const S_DE = {
            creative:{intro:[`Im Jahr ${year} gewinnt ${topic} an scharfer Kontur: eine Geschichte ohne Schn√∂rkel, geleitet von klaren Zielen.`,`${topic} verlangt direkte Struktur. Im Jahr ${year} konzentriert sich der Fahrplan auf Problem und Aktion.`,`Die Reise von ${topic} im Jahr ${year} ist schlank: Kontext, Hebelwahl und kurze Zyklen.`,`F√ºr ${topic} bringt ${year} eine einfache Karte: klare Absicht und konkrete Schritte.`,`${topic} kommt voran, wenn das Schreiben rigoros und zug√§nglich ist: Ziel und Methode auf wenigen Seiten.`],plan:[`Aktionskarte: Ziel definieren, in beobachtbare Schritte umwandeln und kurze Zyklen ausf√ºhren.`,`Praktische Agenda: ein Hebel nach dem anderen, klare Hypothesen und direkte Messung.`,`Sequenz: Diagnose, minimale √Ñnderung, Instrumentierung und Vorher/Nachher-Vergleich.`,`Pfad: Rauschen eliminieren, Aufgaben mit kausalem Bezug fokussieren und nur das Wesentliche dokumentieren.`,`Abschluss: Gewinne durch disziplinierte Wiederholung am selben Punkt zusammensetzen.`],meth:[`Struktur: Umfangsabgrenzung, Variablendefinition und Stichprobenkriterien.`,`Fluss: explizite Hypothesen, minimaler Versuchsplan und Beobachtbarkeit vorher/nachher.`,`Organisation: kurze Abschnitte, messbare Ziele und klare Sprache.`,`Kadenz: Zyklen von ${num(7,14)} Tagen, objektive Aufzeichnungen und Entscheidungen basierend auf Signalen.`,`Risiko: sichere Tests mit einfacher R√ºcknahme und knapper Dokumentation.`],apps:[`Praktische Anwendungen mit Gewinnen zwischen ${num(8,18)}% und ${num(19,32)}% bei Fokus auf einen Hebel.`,`Szenarien: anf√§ngliche Akzeptanz, Bindung und Entscheidung ‚Äî jeweils mit messbarer √Ñnderung.`,`F√§lle: Textvariationen, reduzierte Reibung und verk√ºrzte Time-to-Value.`,`Im Betrieb zeigt ${topic} Wirkung in spezifischen Kohorten.`,`Konsistente Ergebnisse entstehen durch disziplinierte Wiederholung.`],metrics:[`Wesentliche Metriken: eine Haupt-, zwei Diagnose- und eine Leitplanke.`,`Verfolgung der Konversion pro Schritt, Latenz und Gesundheitssignale.`,`Sensitivit√§tsanalyse best√§tigt Robustheit und √úberpr√ºfung von Annahmen.`,`Vorher/Nachher-Instrumentierung garantiert Zuordnung des Effekts.`,`Ein pr√§gnanter Bericht mit Zahlen und kurzen Notizen gibt Kontext.`],faq:[`Wie lange pro Zyklus? ${num(7,14)} Tage mit klarer Entscheidung.`,`Funktioniert ohne gro√ües Budget? Ja, minimale √Ñnderungen mit Messung.`,`Und bei Meinungsverschiedenheiten? Meinungen in testbare Hypothesen umwandeln.`],concl:[`Fazit: W√§hlen Sie einen Hebel, f√ºhren Sie schnell aus und messen Sie.`,`Abschluss: Klarheit, Kadenz und Beweise machen ${topic} im Jahr ${year} praktisch.`]},
            casual:{intro:[`${topic} im Jahr ${year} verlangt einen direkten Leitfaden: was zu tun ist, wie man misst und wann man anpasst.`,`Vereinfachen wir ${topic}: wenige Schritte, sichtbare Ergebnisse und leichte Sprache.`,`Um mit ${topic} zu beginnen, konzentrieren Sie sich auf die Grundlagen und verfolgen Sie, was sich wirklich √§ndert.`,`${topic} funktioniert am besten, wenn Sie eine klare Aktion w√§hlen und den Effekt beobachten.`,`Im Jahr ${year} ist das Geheimnis von ${topic}, das zu wiederholen, was funktioniert, und den Rest zu streichen.`],plan:[`Schneller Plan: ein Ziel definieren, 3 einfache Aktionen auflisten und messen.`,`Kurze Sequenz: einen Hebel w√§hlen, minimale √Ñnderung anwenden und vergleichen.`,`Wochenagenda: zwei Experimente, eine objektive Entscheidung am Wochenende.`,`Fahrplan: Fokus auf eine Hauptmetrik und zwei Hilfsmetriken zur Diagnose.`,`Abschluss: behalten, was funktioniert hat, und den Rest ohne B√ºrokratie anpassen.`],meth:[`Schritt f√ºr Schritt mit einfachen Zielen und leicht anzuwendenden Instrumenten.`,`Kurze Hypothesen, minimaler Test und objektive Verfolgung.`,`Notieren Sie das Vorher und Nachher; entscheiden Sie basierend auf dem, was sich ge√§ndert hat.`,`Nutzen Sie kurze Zyklen und passen Sie schnell an, wenn die Zahlen es verlangen.`,`Gew√§hrleisten Sie einfache R√ºcknahme, wenn etwas vom Weg abkommt.`],apps:[`Praktische Beispiele mit Gewinnen zwischen ${num(6,14)}% und ${num(15,28)}%.`,`Kleine √Ñnderungen im Text oder Fluss machen bereits einen Unterschied.`,`Wenden Sie an, wo die Aufmerksamkeit f√§llt; eine Anpassung kann Werte freisetzen.`,`Gruppenschnitte zeigen, wo man bestehen oder √§ndern sollte.`,`Das Wiederholen dessen, was funktioniert hat, erh√∂ht den Effekt mit wenig Aufwand.`],metrics:[`W√§hlen Sie eine Hauptmetrik und zwei unterst√ºtzende.`,`Messen Sie pro Schritt und Gruppe, um besser zu verstehen.`,`Vermeiden Sie generische Daten; konzentrieren Sie sich auf das, was Entscheidungen leitet.`,`F√ºgen Sie eine Leitplanke hinzu, um Nebenwirkungen zu vermeiden.`,`Wenn das Ergebnis klar ist, weitergehen; wenn nicht, anpassen.`],faq:[`Wie lange? ${num(7,14)} Tage reichen gew√∂hnlich aus.`,`Gro√üe Investition n√∂tig? Nein.`,`Und unterschiedliche Meinungen? Testen und nach Signal entscheiden.`],concl:[`${topic} wird mit Fokus und Ma√ü praktisch.`,`Mit dem schlie√üen, was funktioniert, hilft, die Kadenz zu halten.`]},
            technical:{intro:[`Kontext von ${topic} im Jahr ${year} mit definierten Zielen und pr√§ziser Sprache.`,`Umfang von ${topic} mit Variablen, Kriterien und objektiven Verfahren.`,`Klare operationale Definition f√ºr konsistente Inferenz.`,`Prinzipien und Einschr√§nkungen von ${topic} ausgerichtet auf messbare Ergebnisse.`,`Technische Struktur f√ºr Beobachtbarkeit und Replikation.`],plan:[`Technischer Plan: explizite Hypothesen, Design, Zielst√§rke ${num(80,95)}% und Œ±=0.${num(1,5)}.`,`Sequenz: Vorher/Nachher-Instrumentierung, Sensitivit√§t und √úberpr√ºfung von Annahmen.`,`Betrieb: geschichtete Stichprobe, Kohorten und reproduzierbare Verfahren.`,`Diagnose: Metriken pro Schritt und Leitplanken f√ºr sichere R√ºcknahme.`,`Aufzeichnung: Versionierung von Materialien und Skripten mit Hash.`],meth:[`Design: Stichprobe, Instrumente, Verfahren, Analyse. Zielst√§rke ${num(80,95)}%.`,`Plan: Hypothesen, minimales Experiment, Vorher/Nachher-Sammlung und Leitplanken.`,`Validierung: Annahmen, Sensitivit√§t und Kohortenschnitte.`,`Zuordnung: Instrumentierung garantiert Ursache-Wirkungs-Beziehung.`,`Aufzeichnung: Version von Material und Ergebnissen mit Hash.`],apps:[`Anwendungen mit gesch√§tztem Effekt zwischen ${num(9,17)}% und ${num(18,30)}% unter kontrollierten Bedingungen.`,`Szenarien mit Latenzreduzierung und Konversionssteigerung pro Schritt.`,`Leichte Replikationen demonstrieren operationale Konsistenz.`,`Feinanpassungen maximieren den Gewinn in Zielsegmenten.`,`Pr√§gnante Berichte mit Tabelle der Hauptmetriken.`],metrics:[`Metriken: Haupt-, zwei Diagnose- und eine Leitplanke; KI ${num(90,99)}%.`,`Beobachtbare Beweise pro Schritt und Kohorte.`,`Sensitivit√§t und √úberpr√ºfung von Annahmen.`,`Instrumentierungsprotokolle und Skriptversionierung.`,`Vereinfachter Autor-Datum-Bericht, wenn anwendbar.`],faq:[`Fenster von ${num(7,14)} Tagen mit objektiver Entscheidung.`,`Minimale √Ñnderungen mit angemessener Messung.`,`Tests l√∂sen Meinungsverschiedenheiten.`],concl:[`Technische Synthese mit messbaren n√§chsten Schritten.`,`Direkte Anwendbarkeit im Jahr ${year} mit kontrolliertem Risiko.`]},
            professional:{intro:[`${topic} behandelt mit praktischer Strenge im Jahr ${year}: klare Absicht und messbare Aktion.`,`${topic} erfordert Disziplin: wenige Hebel, pr√§zise Beobachtung und schnelle Entscheidung.`,`Direkte Strategie f√ºr ${topic}: Fokus, Ausf√ºhrung und spezifische Beweise.`,`${topic} profitiert von kurzen Zyklen und schlanker Dokumentation.`,`Zuverl√§ssige Ergebnisse stammen aus Methode und Sprachklarheit.`],plan:[`Exekutivplan: einen Hebel priorisieren, minimale √Ñnderung ausf√ºhren und messen.`,`Fahrplan: Entscheidung in ${num(7,14)} Tagen mit spezifischen Beweisen.`,`Sequenz: Diagnose, schlanke Ausf√ºhrung, √úberpr√ºfung und objektive Kommunikation.`,`Governance: Sichtbarkeit pro Kohorte, Gesundheit und eindeutige Zuordnung.`,`Abschluss: Effekt am selben Punkt verst√§rken, bevor neues Projekt er√∂ffnet wird.`],meth:[`Abgrenzung, Variablen, Stichprobe, Instrumente, Verfahren und Analyse.`,`Testbare Hypothesen und minimale Experimente mit klarer Zuordnung.`,`Vorher/Nachher-Messung und w√∂chentliche √úberpr√ºfung.`,`Kohortenschnitte, Sensitivit√§t und √úberpr√ºfung von Annahmen.`,`Wesentliche Aufzeichnungen und Daten verf√ºgbar.`],apps:[`Typische Gewinne zwischen ${num(8,16)}% und ${num(17,29)}% bei Fokus auf einen Punkt.`,`F√§lle zeigen Nutzen bei Akzeptanz und Bindung.`,`Einfache Flussanpassungen erzeugen messbaren Effekt.`,`Auf Priorit√§t ausgerichtete Ausf√ºhrung reduziert Rauschen.`,`Kurze Berichte st√ºtzen exekutive Kommunikation.`],metrics:[`Eine Hauptmetrik und zwei Hilfsmetriken mit Leitplanke.`,`Beweis pro Schritt best√§tigt Hebel.`,`Sensitivit√§t und Gesundheit vermeiden falsch positive Ergebnisse.`,`Entscheidungen verankert in Zahlen und kurzem Kontext.`,`Objektiver Bericht mit neutraler Sprache.`],faq:[`Zyklen von ${num(7,14)} Tagen.`,`Kein gro√ües Budget n√∂tig.`,`Abweichungen gel√∂st durch instrumentierte Tests.`],concl:[`Exekutiver Abschluss: Klarheit, Kadenz und vorhersehbarer Fortschritt.`,`N√§chster Schritt: Fokus auf demselben Hebel halten, bevor ein anderer ge√∂ffnet wird.`]}
        };
        const S = isPTn ? S_PT : isESn ? S_ES : isFRn ? S_FR : isDEn ? S_DE : S_EN;
        const P = S[style] || S.professional;
        content += `<h2>${HN.intro}</h2><p>${pickU(P.intro)}</p>`;
        fillFrac(P.intro, F.intro);
        content += `<h2>${HN.plan}</h2><p>${pickU(P.plan)}</p>`;
        fillFrac(P.plan, F.plan);
        if (!s500) { content += `<h2>${HN.meth}</h2><p>${pickU(P.meth)}</p>`; fillFrac(P.meth, F.meth); }
        if (s1000 || s2000 || s5000) { content += `<h2>${HN.apps}</h2><p>${pickU(P.apps)}</p>`; fillFrac(P.apps, F.apps); }
        if (s2000 || s5000) { content += `<h2>${HN.metrics}</h2><p>${pickU(P.metrics)}</p>`; fillFrac(P.metrics, F.metrics); }
        content += `<h2>${HN.faq}</h2><ul>${P.faq.map(f=>`<li>${f}</li>`).join('')}</ul>`;
        fillFrac(P.apps, F.faq);
        let preCap = Math.max(50, Math.floor(targetMin * 0.07));
        while (count(content) < targetMin - preCap) { content += `<p>${pickU(P.apps)}</p>`; if (count(content) < targetMin - preCap) content += `<p>${pickU(P.meth)}</p>`; }
        content += `<h2>${HN.concl}</h2><p>${pickU(P.concl)}</p>`;
        fillFrac(P.concl, F.concl);
        content += `</section>`;
        const hashN = await hashSHA256(content);
        const lastN = localStorage.getItem('LAST_ARTICLE_HASH') || '';
        if (hashN === lastN) { content += `<p>${isPTn?'Nota: vers√£o com ajustes finos em 24h.':(isESn?'Nota: versi√≥n con ajustes finos en 24h.':(isFRn?'Note¬†: version avec r√©glages fins en 24h.':(isDEn?'Hinweis: Version mit Feinanpassungen in 24h.':'Note: version with fine adjustments in 24h.')))}</p>`; }
        const histStr = localStorage.getItem('ART_HISTORY') || '[]';
        let histArr = [];
        try { histArr = JSON.parse(histStr) || []; } catch(e) { histArr = []; }
        histArr.push({ title, hash: hashN, createdAt: new Date().toISOString(), seed: seedInit, style, academic: false, language });
        localStorage.setItem('ART_HISTORY', JSON.stringify(histArr.slice(-50)));
        localStorage.setItem('LAST_ARTICLE_HASH', hashN);
        localStorage.setItem('LAST_ARTICLE_TITLE', title);
        const finalCountN = count(content);
        return { title: title, content: content, wordCount: finalCountN, language: language, style: style, createdAt: new Date().toISOString() };
    }
    if (language === 'en' && wordCount >= 2000) {
        let title = `The D2 Method for predictable growth`;
        const prevTitle = localStorage.getItem('LAST_ARTICLE_TITLE') || '';
        if (prevTitle === title) title = `${title} ${num(10,99)}`;
        let content = `${css}<section class="lux-article"><h1>${title}</h1>`;
        const hook = `Most teams chase dozens of ideas and stall. D2 focuses on two moves: Diagnose precisely and Do fast, creating measurable progress in ${year}.`;
        content += `<div class="lux-callout">${hook}</div>`;

        content += `<h2>Introduction</h2>`;
        content += `<p>${topic} looks simple until you try to scale it. The D2 Method reduces chaos by forcing two disciplined steps: understand the exact constraint, then act decisively within a short window. Instead of debating strategies, teams run observable experiments that produce evidence in days, not months. D2 is pragmatic: it works whether you manage a SaaS onboarding flow, an e‚Äëcommerce checkout, or a content growth funnel. By anchoring decisions to measurable signals, it prevents scatter, accelerates learning, and compounds small wins into durable growth.</p>`;

        content += `<h2>Why It Matters for Growth</h2>`;
        content += `<p>Growth stalls when teams treat every problem as equal or pursue too many initiatives at once. D2 clarifies priority by identifying the single bottleneck that governs outcomes, then concentrating execution on that point. This alignment increases signal‚Äëto‚Äënoise, reduces cycle time, and unlocks predictable momentum. In practice, one focused experiment can improve activation by ${num(7,15)}% or cut churn by ${num(4,12)}% because effort finally matches leverage. D2 also builds trust: executives see real evidence, operators feel agency, and stakeholders align around numbers rather than opinions. The result is a repeatable cadence: diagnose, decide, act, measure, adjust.</p>`;

        const scenarios = ['SaaS onboarding','e‚Äëcommerce checkout','B2B lead generation','mobile retention','content funnel'];

        content += `<h2>Diagnosis</h2>`;
        content += `<p>Diagnosis isolates the constraint that most limits ${topic}. It replaces generic dashboards with focused queries: where does attention drop, which step delays action, what cohort deviates from the norm? The output is a precise hypothesis that can be tested quickly. For ${pick(scenarios)}, examine entry‚Äëto‚Äëvalue time, step‚Äëlevel conversion, and user narratives. Good diagnosis narrows the scope until one lever stands out.</p>`;
        content += `<ul><li>Map the journey in discrete steps</li><li>Quantify drop‚Äëoffs and latency</li><li>Identify one lever with outsized impact</li></ul>`;
        content += `<p>Example: after mapping onboarding, the team saw a ${num(18,35)}% drop at email verification. A one‚Äëstep change (passkey + delayed verification) raised activation ${num(6,14)}% in two weeks.</p>`;

        content += `<h2>Execution</h2>`;
        content += `<p>Execution converts the hypothesis into a minimum viable experiment. The goal is speed without sloppiness: make one change that is easy to observe, safe to roll back, and attributable to the specific lever. D2 favors tight timeboxes (${num(7,14)} days) and unambiguous metrics so outcomes are clear.</p>`;
        content += `<ul><li>Define a single success metric</li><li>Ship the smallest change that moves it</li><li>Instrument before and after</li></ul>`;
        content += `<p>Example: simplifying checkout copy to reduce cognitive load improved completion by ${num(3,9)}% while decreasing support contacts by ${num(5,12)}%.</p>`;

        content += `<h2>Feedback</h2>`;
        content += `<p>Feedback closes the loop. Teams compare predicted and observed impact, capture qualitative reactions, and determine whether to persist, pivot, or revert. The emphasis is learning speed: each cycle should produce a confident decision. Feedback blends numbers with context to avoid false positives.</p>`;
        content += `<ul><li>Review metric deltas with cohort cuts</li><li>Collect quick user notes</li><li>Decide: scale, iterate, or discard</li></ul>`;
        content += `<p>Example: notifications increased re‚Äëengagement by ${num(8,16)}%, but qualitative notes flagged fatigue; the team kept timing changes and dropped generic reminders.</p>`;

        content += `<h2>Optimization</h2>`;
        content += `<p>Optimization refines the winning change. Instead of adding new projects, D2 deepens performance on the same lever: copy, timing, placement, segment targeting, or friction removal. Small adjustments compound, turning a modest gain into a material shift.</p>`;
        content += `<ul><li>Run A/B on the chosen lever</li><li>Target segments with tailored variants</li><li>Remove micro‚Äëfrictions that block action</li></ul>`;
        content += `<p>Example: segment‚Äëspecific headlines raised trial‚Äëto‚Äëpaid by ${num(5,11)}% on top of the initial uplift.</p>`;

        content += `<h2>Modification</h2>`;
        content += `<p>Modification adapts the approach when assumptions break. If a change helps one cohort but hurts another, D2 adjusts scope or shifts the lever. Modification preserves momentum by reacting to evidence rather than sunk cost.</p>`;
        content += `<ul><li>Detect asymmetric effects across cohorts</li><li>Scope changes to high‚Äëimpact segments</li><li>Switch levers when ROI drops</li></ul>`;
        content += `<p>Example: a new pricing card helped self‚Äëserve but confused enterprise buyers; the team split experiences and recovered ${num(6,12)}% in qualified leads.</p>`;

        content += `<h2>Metrics</h2>`;
        content += `<p>Metrics define reality. D2 uses few, specific measures tied to user progress: time to value, step conversion, retention lag, and revenue‚Äëlinked behaviors. The dashboard shows the minimum needed to decide, not everything that can be tracked.</p>`;
        content += `<ul><li>One north‚Äëstar metric per cycle</li><li>Two supporting diagnostics</li><li>Always include a guardrail</li></ul>`;
        content += `<p>Example: for ${pick(scenarios)}, north‚Äëstar was activation; diagnostics were verification latency and first‚Äëaction depth; guardrail was support escalations.</p>`;

        content += `<h2>Myths vs Truths</h2>`;
        content += `<p>Myth: more projects mean more growth. Truth: focus increases leverage and shrinks time to evidence. Myth: plan everything first. Truth: reality teaches faster than documents when instrumentation is strong. Myth: copy the leader. Truth: context differs; borrow principles, not tactics. Myth: generic data is enough. Truth: specific, step‚Äëlevel data prevents misreads and guides action.</p>`;

        content += `<h2>Myths vs Truths ‚Äî Expanded</h2>`;
        content += `<p>‚ÄúMore is better‚Äù creates an illusion of progress while diluting attention. D2 caps concurrent work so every change is visible and attributable. Teams discover that one well‚Äëchosen lever can move the whole system.</p>`;
        content += `<p>‚ÄúPlan everything first‚Äù delays learning. D2 replaces certainty theater with instrumented experiments that surface reality early. When evidence contradicts assumptions, the team modifies quickly and keeps momentum.</p>`;
        content += `<p>‚ÄúCopy leaders‚Äù ignores context. A tactic that works for a marketplace may fail for a SaaS onboarding with different user motivations. D2 copies decision principles‚Äîtight scopes, fast feedback, guardrails‚Äînot the exact playbook.</p>`;
        content += `<p>‚ÄúGeneric data is enough‚Äù leads to vague stories. D2 demands step‚Äëlevel numbers and user notes so decisions connect to real behavior. This granularity prevents false confidence and highlights the next practical move.</p>`;

        content += `<h2>FAQ</h2>`;
        content += `<p><strong>How long is a D2 cycle?</strong> ${num(7,14)} days. Long enough to collect clean data, short enough to maintain urgency. Each cycle ends with a decision: double‚Äëdown, iterate, or stop.</p>`;
        content += `<p><strong>Does D2 work without big budgets?</strong> Yes. The method prioritizes minimum viable changes with clear measurement. Many wins come from copy, flow, or timing tweaks rather than heavy builds.</p>`;
        content += `<p><strong>What if stakeholders disagree?</strong> Use instrumented experiments to settle debates. D2 reframes opinions as testable hypotheses and aligns the group around evidence.</p>`;
        content += `<p><strong>Can I apply D2 in ${pick(scenarios)}?</strong> Yes. Start by diagnosing the constraint, ship one change, measure, then iterate. The pattern is universal because it targets leverage, not a specific channel.</p>`;
        content += `<p><strong>How do we avoid harming users?</strong> Include guardrails: support load, complaint rate, or opt‚Äëout signals. If a metric crosses a threshold, revert immediately.</p>`;
        content += `<p><strong>What happens after a win?</strong> Optimize the same lever before starting a new project. Compounding on one area often yields bigger returns than starting from scratch elsewhere.</p>`;

        content += `<h2>Conclusion</h2>`;
        content += `<p>D2 turns growth from guesswork into a disciplined cadence. By diagnosing constraints and acting quickly on the highest‚Äëleverage change, teams create measurable progress and learn faster than they plan. The effect is cultural as much as tactical: clarity replaces noise, momentum replaces delay, and small wins compound. Choose one lever, instrument it, and run a ${num(7,14)}‚Äëday cycle. Evidence will show the next move‚Äîand growth follows.</p>`;
        content += `</section>`;

        const finalCount = count(content);
        return { title: title, content: content, wordCount: finalCount, language: language, style: style, createdAt: new Date().toISOString() };
    }
        const T = {
            pt: {
                    titles: [
                        `${num(5,9)} passos para dominar ${topic} em ${year}`,
                        `Como multiplicar resultados com ${topic} em 30 dias`,
                        `${num(5,9)} erros que travam ${topic} (e como evitar)`
                    ],
                    hooks: [
                        `90% dos blogs sobre ${topic} repetem f√≥rmulas mortas. Aqui, voc√™ aprende a aplicar ${topic} com impacto mensur√°vel e sem desperd√≠cio.`,
                        `Se ${topic} fosse simples, todos teriam resultados consistentes. Voc√™ ver√° como construir um m√©todo que n√£o depende de sorte.`
                    ],
                    whyChanged: `Por Que ${topic} Mudou em ${year}`,
                    ctx: `Em ${year}, ${topic} evoluiu para ciclos mensur√°veis. Equipes profissionais aplicam frameworks com cad√™ncia e transformam aprendizado em progresso. Em 24h, voc√™ consegue implementar um piloto que elimina ru√≠do e cria tra√ß√£o.`,
                    methodLabel: a => `Guia essencial de ${topic}`,
                    overview: `Vis√£o geral: mapear, testar, provar, escalar. Voc√™ foca em alavancas com impacto real, valida com dados e executa sem travar em debates sem fim.`,
                    connectors: ['Al√©m disso,','Na pr√°tica,','Por outro lado,','Em contraste,','Dito isso,','Em resumo,','No dia a dia,'],
                    pillars: ['Diagn√≥stico','Estrat√©gia','Execu√ß√£o','Prova','Otimiza√ß√£o','Distribui√ß√£o','M√©tricas','Diferencia√ß√£o','Experi√™ncia','Confian√ßa','Escala','Sustenta√ß√£o','Itera√ß√£o','Comunica√ß√£o','Reposicionamento'],
                    whyBase: `${topic} funciona quando voc√™ escolhe poucas alavancas com impacto desproporcional e ignora o resto.`,
                    how: `Como aplicar: defina o objetivo, transforme em a√ß√£o observ√°vel e execute em ciclos curtos com feedback.`,
                    actions: ['Defina um indicador principal','Estabele√ßa um limite de tempo','Crie um experimento m√≠nimo vi√°vel','Colete evid√™ncias espec√≠ficas','Elimine um gargalo por vez','Documente a cad√™ncia semanal'],
                    proof: i => `Exemplo: ${num(127,140)} de ${num(140,160)} testes com ${topic} validaram ${i}% de ganho em ${pick(['reten√ß√£o','convers√£o','alcance'])}.`,
                    sectionSummary: 'Resumo da Se√ß√£o',
                    summaryText: `Foque em uma hip√≥tese, valide, aprenda e avance.`,
                    priceLine: (sym, amt) => `Assine por ${sym}${amt}/m√™s`,
                    ctaHead: 'Pronto Para Aplicar?',
                    ctaLink: 'Come√ßar agora',
                    blockquote: 'Escrever sem estrutura √© como construir casa sem planta: paredes no lugar errado.',
                    altCompareTitle: 'Compara√ß√£o de Alternativas',
                    altComparePara: `Compare m√©todos concorrentes pela capacidade de gerar evid√™ncia r√°pida e custo de execu√ß√£o.`,
                    mythsTitle: 'Mitos vs. Verdades',
                    myths: ['Mais √© melhor','Planejar tudo antes','Copiar o l√≠der funciona','Dados gen√©ricos bastam'],
                    no: 'N√£o.',
                    faqTitle: 'FAQ',
                    faq: [
                        `<strong>Quanto tempo at√© resultado?</strong> Ciclos de 7 a 14 dias, com sinal claro j√° no primeiro.`,
                        `<strong>D√° para aplicar em 24h?</strong> Sim: escolha uma alavanca e rode um teste m√≠nimo.`
                    ],
                    micro: () => `Semana passada, um cliente disse: "${pick(['Nada funciona','√â muita teoria','N√£o tenho tempo'])}". Respondi: "Escolha uma alavanca e execute em 7 dias". Ele aplicou e viu ${num(12,35)}% de ganho.`,
                    bottomCtaLink: 'Implementar',
                    conclusionTitle: 'Conclus√£o',
                    conclusionText: `Voc√™ viu um m√©todo que coloca ${topic} em ciclo de prova. A escolha √© sua: seguir no improviso ou aplicar estrutura. Benef√≠cio tang√≠vel: clareza, cad√™ncia e avan√ßo.`,
                    fillers: [
                        'Em resumo: escolha uma alavanca e avance.',
                        'Evite dispers√£o: foque no que muda o resultado.',
                        'Valide com dados, n√£o com opini√µes.',
                        'Ciclos curtos criam tra√ß√£o sustent√°vel.',
                        'Aprenda r√°pido, ajuste e repita.',
                        'Mais clareza, menos ru√≠do.',
                        'Execute hoje; refine amanh√£.',
                        'Uma hip√≥tese por vez.',
                        'Reduza escopo; aumente velocidade.',
                        'Cad√™ncia semanal > projetos infinitos.',
                        'Evid√™ncia espec√≠fica vence achismo.',
                        'Impacto desproporcional vem de poucas alavancas.'
                    ],
                    fieldNote: 'Nota de Campo',
                    bullets: ['Defina uma hip√≥tese','Colete evid√™ncias espec√≠ficas','Itere em ciclos curtos']
            },
            en: {
                    titles: [
                        `${num(5,9)} steps to master ${topic} in ${year}`,
                        `How to multiply results with ${topic} in 30 days`,
                        `${num(5,9)} mistakes that stall ${topic} (and how to avoid them)`
                    ],
                    hooks: [
                        `90% of blogs on ${topic} repeat dead formulas. Here, you‚Äôll learn how to apply ${topic} with measurable impact and zero waste.`,
                        `If ${topic} were simple, everyone would have consistent results. You‚Äôll see how to build a method that doesn‚Äôt rely on luck.`
                    ],
                    whyChanged: `Why ${topic} Changed in ${year}`,
                    ctx: `In ${year}, ${topic} evolved into measurable loops. Professional teams apply frameworks rhythmically and turn learning into progress. In 24h, you can launch a pilot that removes noise and creates traction.`,
                    methodLabel: a => `Core principles of ${topic}`,
                    overview: `Overview: map, test, prove, scale. You focus on levers with real impact, validate with data, and execute without getting stuck in endless debate.`,
                    connectors: ['Additionally,','In practice,','On the other hand,','By contrast,','That said,','In summary,','Day to day,'],
                    pillars: ['Diagnosis','Strategy','Execution','Proof','Optimization','Distribution','Metrics','Differentiation','Experience','Trust','Scale','Sustainment','Iteration','Communication','Repositioning'],
                    whyBase: `${topic} works when you select a few levers with outsized impact and ignore the rest.`,
                    how: `How to apply: define the goal, turn it into observable action, and execute in short cycles with feedback.`,
                    actions: ['Define one primary metric','Set a time boundary','Create a minimum viable experiment','Collect specific evidence','Remove one bottleneck at a time','Document weekly cadence'],
                    proof: i => `Example: ${num(127,140)} of ${num(140,160)} tests with ${topic} validated ${i}% gain in ${pick(['retention','conversion','reach'])}.`,
                    sectionSummary: 'Section Summary',
                    summaryText: `Focus on one hypothesis, validate, learn, and move forward.`,
                    priceLine: (sym, amt) => `Subscribe for ${sym}${amt}/month`,
                    ctaHead: 'Ready To Apply?',
                    ctaLink: 'Start now',
                    blockquote: 'Writing without structure is like building a house without a plan: walls in the wrong place.',
                    altCompareTitle: 'Alternative Comparison',
                    altComparePara: `Compare competing methods by their ability to generate fast evidence and execution cost.`,
                    mythsTitle: 'Myths vs. Truths',
                    myths: ['More is better','Plan everything first','Copying leaders works','Generic data is enough'],
                    no: 'No.',
                    faqTitle: 'FAQ',
                    faq: [
                        `<strong>How fast to results?</strong> 7‚Äì14 day cycles, with signal in the first one.`,
                        `<strong>Can I apply in 24h?</strong> Yes: pick one lever and run a minimum test.`
                    ],
                    micro: () => `Last week, a client said: "${pick(['Nothing works','Too much theory','No time'])}". I replied: "Pick one lever and execute in 7 days". They applied and saw a ${num(12,35)}% gain.`,
                    bottomCtaLink: 'Implement',
                    conclusionTitle: 'Conclusion',
                    conclusionText: `You saw a method that puts ${topic} on a proof cycle. Your choice: stay in improvisation or apply structure. Tangible benefit: clarity, cadence, progress.`,
                    fillers: [
                        'In summary: pick one lever and move.',
                        'Avoid scatter: focus on what changes outcomes.',
                        'Validate with data, not opinions.',
                        'Short cycles create sustainable traction.',
                        'Learn fast, adjust, and repeat.',
                        'More clarity, less noise.',
                        'Execute today; refine tomorrow.',
                        'One hypothesis at a time.',
                        'Reduce scope; increase speed.',
                        'Weekly cadence > endless projects.',
                        'Specific evidence beats guesswork.',
                        'Outsized impact comes from few levers.'
                    ],
                    fieldNote: 'Field Note',
                    bullets: ['Define a hypothesis','Collect specific evidence','Iterate in short cycles']
            },
            es: {
                    titles: [
                        `${num(5,9)} pasos para dominar ${topic} en ${year}`,
                        `C√≥mo multiplicar resultados con ${topic} en 30 d√≠as`,
                        `${num(5,9)} errores que frenan ${topic} (y c√≥mo evitarlos)`,
                        `El M√©todo ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} para crecer con previsibilidad`
                    ],
                    hooks: [
                        `El 90% de los blogs sobre ${topic} repiten f√≥rmulas muertas. Aqu√≠ aprender√°s a aplicar ${topic} con impacto medible y sin desperdicio.`,
                        `Si ${topic} fuera simple, todos tendr√≠an resultados consistentes. Ver√°s c√≥mo construir un m√©todo que no depende de la suerte.`
                    ],
                    whyChanged: `Por qu√© ${topic} cambi√≥ en ${year}`,
                    ctx: `En ${year}, ${topic} evolucion√≥ hacia ciclos medibles. Equipos profesionales aplican frameworks con cadencia y convierten el aprendizaje en progreso. En 24h puedes lanzar un piloto que elimina ruido y crea tracci√≥n.`,
                    methodLabel: a => `Principios esenciales de ${topic}`,
                    overview: `Visi√≥n general: mapear, probar, demostrar, escalar. Te enfocas en palancas con impacto real, validas con datos y ejecutas sin debates interminables.`,
                    connectors: ['Adem√°s,','En la pr√°ctica,','Por otro lado,','En contraste,','Dicho esto,','En resumen,','En el d√≠a a d√≠a,'],
                    pillars: ['Diagn√≥stico','Estrategia','Ejecuci√≥n','Prueba','Optimizaci√≥n','Distribuci√≥n','M√©tricas','Diferenciaci√≥n','Experiencia','Confianza','Escala','Sostenimiento','Iteraci√≥n','Comunicaci√≥n','Reposicionamiento'],
                    whyBase: `${topic} funciona cuando eliges pocas palancas con impacto desproporcionado y ignoras el resto.`,
                    how: `C√≥mo aplicar: define el objetivo, convi√©rtelo en acci√≥n observable y ejecuta en ciclos cortos con feedback.`,
                    actions: ['Define un indicador principal','Establece un l√≠mite de tiempo','Crea un experimento m√≠nimo viable','Recoge evidencia espec√≠fica','Elimina un cuello de botella a la vez','Documenta la cadencia semanal'],
                    proof: i => `Ejemplo: ${num(127,140)} de ${num(140,160)} tests con ${topic} validaron ${i}% de mejora en ${pick(['retenci√≥n','conversi√≥n','alcance'])}.`,
                    sectionSummary: 'Resumen de la secci√≥n',
                    summaryText: `Enf√≥cate en una hip√≥tesis, valida, aprende y avanza.`,
                    priceLine: (sym, amt) => `Suscr√≠bete por ${sym}${amt}/mes`,
                    ctaHead: '¬øListo para aplicar?',
                    ctaLink: 'Empezar ahora',
                    blockquote: 'Escribir sin estructura es como construir una casa sin plano: paredes en el lugar equivocado.',
                    altCompareTitle: 'Comparaci√≥n de alternativas',
                    altComparePara: `Compara m√©todos competidores por su capacidad de generar evidencia r√°pida y costo de ejecuci√≥n.`,
                    mythsTitle: 'Mitos vs. Verdades',
                    myths: ['M√°s es mejor','Planear todo antes','Copiar al l√≠der funciona','Los datos gen√©ricos bastan'],
                    no: 'No.',
                    faqTitle: 'FAQ',
                    faq: [
                        `<strong>¬øQu√© tan r√°pido hay resultados?</strong> Ciclos de 7‚Äì14 d√≠as, con se√±al clara desde el primero.`,
                        `<strong>¬øSe puede aplicar en 24h?</strong> S√≠: elige una palanca y ejecuta un test m√≠nimo.`
                    ],
                    micro: () => `La semana pasada, un cliente dijo: "${pick(['Nada funciona','Demasiada teor√≠a','No tengo tiempo'])}". Respond√≠: "Elige una palanca y ejecuta en 7 d√≠as". Aplic√≥ y vio ${num(12,35)}% de mejora.`,
                    bottomCtaLink: 'Implementar',
                    conclusionTitle: 'Conclusi√≥n',
                    conclusionText: `Has visto un m√©todo que pone ${topic} en ciclo de prueba. Tu elecci√≥n: seguir improvisando o aplicar estructura. Beneficio tangible: claridad, cadencia y avance.`,
                    fillers: [
                        'En resumen: elige una palanca y avanza.',
                        'Evita la dispersi√≥n: enf√≥cate en lo que cambia resultados.',
                        'Valida con datos, no con opiniones.',
                        'Los ciclos cortos crean tracci√≥n sostenible.',
                        'Aprende r√°pido, ajusta y repite.',
                        'M√°s claridad, menos ruido.',
                        'Ejecuta hoy; refina ma√±ana.',
                        'Una hip√≥tesis a la vez.',
                        'Reduce alcance; aumenta velocidad.',
                        'Cadencia semanal > proyectos infinitos.',
                        'La evidencia espec√≠fica vence el adivinamiento.',
                        'El impacto desproporcionado viene de pocas palancas.'
                    ],
                    fieldNote: 'Nota de campo',
                    bullets: ['Define una hip√≥tesis','Recoge evidencia espec√≠fica','Itera en ciclos cortos']
            },
            fr: {
                    titles: [
                        `${num(5,9)} √©tapes pour ma√Ætriser ${topic} en ${year}`,
                        `Comment multiplier les r√©sultats avec ${topic} en 30 jours`,
                        `${num(5,9)} erreurs qui bloquent ${topic} (et comment les √©viter)`,
                        `La M√©thode ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} pour une croissance pr√©visible`
                    ],
                    hooks: [
                        `90% des articles sur ${topic} r√©p√®tent des recettes mortes. Ici, vous apprendrez √† appliquer ${topic} avec un impact mesurable et sans gaspillage.`,
                        `Si ${topic} √©tait simple, tout le monde aurait des r√©sultats constants. Vous verrez comment construire une m√©thode qui ne d√©pend pas de la chance.`
                    ],
                    whyChanged: `Pourquoi ${topic} a chang√© en ${year}`,
                    ctx: `En ${year}, ${topic} a √©volu√© vers des boucles mesurables. Des √©quipes professionnelles appliquent des frameworks avec cadence et transforment l‚Äôapprentissage en progr√®s. En 24h, vous pouvez lancer un pilote qui supprime le bruit et cr√©e de la traction.`,
                    methodLabel: a => `Principes essentiels de ${topic}`,
                    overview: `Vue d‚Äôensemble: cartographier, tester, prouver, scaler. Vous vous concentrez sur des leviers √† fort impact, validez avec des donn√©es et ex√©cutez sans d√©bats sans fin.`,
                    connectors: ['De plus,','En pratique,','√Ä l‚Äôinverse,','Par contraste,','Cela dit,','En r√©sum√©,','Au quotidien,'],
                    pillars: ['Diagnostic','Strat√©gie','Ex√©cution','Preuve','Optimisation','Distribution','M√©triques','Diff√©renciation','Exp√©rience','Confiance','√âchelle','Soutien','It√©ration','Communication','Repositionnement'],
                    whyBase: `${topic} fonctionne quand vous s√©lectionnez peu de leviers √† l‚Äôimpact disproportionn√© et ignorez le reste.`,
                    how: `Comment appliquer: d√©finir l‚Äôobjectif, le transformer en action observable et ex√©cuter en cycles courts avec feedback.`,
                    actions: ['D√©finir un indicateur principal','Fixer une limite de temps','Cr√©er une exp√©rience minimale viable','Recueillir des preuves sp√©cifiques','Supprimer un goulot d‚Äô√©tranglement √† la fois','Documenter la cadence hebdomadaire'],
                    proof: i => `Exemple: ${num(127,140)} de ${num(140,160)} tests avec ${topic} ont valid√© ${i}% de gain en ${pick(['r√©tention','conversion','port√©e'])}.`,
                    sectionSummary: 'R√©sum√© de la section',
                    summaryText: `Se concentrer sur une hypoth√®se, valider, apprendre et avancer.`,
                    priceLine: (sym, amt) => `Abonnez-vous pour ${sym}${amt}/mois`,
                    ctaHead: 'Pr√™t √† appliquer ?',
                    ctaLink: 'Commencer maintenant',
                    blockquote: '√âcrire sans structure, c‚Äôest construire une maison sans plan: des murs au mauvais endroit.',
                    altCompareTitle: 'Comparaison des alternatives',
                    altComparePara: `Comparez les m√©thodes concurrentes par leur capacit√© √† g√©n√©rer rapidement des preuves et par leur co√ªt d‚Äôex√©cution.`,
                    mythsTitle: 'Mythes vs V√©rit√©s',
                    myths: ['Plus c‚Äôest mieux','Tout planifier avant','Copier les leaders fonctionne','Les donn√©es g√©n√©riques suffisent'],
                    no: 'Non.',
                    faqTitle: 'FAQ',
                    faq: [
                        `<strong>√Ä quelle vitesse les r√©sultats ?</strong> Des cycles de 7‚Äì14 jours, avec un signal d√®s le premier.`,
                        `<strong>Peut-on appliquer en 24h ?</strong> Oui: choisissez un levier et lancez un test minimal.`
                    ],
                    micro: () => `La semaine derni√®re, un client a dit: "${pick(['Rien ne marche','Trop de th√©orie','Pas de temps'])}". J‚Äôai r√©pondu: "Choisissez un levier et ex√©cutez en 7 jours". Il a appliqu√© et a vu ${num(12,35)}% de gain.`,
                    bottomCtaLink: 'Impl√©menter',
                    conclusionTitle: 'Conclusion',
                    conclusionText: `Vous avez vu une m√©thode qui place ${topic} dans un cycle de preuve. √Ä vous de choisir: improviser ou appliquer une structure. B√©n√©fice tangible: clart√©, cadence, progr√®s.`,
                    fillers: [
                        'En r√©sum√©: choisissez un levier et avancez.',
                        '√âvitez la dispersion: concentrez-vous sur ce qui change les r√©sultats.',
                        'Validez avec des donn√©es, pas des opinions.',
                        'Des cycles courts cr√©ent une traction durable.',
                        'Apprenez vite, ajustez et r√©p√©tez.',
                        'Plus de clart√©, moins de bruit.',
                        'Ex√©cutez aujourd‚Äôhui; affinez demain.',
                        'Une hypoth√®se √† la fois.',
                        'R√©duisez le p√©rim√®tre; augmentez la vitesse.',
                        'Cadence hebdomadaire > projets sans fin.',
                        'Des preuves sp√©cifiques battent les suppositions.',
                        'Un impact disproportionn√© vient de quelques leviers.'
                    ],
                    fieldNote: 'Note de terrain',
                    bullets: ['D√©finir une hypoth√®se','Recueillir des preuves sp√©cifiques','It√©rer en cycles courts']
            },
            de: {
                    titles: [
                        `${num(5,9)} Schritte, um ${topic} in ${year} zu meistern`,
                        `So vervielfachen Sie Ergebnisse mit ${topic} in 30 Tagen`,
                        `${num(5,9)} Fehler, die ${topic} ausbremsen (und wie man sie vermeidet)`,
                        `Die ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')}‚ÄëMethode f√ºr planbares Wachstum`
                    ],
                    hooks: [
                        `90% der Beitr√§ge zu ${topic} wiederholen tote Formeln. Hier lernen Sie, ${topic} mit messbarem Impact und ohne Verschwendung anzuwenden.`,
                        `W√§re ${topic} einfach, h√§tten alle konsistente Ergebnisse. Sie sehen, wie man eine Methode baut, die nicht vom Zufall abh√§ngt.`
                    ],
                    whyChanged: `Warum ${topic} sich in ${year} ver√§ndert hat`,
                    ctx: `Im Jahr ${year} entwickelte sich ${topic} zu messbaren Schleifen. Professionelle Teams arbeiten mit klarer Kadenz und verwandeln Lernen in Fortschritt. In 24h k√∂nnen Sie einen Piloten starten, der Rauschen entfernt und Traktion schafft.`,
                    methodLabel: a => `Kernprinzipien von ${topic}`,
                    overview: `√úberblick: kartieren, testen, beweisen, skalieren. Fokus auf Hebel mit echtem Impact, validiert mit Daten, ausgef√ºhrt ohne endlose Debatten.`,
                    connectors: ['Au√üerdem,','In der Praxis,','Auf der anderen Seite,','Im Gegensatz dazu,','Das gesagt,','Zusammengefasst,','Im Alltag,'],
                    pillars: ['Diagnose','Strategie','Ausf√ºhrung','Beweis','Optimierung','Distribution','Metriken','Differenzierung','Erfahrung','Vertrauen','Skalierung','Nachhaltigkeit','Iteration','Kommunikation','Neupositionierung'],
                    whyBase: `${topic} funktioniert, wenn wenige Hebel mit √ºberproportionalem Impact gew√§hlt und der Rest ignoriert wird.`,
                    how: `Wie anwenden: Ziel definieren, in beobachtbare Aktion √ºbersetzen und in kurzen Zyklen mit Feedback ausf√ºhren.`,
                    actions: ['Einen Prim√§r‚ÄëMetrik festlegen','Zeitgrenze setzen','Minimales Experiment bauen','Spezifische Evidenz sammeln','Je einen Engpass entfernen','W√∂chentliche Kadenz dokumentieren'],
                    proof: i => `Beispiel: ${num(127,140)} von ${num(140,160)} Tests mit ${topic} best√§tigten ${i}% Gewinn bei ${pick(['Bindung','Konversion','Reichweite'])}.`,
                    sectionSummary: 'Abschnittszusammenfassung',
                    summaryText: `Auf eine Hypothese fokussieren, validieren, lernen und weitermachen.`,
                    priceLine: (sym, amt) => `Abonnieren f√ºr ${sym}${amt}/Monat`,
                    ctaHead: 'Bereit zur Anwendung?',
                    ctaLink: 'Jetzt starten',
                    blockquote: 'Ohne Struktur zu schreiben ist wie ein Haus ohne Plan: W√§nde am falschen Ort.',
                    altCompareTitle: 'Alternativenvergleich',
                    altComparePara: `Vergleichen Sie konkurrierende Methoden nach schneller Evidenz und Ausf√ºhrungskosten.`,
                    mythsTitle: 'Mythen vs Wahrheiten',
                    myths: ['Mehr ist besser','Alles zuerst planen','F√ºhrer kopieren funktioniert','Generische Daten gen√ºgen'],
                    no: 'Nein.',
                    faqTitle: 'FAQ',
                    faq: [
                        `<strong>Wie schnell zu Ergebnissen?</strong> Zyklen von 7‚Äì14 Tagen, mit Signal bereits im ersten.`,
                        `<strong>Kann ich es in 24h anwenden?</strong> Ja: einen Hebel w√§hlen und ein minimales Experiment ausf√ºhren.`
                    ],
                    micro: () => `Letzte Woche sagte ein Kunde: "${pick(['Nichts funktioniert','Zu viel Theorie','Keine Zeit'])}". Ich antwortete: "W√§hlen Sie einen Hebel und f√ºhren Sie ihn in 7 Tagen aus". Er setzte es um und sah ${num(12,35)}% Zuwachs.`,
                    bottomCtaLink: 'Implementieren',
                    conclusionTitle: 'Fazit',
                    conclusionText: `Sie haben eine Methode gesehen, die ${topic} in einen Beweis‚ÄëZyklus bringt. Ihre Wahl: improvisieren oder Struktur anwenden. Greifbarer Nutzen: Klarheit, Kadenz, Fortschritt.`,
                    fillers: [
                        'Kurz gesagt: einen Hebel w√§hlen und voran gehen.',
                        'Zerstreuung vermeiden: auf Outcome‚ÄëHebel fokussieren.',
                        'Mit Daten validieren, nicht mit Meinungen.',
                        'Kurze Zyklen schaffen nachhaltige Traktion.',
                        'Schnell lernen, anpassen, wiederholen.',
                        'Mehr Klarheit, weniger Rauschen.',
                        'Heute ausf√ºhren; morgen verfeinern.',
                        'Eine Hypothese nach der anderen.',
                        'Umfang reduzieren; Geschwindigkeit erh√∂hen.',
                        'W√∂chentliche Kadenz > endlose Projekte.',
                        'Spezifische Evidenz schl√§gt Mutma√üungen.',
                        '√úberproportionaler Impact kommt von wenigen Hebeln.'
                    ],
                    fieldNote: 'Feldnotiz',
                    bullets: ['Eine Hypothese definieren','Spezifische Evidenz sammeln','In kurzen Zyklen iterieren']
            }
        };
        const isWatch = /watch(es)?|relogi[√≥o]s?|reloj(es)?|montre(s)?|uhr(en)?/i.test(topic);
        if (isWatch) {
            T.pt.pillars = ['Design','Movimento','Materiais','Complica√ß√µes','Precis√£o','Durabilidade'];
            T.pt.whyBase = `${topic} impacta quando voc√™ prioriza movimento, materiais e ergonomia; marca √© secund√°ria.`;
            T.pt.how = `Defina uso (casual, mergulho, dress), escolha movimento (mec√¢nico, autom√°tico, quartzo), avalie materiais (a√ßo, tit√¢nio, safira) e teste conforto.`;
            T.pt.actions = ['Avalie tamanho e lug‚Äëto‚Äëlug','Verifique calibre e reserva de marcha','Teste resist√™ncia √† √°gua','Compare pulseiras e fechos','Inspecione acabamento e lume'];
            T.pt.proof = i => `Em testes cegos com ${topic}, satisfa√ß√£o subiu ${i}% ao priorizar movimento e materiais.`;
            T.pt.blockquote = 'Rel√≥gios de impacto come√ßam no movimento e nos materiais ‚Äî n√£o no hype.';

            T.en.pillars = ['Design','Movement','Materials','Complications','Accuracy','Durability'];
            T.en.whyBase = `${topic} has impact when you prioritize movement, materials, and ergonomics; brand is secondary.`;
            T.en.how = `Define use (casual, dive, dress), choose movement (mechanical, automatic, quartz), assess materials (steel, titanium, sapphire), and test comfort.`;
            T.en.actions = ['Check case size and lug‚Äëto‚Äëlug','Verify calibre and power reserve','Test water resistance','Compare straps and clasps','Inspect finishing and lume'];
            T.en.proof = i => `In blind tests with ${topic}, satisfaction increased ${i}% when movement and materials were prioritized.`;
            T.en.blockquote = 'Impactful watches start with movement and materials ‚Äî not hype.';

            T.es.pillars = ['Dise√±o','Movimiento','Materiales','Complicaciones','Precisi√≥n','Durabilidad'];
            T.es.whyBase = `${topic} impacta cuando priorizas movimiento, materiales y ergonom√≠a; la marca es secundaria.`;
            T.es.how = `Define uso (casual, buceo, dress), elige movimiento (mec√°nico, autom√°tico, cuarzo), eval√∫a materiales (acero, titanio, zafiro) y prueba confort.`;
            T.es.actions = ['Revisa tama√±o y lug‚Äëto‚Äëlug','Verifica calibre y reserva de marcha','Prueba resistencia al agua','Compara correas y cierres','Inspecciona acabado y lume'];
            T.es.proof = i => `En pruebas ciegas con ${topic}, la satisfacci√≥n subi√≥ ${i}% al priorizar movimiento y materiales.`;
            T.es.blockquote = 'Relojes de impacto empiezan en movimiento y materiales ‚Äî no en el hype.';

            T.fr.pillars = ['Design','Mouvement','Mat√©riaux','Complications','Pr√©cision','Durabilit√©'];
            T.fr.whyBase = `${topic} a de l‚Äôimpact quand on priorise le mouvement, les mat√©riaux et l‚Äôergonomie; la marque est secondaire.`;
            T.fr.how = `D√©finissez l‚Äôusage (casual, plong√©e, habill√©), choisissez le mouvement (m√©canique, automatique, quartz), √©valuez les mat√©riaux (acier, titane, saphir) et testez le confort.`;
            T.fr.actions = ['V√©rifiez la taille et le lug‚Äëto‚Äëlug','V√©rifiez le calibre et la r√©serve de marche','Testez l‚Äô√©tanch√©it√©','Comparez les bracelets et boucles','Inspectez les finitions et le lume'];
            T.fr.proof = i => `En tests √† l‚Äôaveugle avec ${topic}, la satisfaction a augment√© de ${i}% en priorisant mouvement et mat√©riaux.`;
            T.fr.blockquote = 'Les montres √† impact commencent par le mouvement et les mat√©riaux ‚Äî pas par le buzz.';

            T.de.pillars = ['Design','Werk','Materialien','Komplikationen','Genauigkeit','Haltbarkeit'];
            T.de.whyBase = `${topic} hat Wirkung, wenn Werk, Materialien und Ergonomie priorisiert werden; die Marke ist sekund√§r.`;
            T.de.how = `Definieren Sie den Einsatz (casual, Tauchen, Dress), w√§hlen Sie das Werk (mechanisch, automatisch, Quarz), bewerten Sie Materialien (Stahl, Titan, Saphir) und testen Sie den Komfort.`;
            T.de.actions = ['Pr√ºfen Sie Gr√∂√üe und Lug‚Äëto‚ÄëLug','Werk und Gangreserve verifizieren','Wasserfestigkeit testen','Armb√§nder und Schlie√üen vergleichen','Finish und Lume inspizieren'];
            T.de.proof = i => `In Blindtests mit ${topic} stieg die Zufriedenheit um ${i}%, wenn Werk und Materialien priorisiert wurden.`;
            T.de.blockquote = 'Wirkungsvolle Uhren beginnen bei Werk und Materialien ‚Äî nicht beim Hype.';
        }
            let title = pick(T[lang].titles);
            const prevTitle = localStorage.getItem('LAST_ARTICLE_TITLE') || '';
            if (prevTitle === title) title = `${title} ${num(10,99)}`;
            let content = `${css}<section class="lux-article"><h1>${title}</h1>`;
            const hookPool = T[lang].hooks.filter(h => !/90%/.test(h));
            const lastHook = localStorage.getItem('LAST_HOOK') || '';
            const candidates = hookPool.filter(h => h !== lastHook);
            const hook = (candidates.length ? candidates : hookPool)[Math.floor(Math.random() * (candidates.length ? candidates.length : hookPool.length))];
            localStorage.setItem('LAST_HOOK', hook);
            content += `<div class="lux-callout">${hook}</div>`;
            content += `<h2>${T[lang].whyChanged}</h2>`;
            content += `<p>${T[lang].ctx}</p>`;
            const acro = topic.split(/\s+/).map(w => w[0].toUpperCase()).filter(Boolean).slice(0,4).join('.');
            const methodLabel = T[lang].methodLabel(acro);
            content += `<h2>${methodLabel}</h2>`;
            content += `<p>${T[lang].overview}</p>`;
            const connectors = T[lang].connectors;
            const trans = () => connectors[Math.floor(Math.random()* connectors.length)];
            const genPara = () => { const pct = num(8,35); return `${trans()} ${T[lang].whyBase} ${T[lang].how} ${T[lang].proof(pct)}`; };
            const pillars = T[lang].pillars;
            const sectionsCount = wordCount <= 800 ? 2 : (wordCount <= 1600 ? 3 : 4);
            const usedH = new Set();
            const actions = T[lang].actions;
            const proof = T[lang].proof;
            for (let i = 0; i < sectionsCount; i++) {
                const name = pillars[i % pillars.length];
                const h = `${i+1}. ${name}`;
                const guarded = usedH.has(h) ? `${i+1}. ${name} ${year}` : h;
                usedH.add(guarded);
                content += `<h2>${guarded}</h2>`;
                content += `<p>${trans()} ${T[lang].whyBase}</p>`;
                content += `<p>${T[lang].how}</p>`;
                const pct = num(8,35);
                content += `<p>${proof(pct)}</p>`;
                const acts = actions;
                const pickN = num(3,5);
                const set = new Set();
                while (set.size < pickN) set.add(pick(acts));
                content += `<ul>${Array.from(set).map(a => `<li>${a}</li>`).join('')}</ul>`;
                if (false) {
                    content += `<h3>${T[lang].sectionSummary}</h3>`;
                    content += `<p>${T[lang].summaryText}</p>`;
                }
                if (i === Math.ceil(sectionsCount/2)-1) {
            const localSymMid = USER_CURRENCY.symbol;
            const localAmtMid = formatPrice(USER_CURRENCY.code, USER_CURRENCY.price);
            const priceLineMid = T[lang].priceLine(localSymMid, localAmtMid);
                const payHrefMid = `${STRIPE_LINK}?client_reference_id=${currentUser?currentUser.email:''}&prefilled_email=${currentUser?currentUser.email:''}`;
                const installLabelMid = lang==='pt'?'Instalar App':(lang==='es'?'Instalar App':(lang==='fr'?'Installer l‚ÄôApp':(lang==='de'?'App installieren':'Install App')));
                content += `<div class="lux-cta"><h3>${T[lang].ctaHead}</h3><p>${priceLineMid}</p><div style="display:flex;gap:.5rem;justify-content:center"><a href="${payHrefMid}" target="_blank" rel="noopener">${T[lang].ctaLink}</a><a href="#" onclick="openInstallGuide()">${installLabelMid}</a></div><div class="lux-platforms"><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M12 2l3 3-3 3-3-3 3-3zm-6 6l3 3-3 3-3-3 3-3zm12 0l3 3-3 3-3-3 3-3zm-6 6l3 3-3 3-3-3 3-3z"/></svg>${chipAndroid}</a><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M16 2c-2 0-3 1-4 2-1-1-2-2-4-2-3 0-6 3-6 7 0 6 7 10 10 13 3-3 10-7 10-13 0-4-3-7-6-7z"/></svg>${chipIOS}</a><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z M7 7h10v10H7z"/></svg>${chipMac}</a></div></div>`;
                }
            }
            content += `<blockquote>${T[lang].blockquote}</blockquote>`;
            let fillerGuard = 0;
            while (count(content) < targetMin && fillerGuard < 200) { content += `<p>${genPara()}</p>`; fillerGuard++; }
            if (false) {
                content += `<h2>${T[lang].altCompareTitle}</h2>`;
                content += `<p>${T[lang].altComparePara}</p>`;
                content += `<h2>${T[lang].mythsTitle}</h2>`;
                content += `<ul>${T[lang].myths.map(m => `<li><strong>${m}</strong> ${T[lang].no}</li>`).join('')}</ul>`;
                content += `<h2>${T[lang].faqTitle}</h2>`;
                for (const qa of T[lang].faq) { content += `<p>${qa}</p>`; }
            }
            content += `<p>${T[lang].micro()}</p>`;
            const localSymBot = USER_CURRENCY.symbol;
            const localAmtBot = formatPrice(USER_CURRENCY.code, USER_CURRENCY.price);
            const priceLineBot = T[lang].priceLine(localSymBot, localAmtBot);
                const payHrefBot = `${STRIPE_LINK}?client_reference_id=${currentUser?currentUser.email:''}&prefilled_email=${currentUser?currentUser.email:''}`;
                const installLabelBot = lang==='pt'?'Instalar App':(lang==='es'?'Instalar App':(lang==='fr'?'Installer l‚ÄôApp':(lang==='de'?'App installieren':'Install App')));
                content += `<div class="lux-cta"><h3>${T[lang].ctaHead}</h3><p>${priceLineBot}</p><div style="display:flex;gap:.5rem;justify-content:center"><a href="${payHrefBot}" target="_blank" rel="noopener">${T[lang].bottomCtaLink}</a><a href="#" onclick="openInstallGuide()">${installLabelBot}</a></div><div class="lux-platforms"><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M12 2l3 3-3 3-3-3 3-3zm-6 6l3 3-3 3-3-3 3-3zm12 0l3 3-3 3-3-3 3-3zm-6 6l3 3-3 3-3-3 3-3z"/></svg>${chipAndroid}</a><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M16 2c-2 0-3 1-4 2-1-1-2-2-4-2-3 0-6 3-6 7 0 6 7 10 10 13 3-3 10-7 10-13 0-4-3-7-6-7z"/></svg>${chipIOS}</a><a href="#" onclick="openInstallGuide()" class="lux-chip"><svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z M7 7h10v10H7z"/></svg>${chipMac}</a></div></div>`;
            content += `<h2>${T[lang].conclusionTitle}</h2>`;
            const concl = academic ? (lang==='pt' ? `Para trabalhos acad√™micos, estruture ${topic} com problema de pesquisa, revis√£o de literatura, m√©todo, resultados e discuss√£o, concluindo com limita√ß√µes e pr√≥ximos passos.` : lang==='es' ? `Para trabajos acad√©micos, estructura ${topic} con problema de investigaci√≥n, revisi√≥n de literatura, m√©todo, resultados y discusi√≥n, cerrando con limitaciones y pr√≥ximos pasos.` : lang==='fr' ? `Pour les travaux acad√©miques, structurez ${topic} avec probl√©matique, revue de litt√©rature, m√©thode, r√©sultats et discussion, en terminant par limites et prochaines √©tapes.` : lang==='de' ? `F√ºr akademische Arbeiten strukturieren Sie ${topic} mit Forschungsfrage, Literatur√ºberblick, Methode, Ergebnissen und Diskussion und schlie√üen mit Grenzen und n√§chsten Schritten.` : `For academic work, structure ${topic} with research problem, literature review, method, results and discussion, closing with limitations and next steps.`) : T[lang].conclusionText;
            content += `<p>${concl}</p>`;
            content += `</section>`;
            
            const hash = await hashSHA256(content);
            const last = localStorage.getItem('LAST_ARTICLE_HASH') || '';
        if (hash === last) {
            content += `<p>${lang==='pt' ? 'Nota exclusiva:' : (lang==='es' ? 'Nota exclusiva:' : (lang==='fr' ? 'Note exclusive¬†:' : (lang==='de' ? 'Exklusive Notiz:' : 'Exclusive note:')))} ${lang==='pt' ? 'Esta vers√£o inclui a√ß√µes extras aplic√°veis em 24h.' : (lang==='es' ? 'Esta versi√≥n incluye acciones extra aplicables en 24h.' : (lang==='fr' ? 'Cette version inclut des actions suppl√©mentaires applicables en 24h.' : (lang==='de' ? 'Diese Version enth√§lt zus√§tzliche Ma√ünahmen, die innerhalb von 24h anwendbar sind.' : 'This version includes extra actions you can apply within 24h.')))}</p>`;
        }
            const uniq = await hashSHA256(content);
            const historyRaw = localStorage.getItem('ART_HISTORY') || '[]';
            let hist = [];
            try { hist = JSON.parse(historyRaw) || []; } catch(e) { hist = []; }
            hist.push({ title, hash: uniq, createdAt: new Date().toISOString(), style, academic, language });
            localStorage.setItem('ART_HISTORY', JSON.stringify(hist.slice(-50)));
            localStorage.setItem('LAST_ARTICLE_HASH', uniq);
            localStorage.setItem('LAST_ARTICLE_TITLE', title);
            const finalCount = count(content);
            return { title: title, content: content, wordCount: finalCount, language: language, style: style, createdAt: new Date().toISOString() };
        }
        
        async function generateArticleContent(topic, language, wordCount, style, instructions) {
            await new Promise(resolve => setTimeout(resolve, 3000));
            const isPT = language === 'pt';
            const pro = style !== 'casual';
            const title = isPT ? `${topic}: Guia Definitivo` : `${topic}: Definitive Guide`;
            const lead = isPT ? `Uma vis√£o clara e objetiva sobre ${topic}.` : `A clear, objective look at ${topic}.`;
            let content = `<h1>${title}</h1>`;
            content += `<p><em>${lead}</em></p>`;
            const ins = (instructions || '').trim();
            const insItems = ins ? ins.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean) : [];
            content += `<div style="background:#F3F4F6;border-left:4px solid #6366F1;padding:1rem;border-radius:10px;margin:1rem 0;">
                <h3>${isPT ? 'Resumo R√°pido' : 'Quick Summary'}</h3>
                <ul>
                    <li>${isPT ? 'Design' : 'Design'}: ${pro ? (isPT ? 'sofisticado e equilibrado' : 'refined and balanced') : (isPT ? 'bonito e vers√°til' : 'stylish and versatile')}</li>
                    <li>${isPT ? 'Desempenho' : 'Performance'}: ${pro ? (isPT ? 'confi√°vel no dia a dia' : 'reliable day-to-day') : (isPT ? '√≥timo para uso casual' : 'great for casual use')}</li>
                    <li>${isPT ? 'P√∫blico' : 'Audience'}: ${pro ? (isPT ? 'entusiastas e profissionais' : 'enthusiasts and professionals') : (isPT ? 'usu√°rios gerais' : 'general users')}</li>
                </ul>
            </div>`;
            if (insItems.length) {
                content += `<div style="background:#EEF2FF;border:1px solid #6366F1;padding:1rem;border-radius:10px;margin:1rem 0;">
                    <h3>${isPT ? 'Diretrizes' : 'Guidelines'}</h3>
                    <ul>${insItems.map(i => `<li>${i}</li>`).join('')}</ul>
                </div>`;
            }
            const depth = wordCount >= 1000 ? 2 : 1;
            content += `<h2>${isPT ? 'Vis√£o Geral' : 'Overview'}</h2>`;
            content += `<p>${isPT ? `O ${topic} √© analisado sob tr√™s pilares: design, desempenho e valor. Este guia oferece uma leitura objetiva para ajudar na decis√£o de compra e no entendimento do posicionamento do ${topic}.` : `${topic} is evaluated across design, performance, and value. This guide provides an objective read to support buying decisions and understanding how ${topic} is positioned.`}</p>`;
            if (depth > 1) content += `<p>${isPT ? `Ao longo deste artigo voc√™ encontrar√° pontos pr√°ticos, pr√≥s e contras, e recomenda√ß√µes claras para diferentes perfis de uso.` : `Throughout the article you will find practical points, pros and cons, and clear recommendations for different use profiles.`}</p>`;
            content += `<h2>${isPT ? 'Design e Constru√ß√£o' : 'Design & Build'}</h2>`;
            content += `<p>${isPT ? `O design do ${topic} prioriza propor√ß√£o e legibilidade. Acabamentos consistentes e escolhas de materiais refor√ßam uma presen√ßa ${pro ? 'sofisticada' : 'descontra√≠da'}.` : `The design of ${topic} prioritizes proportion and legibility. Consistent finishing and material choices deliver a ${pro ? 'refined' : 'relaxed'} presence.`}</p>`;
            content += `<ul>
                <li>${isPT ? 'Propor√ß√£o equilibrada e boa ergonomia' : 'Balanced proportions and solid ergonomics'}</li>
                <li>${isPT ? 'Legibilidade em diferentes condi√ß√µes' : 'Legibility in varied conditions'}</li>
                <li>${isPT ? 'Materiais e acabamentos alinhados ao prop√≥sito' : 'Materials and finishing aligned to purpose'}</li>
            </ul>`;
            content += `<h2>${isPT ? 'Movimento e Desempenho' : 'Movement & Performance'}</h2>`;
            content += `<p>${isPT ? `No uso di√°rio, o ${topic} mant√©m desempenho consistente, com manuten√ß√£o acess√≠vel e previs√≠vel. A precis√£o √© adequada ao segmento.` : `In daily use, ${topic} maintains consistent performance with accessible, predictable maintenance. Accuracy is appropriate for the segment.`}</p>`;
            if (depth > 1) content += `<p>${isPT ? `Para uso prolongado, pontos como reserva de marcha e estabilidade s√£o ${pro ? 'adequadamente resolvidos' : 'suficientes para o cotidiano'}.` : `For extended use, points like power reserve and stability are ${pro ? 'well accounted for' : 'sufficient for everyday wear'}.`}</p>`;
            content += `<h2>${isPT ? 'No Pulso' : 'On the Wrist'}</h2>`;
            content += `<p>${isPT ? `Conforto e presen√ßa fazem do ${topic} uma pe√ßa ${pro ? 'vers√°til para ambientes formais' : 'ideal para o dia a dia'}.` : `Comfort and presence make ${topic} ${pro ? 'versatile for formal settings' : 'ideal for everyday wear'}.`}</p>`;
            content += `<h2>${isPT ? 'Pr√≥s e Contras' : 'Pros & Cons'}</h2>`;
            content += `<div style="display:block;margin:1rem 0;">
                <h3>${isPT ? 'Pr√≥s' : 'Pros'}</h3>
                <ul>
                    <li>${isPT ? 'Constru√ß√£o s√≥lida e acabamento consistente' : 'Solid build and consistent finishing'}</li>
                    <li>${isPT ? 'Desempenho confi√°vel' : 'Reliable performance'}</li>
                    <li>${isPT ? 'Versatilidade no uso' : 'Versatile wear'}</li>
                </ul>
                <h3>${isPT ? 'Contras' : 'Cons'}</h3>
                <ul>
                    <li>${isPT ? 'Poucas op√ß√µes fora do padr√£o' : 'Limited offbeat options'}</li>
                    <li>${isPT ? 'Pre√ßo pode variar conforme disponibilidade' : 'Price may vary with availability'}</li>
                </ul>
            </div>`;
            content += `<h2>${isPT ? 'Alternativas e Compara√ß√µes' : 'Alternatives & Comparisons'}</h2>`;
            content += `<p>${isPT ? `Se ${topic} n√£o atender ao perfil desejado, considere modelos com proposta similar, priorizando ergonomia e manuten√ß√£o.` : `If ${topic} does not fit your profile, consider similar models prioritizing ergonomics and maintenance.`}</p>`;
            content += `<h2>${isPT ? 'Dicas de Compra' : 'Buying Tips'}</h2>`;
            content += `<div style="background:#FFFBEB;border:1px solid #F59E0B;padding:1rem;border-radius:10px;margin:1rem 0;">
                <ul>
                    <li>${isPT ? 'Verifique garantia e hist√≥rico de revis√£o' : 'Check warranty and service history'}</li>
                    <li>${isPT ? 'Priorize ajuste no pulso e conforto' : 'Prioritize fit and comfort on wrist'}</li>
                    <li>${isPT ? 'Compare pre√ßos entre canais confi√°veis' : 'Compare pricing across trusted channels'}</li>
                </ul>
            </div>`;
            content += `<h2>${isPT ? 'Perguntas Frequentes' : 'FAQs'}</h2>`;
            content += `<p><strong>${isPT ? 'Para quem √©?' : 'Who is it for?'}</strong> ${isPT ? `Para quem busca equil√≠brio entre design, desempenho e uso di√°rio.` : `For those seeking balance across design, performance, and daily wear.`}</p>`;
            content += `<p><strong>${isPT ? 'Vale a pena?' : 'Is it worth it?'}</strong> ${isPT ? `Sim, desde que o perfil de uso esteja alinhado √† proposta do ${topic}.` : `Yes, provided your use profile aligns with ${topic}'s intent.`}</p>`;
            content += `<blockquote style="border-left:4px solid #6366F1;padding-left:1rem;color:#4B5563;margin:1rem 0;">
                ${isPT ? 'Recomenda√ß√£o: priorize conforto, manuten√ß√£o e ader√™ncia ao seu estilo.' : 'Recommendation: prioritize comfort, serviceability, and fit to your style.'}
            </blockquote>`;
            content += `<div style="background:linear-gradient(135deg,#6366F1,#EC4899);color:white;padding:1rem;border-radius:12px;margin:1.5rem 0;text-align:center;">
                <h3 style="margin:0 0 .5rem 0;">${isPT ? 'Quer continuar aprendendo?' : 'Want to keep learning?'}</h3>
                <p style="margin:0 0 .75rem 0;">${isPT ? 'Assine para receber an√°lises claras e objetivas de novos modelos.' : 'Subscribe to get clear, objective reviews of new models.'}</p>
                <a href="#" style="display:inline-block;background:white;color:#1F2937;padding:.6rem 1rem;border-radius:8px;font-weight:700;text-decoration:none;">${isPT ? 'Assinar' : 'Subscribe'}</a>
            </div>`;
            content += `<h2>${isPT ? 'Conclus√£o' : 'Conclusion'}</h2>`;
            content += `<p>${isPT ? `O ${topic} entrega o essencial com consist√™ncia. Se os pontos destacados conversam com seu uso, √© uma escolha segura.` : `${topic} delivers the essentials consistently. If the highlighted points match your use, it is a safe choice.`}</p>`;
            return { title: title, content: content, wordCount: wordCount, language: language, style: style, createdAt: new Date().toISOString() };
        }
        
        function displayArticle(article) {
            document.getElementById('articleContent').innerHTML = article.content;
            document.getElementById('currentWordCount').textContent = article.wordCount.toLocaleString();
            document.getElementById('readingTime').textContent = Math.ceil(article.wordCount / 200);
            document.getElementById('createdDate').textContent = new Date(article.createdAt).toLocaleDateString();
            
            document.getElementById('articlePreview').classList.add('active');
            document.getElementById('articlePreview').scrollIntoView({ behavior: 'smooth' });
        }

        function openTitleOverlay() {
            if (!currentArticle) return;
            refreshTitleSuggestions();
            document.getElementById('titleOverlay').classList.add('active');
        }
        function closeTitleOverlay() {
            document.getElementById('titleOverlay').classList.remove('active');
        }
        function refreshTitleSuggestions() {
            const list = document.getElementById('titleSuggestionList');
            const suggestions = generateTitleSuggestions();
            list.innerHTML = suggestions.map(s => `<div class="title-item" data-title="${s.replace(/\"/g,'&quot;')}" onclick="applyTitle(this.getAttribute('data-title'))">${s}</div>`).join('');
        }
        function generateTitleSuggestions() {
            const lang = currentArticle ? currentArticle.language : (document.getElementById('articleLanguage').value || 'en');
            const isPT = lang === 'pt';
            const year = new Date().getFullYear();
            const topic = document.getElementById('articleTopic').value.trim() || (currentArticle ? currentArticle.title : 'Blog');
            const num = () => Math.floor(Math.random() * 7) + 5;
            const pick = a => a[Math.floor(Math.random() * a.length)];
            const pt = [
                `${num()} passos para dominar ${topic} em ${year}`,
                `Como duplicar resultados com ${topic} em 30 dias`,
                `${num()} erros que travam ${topic} (e como evitar)`,
                `O M√©todo ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} para crescer com previsibilidade`,
                `${num()} alavancas de ${topic} que geram impacto real`,
                `De zero a refer√™ncia em ${topic}: roteiro pr√°tico`
            ];
            const en = [
                `${num()} steps to master ${topic} in ${year}`,
                `How to double results with ${topic} in 30 days`,
                `${num()} mistakes that kill ${topic} (and how to avoid them)`,
                `The ${topic.split(/\s+/).map(w => w[0].toUpperCase()).slice(0,4).join('.')} Method for predictable growth`,
                `${num()} ${topic} levers that drive real impact`,
                `From zero to category leader in ${topic}: a practical roadmap`
            ];
            const pool = isPT ? pt : en;
            const set = new Set();
            while (set.size < 6) { set.add(pick(pool)); }
            return Array.from(set);
        }
        function applyTitle(newTitle) {
            if (!currentArticle) return;
            currentArticle.title = newTitle;
            const h1 = document.querySelector('#articleContent .lux-article h1') || document.querySelector('#articleContent h1');
            if (h1) h1.textContent = newTitle;
            localStorage.setItem('LAST_ARTICLE_TITLE', newTitle);
            closeTitleOverlay();
        }
        
        // ==================== ARTICLE ACTIONS ====================
        async function saveArticle() {
            if (!currentArticle) return;
            
            if (!supabase) {
                alert('üíæ Article saved locally! (Supabase not configured)');
                return;
            }
            
            alert('‚úÖ Article saved successfully!');
            loadArticles();
        }
        
        async function downloadPDF() {
            if (!currentArticle) return;
            
            const { jsPDF } = window.jspdf;
            const content = document.getElementById('articleContent');
            
            try {
                const canvas = await html2canvas(content, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                const totalPages = Math.ceil(imgHeight / pageHeight) || 1;
                let pageNum = 1;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                pdf.setFontSize(10);
                pdf.text('Blog Writer ULTRA', 10, 10);
                pdf.text(`${pageNum} / ${totalPages}`, 200, pageHeight - 10, { align: 'right' });
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    pageNum++;
                    pdf.setFontSize(10);
                    pdf.text('Blog Writer ULTRA', 10, 10);
                    pdf.text(`${pageNum} / ${totalPages}`, 200, pageHeight - 10, { align: 'right' });
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`${currentArticle.title}.pdf`);
                alert('‚úÖ PDF downloaded successfully!');
            } catch (err) {
                console.error('PDF error:', err);
                alert('‚ùå Error generating PDF');
            }
        }
        
        function copyHTML() {
            if (!currentArticle) return;
            
            const html = document.getElementById('articleContent').innerHTML;
            const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${currentArticle.title}</title>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Reith Serif','BBC Reith Serif','Merriweather','Georgia','Times New Roman',serif; max-width: 900px; margin: 0 auto; padding: 40px 20px; line-height: 1.8; }
        .lux-article{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia','Times New Roman',serif;color:#2F3D3C;line-height:1.9;max-width:900px;margin:0 auto}
        .lux-article h1{font-family:'Times New Roman',Times,serif;font-weight:400;color:#124C3F;font-size:2.4em;margin:0 0 .75rem}
        .lux-article h2{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia',serif;font-weight:500;color:#145C44;font-size:1.8em;margin:2rem 0 .75rem;border-bottom:4px solid #D4AF37;padding-bottom:.25rem}
        .lux-article h3{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia',serif;font-weight:400;color:#145C44;font-size:1.25em;margin:1.25rem 0 .5rem}
        .lux-article p{font-family:'Reith Serif','BBC Reith Serif','Merriweather','Georgia','Times New Roman',serif;font-weight:400;font-size:1.06em;margin:0 0 1.25rem;text-align:justify}
        .lux-article ul{margin:.5rem 0 1.25rem 1.5rem}
        .lux-callout{background:#E8F3F7;color:#166A5D;border-left:8px solid #D4AF37;border-radius:14px;padding:1rem 1.25rem;font-style:italic;box-shadow:0 2px 0 rgba(0,0,0,.04);margin:1rem 0 1.25rem}
        .lux-cta{background:#FFFFFF;border:2px solid #8B5CF6;color:#111;border-radius:12px;padding:1rem 1.25rem;text-align:center;margin:1.5rem 0;display:flex;flex-direction:column;align-items:center;gap:.5rem}
        .lux-cta h3{color:#111;margin:0}
        .lux-cta p{color:#111;text-align:center;margin:0}
        .lux-cta a{display:inline-block;background:#fff;color:#111;border:2px solid #8B5CF6;border-radius:8px;padding:.5rem 1rem;font-weight:700;text-decoration:none}
        .lux-meta{background:#F8FAFF;border:2px solid #8B5CF6;color:#111;border-radius:12px;padding:.5rem .75rem;text-align:center;margin:.75rem 0;font-weight:600}
        .lux-platforms{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;margin-top:.25rem}
        .lux-chip{display:inline-flex;align-items:center;gap:.35rem;border:2px solid #8B5CF6;color:#111;border-radius:999px;padding:.35rem .7rem;text-decoration:none;font-weight:600}
        .lux-chip svg{width:16px;height:16px;fill:#8B5CF6}
        blockquote{border-left:6px solid #D4AF37;color:#1F513F;padding-left:1rem;margin:1rem 0}
    </style>
</head>
<body>
${html}
</body>
</html>`;
            
            navigator.clipboard.writeText(fullHTML)
                .then(() => alert('‚úÖ HTML copied to clipboard!'))
                .catch(() => alert('‚ùå Error copying HTML'));
        }
        
        function copyFormatted() {
            if (!currentArticle) return;
            
            const content = document.getElementById('articleContent');
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(content);
            selection.removeAllRanges();
            selection.addRange(range);
            document.execCommand('copy');
            selection.removeAllRanges();
            
            alert('‚úÖ Formatted text copied! You can paste it with formatting preserved.');
        }
        
        function downloadMarkdown() {
            if (!currentArticle) return;
            
            let markdown = currentArticle.content
                .replace(/<h1>(.*?)<\/h1>/g, '# $1\n\n')
                .replace(/<h2>(.*?)<\/h2>/g, '## $1\n\n')
                .replace(/<h3>(.*?)<\/h3>/g, '### $1\n\n')
                .replace(/<p>(.*?)<\/p>/g, '$1\n\n')
                .replace(/<strong>(.*?)<\/strong>/g, '**$1**')
                .replace(/<em>(.*?)<\/em>/g, '*$1*')
                .replace(/<ul>/g, '\n')
                .replace(/<\/ul>/g, '\n')
                .replace(/<li>(.*?)<\/li>/g, '- $1\n')
                .replace(/<[^>]*>/g, '');
            
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentArticle.title}.md`;
            a.click();
            
            alert('‚úÖ Markdown downloaded!');
        }
        
        // ==================== STATS & ARTICLES ====================
        function updateStats() {
            document.getElementById('statArticles').textContent = currentUser.articles_count || 0;
            document.getElementById('statWords').textContent = (currentUser.total_words || 0).toLocaleString();
            document.getElementById('statStreak').textContent = currentUser.streak || 0;
        }
        
        function loadArticles() {
            const isPT = (document.getElementById('langSelect').value || 'pt') === 'pt';
            document.getElementById('articlesGrid').innerHTML = isPT ? '<p style="text-align:center;color:#999;">Nenhum artigo ainda. Crie sua primeira obra-prima!</p>' : '<p style="text-align:center;color:#999;">No articles yet. Create your first masterpiece!</p>';
        }
        
        function changeLanguage(lang) {
            const isPT = lang === 'pt';
            document.getElementById('langSelect').value = lang;
            const set = (id, pt, en) => { const el = document.getElementById(id); if (!el) return; el.textContent = isPT ? pt : en; };
            set('trialBadge', 'üéÅ 14 Dias de Teste Gr√°tis', 'üéÅ 14 Days Free Trial');
            set('authTabLogin', 'Entrar', 'Login');
            set('authTabSignup', 'Criar Conta', 'Sign Up');
            set('labelEmail', 'Email', 'Email');
            set('labelPassword', 'Senha', 'Password');
            set('btnLogin', 'Entrar', 'Login');
            set('labelFullName', 'Nome Completo', 'Full Name');
            set('labelPasswordMin', 'Senha (m√≠n. 6 caracteres)', 'Password (min 6 characters)');
            set('btnStartTrial', 'üéÅ Iniciar Teste Gr√°tis', 'üéÅ Start Free Trial');
            set('paywallTitle', 'Per√≠odo de Teste Encerrado', 'Trial Expired');
            set('paywallDesc', 'Assine para continuar criando conte√∫dos incr√≠veis!', 'Subscribe to continue creating amazing content!');
            set('perMonthText', 'por m√™s', 'per month');
            set('btnCheckout', 'üí≥ Ir para pagamento', 'üí≥ Go to Checkout');
            set('btnSubscribeNow', 'üí≥ Assinar Agora', 'üí≥ Subscribe Now');
            set('btnSubscribeTop', 'Assinar', 'Subscribe');
            set('btnUnlock', '‚úÖ J√° paguei ‚Äî Liberar', '‚úÖ I Have Paid ‚Äî Unlock');
            set('btnLogout', 'Sair', 'Logout');
            set('labelArticlesCreated', 'Artigos Criados', 'Articles Created');
            set('labelTotalWords', 'Total de Palavras', 'Total Words');
            set('labelDayStreak', 'Dias Seguidos', 'Day Streak');
            set('titleCreate', '‚ú® Criar Novo Artigo', '‚ú® Create New Article');
            set('labelTopic', 'üìù T√≥pico', 'üìù Topic');
            set('labelLanguage', 'üåç Idioma', 'üåç Language');
            set('labelWordCount', 'üìä Contagem de Palavras', 'üìä Word Count');
            set('labelStyle', 'üé® Estilo', 'üé® Style');
            set('labelAcademic', 'üéì Modo Acad√™mico (tese/doutorado)', 'üéì Academic Mode (thesis/PhD)');
            set('labelSourceType', 'üìö Tipo de Fonte', 'üìö Source Type');
            set('labelCitationStyle', 'üìù Estilo de Cita√ß√£o', 'üìù Citation Style');
            set('labelAcademicLevel', 'üè∑Ô∏è N√≠vel Acad√™mico', 'üè∑Ô∏è Academic Level');
            set('labelInstructions', 'üí° Instru√ß√µes Adicionais (opcional)', 'üí° Additional Instructions (optional)');
            set('labelReferences', 'üìë Bibliografia (opcional)', 'üìë Bibliography (optional)');
            set('generateBtn', 'üöÄ Gerar Artigo', 'üöÄ Generate Article');
            set('previewTitle', 'üìÑ Seu Artigo', 'üìÑ Your Article');
            set('btnGenTitles', 'üé≤ Gerar T√≠tulos', 'üé≤ Generate Titles');
            set('btnSave', 'üíæ Salvar', 'üíæ Save');
            set('btnCopyHTML', 'üìã Copiar HTML', 'üìã Copy HTML');
            set('btnCopyFormatted', 'üìÑ Copiar Formatado', 'üìÑ Copy Formatted');
            set('btnDownloadMd', '‚¨áÔ∏è Markdown', '‚¨áÔ∏è Markdown');
            set('titleMyArticles', 'üìö Meus Artigos', 'üìö My Articles');
            set('titleReviews', '‚≠ê Avalia√ß√µes', '‚≠ê Reviews');
            set('labelReviewName', 'Nome', 'Name');
            set('labelReviewRating', 'Nota', 'Rating');
            set('labelReviewComment', 'Coment√°rio', 'Comment');
            set('btnSubmitReview', 'Enviar Avalia√ß√£o', 'Submit Review');
            set('titleHeader', 'Gerar Novos T√≠tulos', 'Generate New Titles');
            set('btnRegenerate', 'üîÅ Regerar', 'üîÅ Regenerate');
            set('btnCloseOverlay', '‚úñ Fechar', '‚úñ Close');
            set('adminAccessTitle','Controle de Acesso','Access Control');
            set('adminAccessEmailLabel','Email do Usu√°rio','User Email');
            set('adminAccessDaysLabel','Dias de Acesso','Access Days');
            set('adminAccessIndefLabel','Acesso Indeterminado','Indefinite Access');
            set('adminAccessGrantBtn','Conceder Acesso','Grant Access');
            set('adminAccessRemoveBtn','Remover Configura√ß√£o','Remove Override');
            renderTrialBanner();
            renderBenefitsTicker();
        }
    </script>
</body>
</html>
